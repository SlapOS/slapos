#!{{ dash_binary }}
# BEWARE: This file is operated by slapos node
# BEWARE: It will be overwritten automatically

pid_file="{{ pid_file }}"
monitor_httpd_conf_file={{ monitor_httpd_conf }}

if [ -f "$pid_file" ]; then
    pid=$(cat "$pid_file")
    result=$(ps aux | grep "^\S*\s*$pid\s")

    # The process with the specified PID is running
    if [ -n "$result" ]; then
        # Get the command line of the process and replace null characters with spaces
        cmdline=$(tr '\0' ' ' < "/proc/$pid/cmdline")

        # There has a service running with the pid.
        # but it not the one use the monitor-httpd.conf
        if ! echo "$cmdline" | grep -q "$monitor_httpd_conf"; then
            rm -f {{ pid_file }};
        fi
    fi
fi

{{ ca_monitor_httpd_wrapper }} "$@"
[buildout]
extends =
  buildout.cfg
# Exact versions from Zope 4
  versions.cfg
  versions-prod.cfg

parts +=
# Development eggs
  slapos-cookbook-develop
  slapos-cookbook

[python]
part = python3

[slapos.cookbook-repository]
develop = true
branch = zope4

parts -=
# XXX: The following parts have no support for Python 3. Ignore for now.
  rdiff-backup
  ocropy
  hookbox

[rdiff-backup]
recipe =
[rdiff-backup-build]
recipe =
[ocropy]
recipe =
[hookbox]
recipe =

[numpy-egg-abspath]
# XXX: The only purpose of this section is to dynamically get the absolute path
# of the numpy egg. There's probably a better way.
recipe = slapos.recipe.build
init =
  import glob, os
  paths = glob.glob(os.path.join(self.buildout['buildout']['develop-eggs-directory'], 'numpy-*.egg'))
  assert len(paths) == 1, paths
  options['abspath'] = paths[0]

[scipy-env]
# See https://github.com/scipy/scipy/blob/b285d269decb8ed11079c9d4e450391eda26e9ad/scipy/special/setup.py#L158
# `sys.executable` is a "raw" python 3, and can't find numpy. We thus tell it
# where to find it, because it needs it.
PYTHONPATH=${numpy-egg-abspath:abspath}:$PYTHONPATH

[python-ldap-python]
# No patch needed anymore
patches =
include-dirs -=
  ${cyrus-sasl:location}/include/sasl
include-dirs +=
  ${cyrus-sasl:location}/include

[eggs]
eggs -=
# tracemalloc is now part of Python 3.4!
  pytracemalloc
# XXX: The following eggs have no support for Python 3. Ignore for now.
  ocropy
  ${ocropy:egg}
  PyXML
  threadframe
  suds
  xupdate_processor
  SOAPpy
  fpconst

Acquisition-patches = ${:_profile_base_location_}/../../component/egg-patch/Acquisition/aq_dynamic-4.5.patch#e923ab436d53282df536de3ef7d3e127

[versions]
# patched eggs
Acquisition = 4.5+SlapOSPatched001

# zc.recipe.egg 2.0.7 (in versions.cfg) requires zc.buildout>=2.12.0, so let's
# revert to the version contained in stack/slapos.cfg
zc.recipe.egg = 2.0.3+slapos003

pyasn1-modules = 0.2.8
pyasn1 = 0.4.8

# Version up to support Python 3.7
numpy = 1.16.6
pandas = 0.24.2
# XXX: No version of scipy is both compatible with Python 2.7 and 3.7
scipy = 1.5.2
scikit-learn = 0.20.4
statsmodels = 0.10.2
pyzmq = 19.0.2
PyStemmer = 2.0.1
python-ldap = 3.1.0

{% set document_root = parameter_dict.get('document-root', parameter_dict['default-document-root']) -%}
<VirtualHost *:{{ parameter_dict['port'] }}>
  ServerAdmin admin@example.com
  DocumentRoot {{ document_root }}

  SetEnvIf Origin "^http(s)?://(.+\.)?(app\.officejs\.com)$" ORIGIN_DOMAIN=$0
  Header always set Access-Control-Allow-Origin "%{ORIGIN_DOMAIN}e" env=ORIGIN_DOMAIN
  Header always set Access-Control-Allow-Credentials "true" env=ORIGIN_DOMAIN
  Header always set Access-Control-Allow-Methods "PROPFIND, PROPPATCH, COPY, MOVE, DELETE, MKCOL, LOCK, UNLOCK, PUT, GETLIB, VERSION-CONTROL, CHECKIN, CHECKOUT, UNCHECKOUT, REPORT, UPDATE, CANCELUPLOAD, HEAD, OPTIONS, GET, POST" env=ORIGIN_DOMAIN
  Header always set Access-Control-Allow-Headers "Overwrite, Destination, Content-Type, Depth, User-Agent, X-File-Size, X-Requested-With, If-Modified-Since, X-File-Name, Cache-Control, Authorization" env=ORIGIN_DOMAIN
  Header always set Strict-Transport-Security "max-age=15552000; includeSubDomains"

  <Directory {{ document_root }}>
      Options +FollowSymlinks
      AllowOverride All
      Require all granted
      SetEnv HOME {{ document_root }}
      SetEnv HTTP_HOME {{ document_root }}
      Dav off

  </Directory>
{% if parameter_dict.get('wellknown-proxy') %}
  ProxyPass /.well-known/ {{ parameter_dict['wellknown-proxy'] }}/.well-known/
  ProxyPassReverse /.well-known/ {{ parameter_dict['wellknown-proxy'] }}/.well-known/
{% endif -%}

  ErrorLog "{{ parameter_dict['log-dir'] }}/lamp-error.log"
  CustomLog "{{ parameter_dict['log-dir'] }}/lamp-access.log" combined

</VirtualHost>

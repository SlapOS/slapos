[buildout]
extends =
  ../../component/xz-utils/buildout.cfg
  ../../component/postfix/buildout.cfg
  ../../stack/monitor/buildout.cfg
  buildout.hash.cfg
  ../../stack/slapos.cfg


parts =
  slapos-cookbook
  template
  postfix

[template]
recipe = slapos.recipe.template:jinja2
url = ${:_profile_base_location_}/${:filename}
output = ${buildout:directory}/template.cfg
context =
    key bash_location bash:location
    key bin_directory buildout:bin-directory
    key coreutils_location coreutils:location
    key buildout_egg_directory buildout:eggs-directory
    key buildout_develop_directory buildout:develop-eggs-directory
    key buildout_directory buildout:directory
    key dash_location dash:location
    key logrotate_location logrotate:location
    key logrotate_cfg template-logrotate-base:output
    key template_monitor monitor2-template:output
    key template_default template-default:target
    key unixodbc_location unixodbc:location
    key openssl_location openssl:location
    key postfix_sasl_passwd_template postfix_sasl_passwd.in:target
    key postfix_transport_template postfix_transport.in:target
    raw postfix_main_template ${postfix_main.jinja2.cf:target}
    raw postfix_master_template ${postfix_master.jinja2.cf:target}
    raw postfix_location ${postfix:location}
    raw xz_utils_location ${xz-utils:location}

[template-download-base]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:filename}


[template-default]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:_update_hash_filename_}

[copy-to-instance]
recipe   = slapos.recipe.build:download
url      = ${:_profile_base_location_}/${:_buildout_section_name_}
filename = ${:_buildout_section_name_}

[postfix_main.jinja2.cf]
<= copy-to-instance
[postfix_master.jinja2.cf]
<= copy-to-instance
[postfix_sasl_passwd.in]
<= copy-to-instance
[postfix_transport.in]
<= copy-to-instance

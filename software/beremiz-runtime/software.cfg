[buildout]
#allow-picked-versions = true
extends =
  buildout.hash.cfg
  ../../component/git/buildout.cfg
  ../../component/matiec/buildout.cfg
  ../../component/open62541/buildout.cfg
  ../../component/numpy/buildout.cfg
  ../../component/lxml-python/buildout.cfg
  ../../component/inkscape/buildout.cfg
  ../../component/linuxptp/buildout.cfg
  ../../component/iperf3/buildout.cfg
  ../../component/mtools/buildout.cfg
  ../../component/mosquitto/buildout.cfg
  ../../stack/slapos.cfg

parts =
  slapos-cookbook
  instance-profile
  python-interpreter
  matiec
  open62541
  inkscape
  linuxptp
  iperf3
  mtools
  mosquitto

[gcc]
# GCC is used at instance level
force-build = true

[python3]
<= python3.12

[open62541]
configure-options =
  -DBUILD_SHARED_LIBS=OFF
  -DCMAKE_BUILD_TYPE=Release
  -DCMAKE_INSTALL_PREFIX=@@LOCATION@@
  -DUA_ENABLE_PUBSUB=ON
  -DUA_ENABLE_SUBSCRIPTIONS=ON
  -DUA_NAMESPACE_ZERO=REDUCED
  -DUA_ENABLE_ENCRYPTION=OPENSSL
  -DOPENSSL_ROOT_DIR=${openssl:location}

# Beremiz need it to be in folder parts/open62541
# as Beremiz search for open62541 to BEREMIZ_PATH/../open62541
shared = false
post-install =
  mkdir -p @@LOCATION@@/build/bin
  ln -sf @@LOCATION@@/lib/libopen62541.a @@LOCATION@@/build/bin/libopen62541.a

[beremiz-source]
recipe = slapos.recipe.build:gitclone
repository = https://github.com/beremiz/beremiz.git
revision = 3e64352632b5cb23c04a64e72b5b14d885a639cc
git-executable = ${git:location}/bin/git

[nevow-py3-source]
recipe = slapos.recipe.build:gitclone
repository = https://github.com/beremiz/nevow-py3.git
revision = fe14898bc3e8aaa2ff982b6fb07c76c3b0bec77d
git-executable = ${git:location}/bin/git

[Nevow]
recipe  = zc.recipe.egg:develop
egg     = Nevow
setup   = ${nevow-py3-source:location}

[python-interpreter]
recipe = zc.recipe.egg
interpreter = pythonwitheggs
eggs = aiofiles
       aiosqlite
       click
       erpc
       ifaddr
       zeroconf
       ${Nevow:egg}
       msgpack
       autobahn
       ${numpy:egg}
       ${lxml-python:egg}
       cycler
       ${python-cryptography:egg}
       asyncua
       Twisted
       fonttools
       pycountry
extra-paths = ${beremiz-source:location}

[instance-profile]
recipe = slapos.recipe.template:jinja2
url = ${:_profile_base_location_}/${:filename}
output = ${buildout:directory}/instance.cfg
extensions = jinja2.ext.do
context =
  section buildout  buildout
  key openssl_location openssl:location
  key gcc_location gcc:prefix
  key inkscape_location inkscape:location

[versions]
#poetry = 2.2.1 # ivan
zope-interface = 8.1.1
virtualenv = 20.35.4
tomlkit = 0.13.3
shellingham = 1.5.4
requests-toolbelt = 1.0.0
pyproject-hooks = 1.2.0
pkginfo = 1.12.1.2
pbs-installer = 2025.12.17
keyring = 25.7.0
installer = 0.7.0
findpython = 0.7.1
dulwich = 0.24.10
cleo = 2.2.1
build = 1.3.0
distlib = 0.4.0
zstandard = 0.25.0
#aiofiles=24.1.0 # ivan
#aiosqlite=0.21.0 # ivan
#asyncua @ git+https://github.com/FreeOpcUa/opcua-asyncio.git@98a64897a2d171653353de2f36d33085aef65e82
#autobahn @ git+https://github.com/crossbario/autobahn-python.git@7bc85b34e200640ab98a41cfddb38267f39bc92e
#Automat=24.8.1 # Ivan
Brotli=1.1.0
cffi=1.17.1
constantly=23.10.4:whl
contourpy=1.3.1
cryptography=44.0.1
cycler=0.12.1
#erpc @ git+https://git@github.com/beremiz/erpc.git@d8fff72b15274b5f2a8f7895d9bc5c91eef584ec#subdirectory=erpc_python
fonttools=4.56.0
hyperlink=21.0.0
ifaddr=0.2.0
incremental=24.7.2
kiwisolver=1.4.8
lxml=5.3.1
matplotlib=3.10.1
msgpack=1.1.0
#Nevow @ git+https://git@github.com/beremiz/nevow-py3.git@fe14898bc3e8aaa2ff982b6fb07c76c3b0bec77d
numpy=2.2.3
#packaging=24.2 # ivan
pillow=11.1.0
pycountry=24.6.1:whl
pycparser=2.22
pyOpenSSL=25.0.0
pyparsing=3.2.1
#python-dateutil=2.9.0.post0 # ivan
pytz=2025.1
six=1.17.0
sortedcontainers=2.4.0
#sslpsk @ git+https://git@github.com/beremiz/sslpsk.git@9cb31986629b382f7427eec29ddc168ad21c7d7c
#tomli=2.2.1 # ivan
#Twisted=24.11.0 # Ivan
txaio=23.1.1
typing_extensions=4.12.2
wxPython=4.2.2
zeroconf=0.145.1:whl
zope.interface=7.2

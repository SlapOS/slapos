[buildout]
extends =
# "slapos" stack describes basic things needed for 99.9% of SlapOS Software
# Releases
  ../../stack/slapos.cfg
# Extend here component profiles, like openssl, apache, mariadb, curl...
# Or/and extend a stack (lamp, tomcat) that does most of the work for you
# In this example we extend needed components for html5as.
  ../../component/nginx/buildout.cfg
  ../../component/dash/buildout.cfg

parts =
# Call installation of slapos.cookbook egg defined in stack/slapos.cfg (needed
# in 99,9% of Slapos Software Releases)
    slapos-cookbook
# Call creation of instance.cfg file that will be called for deployment of
# instance
    template-cfg

# Download instance.cfg.in (buildout profile used to deployment of instance),
# replace all {{ foo_bar }} parameters by real values
# The recipe, template and mode are fetched from jijna-template
[template-cfg]
recipe = slapos.recipe.template:jinja2
rendered = ${buildout:directory}/template.cfg
template = ${:_profile_base_location_}/${:filename}
filename = instance.cfg.in
md5sum = d75185a0cfeced8aa41d51e1b798d9af
mode = 0644
context =
  section buildout buildout
  key nginx_location nginx:location
  key dash_location dash:location
  key template_nginx_conf_target template_nginx_conf:target
  key template_mime_types_target template_mime_types:target
  key template_launcher_target template_launcher:target
  key template_instance_html5as_target instance_html5as:target
  key template_index_html_target template_index_html:target

# Have one shared section to define the default behaviour to download
# templates. Sections inheriting from this one won't need to redefine
# shared parameters
[download-base]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:_update_hash_filename_}
mode = 0644

# Download instance_html5as.cfg.in
[instance_html5as]
# This section inherit from download-base
<= download-base
_update_hash_filename_ = instance_html5as.cfg.in
md5sum = 9c023bac9fb0db71213c5d31bd6a0b6b

[template_nginx_conf]
<= download-base
_update_hash_filename_ = templates/nginx_conf.in
md5sum = 61dc4c82bf48563228ce4dea6c5c6319

[template_launcher]
<= download-base
_update_hash_filename_ = templates/launcher.in
md5sum = 8d4d3152f5125f73d0c3f3ea1c3699dd

[template_mime_types]
<= download-base
_update_hash_filename_ = templates/mime_types.in
md5sum = 4ef94a7b458d885cd79ba0b930a5727e

[template_index_html]
<= download-base
_update_hash_filename_ = templates/index.html.in
md5sum = d57cb01df5941e139b02a2f7bdabcdc8

# Pin versions of eggs used that are not already pinned by stack/slapos.cfg
[versions]
slapos.recipe.template = 4.4

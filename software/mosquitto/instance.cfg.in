[buildout]
parts =
  directory
  mosquitto-service

eggs-directory = {{ buildout["eggs-directory"] }}
develop-eggs-directory = {{ buildout["develop-eggs-directory"] }}
offline = true

[instance-parameter]
recipe = slapos.cookbook:slapconfiguration
computer = ${slap-connection:computer-id}
partition = ${slap-connection:partition-id}
url = ${slap-connection:server-url}
key = ${slap-connection:key-file}
cert = ${slap-connection:cert-file}

[directory]
recipe = slapos.cookbook:mkdirectory
home = ${buildout:directory}
etc = ${:home}/etc
var = ${:home}/var
script = ${:etc}/run/
service = ${:etc}/service
promise = ${:etc}/promise/
log = ${:var}/log
bin = ${:home}/bin

[mosquitto-service]
recipe  = slapos.cookbook:wrapper
command-line = ${instance-parameter:configuration.type} -h ${instance-parameter:configuration.host} -t ${instance-parameter:configuration.tag} -m ${instance-parameter:configuration.message}
wrapper-path = ${directory:service}/mosquitto-service
output = $${:wrapper-path}

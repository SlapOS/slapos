{
  "type": "object",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Input Parameters",
  "$defs": {
    "vm-parameters-only-for-cluster": {
      "type": "object",
      "properties": {
        "computer-guid": {
          "title": "ID of the computer where to deploy this VM.",
          "description": "Unique identifier of the computer, like \"COMP-1234\". By default, let Master choose a computer.",
          "type": "string",
          "default": ""
        },
        "state": {
          "title": "State of this Virtual Machine",
          "description": "Define if SlapOS should start or stop this VM.",
          "type": "string",
          "default": "started",
          "enum": [
            "started",
            "stopped"
          ]
        }
      }
    }
  },
  "unevaluatedProperties": false,
  "properties": {
    "frontend": {
      "title": "KVM frontend (web socket)",
      "description": "Front end used to provide VNC.",
      "properties": {
        "frontend-instance-guid": {
          "title": "Frontend Instance ID",
          "description": "Unique identifier of the frontend instance, like \"SOFTINST-11031\".",
          "type": "string"
        },
        "frontend-software-type": {
          "title": "Frontend Software Type",
          "description": "Type of the frontend instance, like \"default\".",
          "type": "string",
          "default": "default"
        },
        "frontend-software-url": {
          "title": "Frontend Software URL",
          "description": "Software Release URL of the frontend instance, like \"http://example.com/path/to/software.cfg\".",
          "type": "string",
          "format": "uri",
          "default": "http://git.erp5.org/gitweb/slapos.git/blob_plain/HEAD:/software/apache-frontend/software.cfg"
        },
        "frontend-additional-instance-guid": {
          "title": "Additional Frontend Instance ID",
          "description": "Unique identifier of the additional frontend instance, like \"SOFTINST-11031\". Note that if the 3 options 'frontend-additional-instance-guid', 'frontend-additional-software-type' and 'frontend-additional-software-url' are empty, the additional frontend won't be requested.",
          "type": "string"
        },
        "frontend-additional-software-type": {
          "title": "Additional Frontend Software Type",
          "description": "Type of the additional frontend instance, like \"default\". Note that if the 3 options 'frontend-additional-instance-guid', 'frontend-additional-software-type' and 'frontend-additional-software-url' are empty, the additional frontend won't be requested.",
          "type": "string",
          "default": "default"
        },
        "frontend-additional-software-url": {
          "title": "Additional Frontend Software URL",
          "description": "Software Release URL of the additional frontend instance, like \"http://example.com/path/to/software.cfg\". Note that if the 3 options 'frontend-additional-instance-guid', 'frontend-additional-software-type' and 'frontend-additional-software-url' are empty, the additional frontend won't be requested.",
          "type": "string",
          "format": "uri",
          "default": "http://git.erp5.org/gitweb/slapos.git/blob_plain/HEAD:/software/apache-frontend/software.cfg"
        }
      },
      "type": "object"
    },
    "slave-frontend": {
      "title": "Web frontend",
      "description": "Front end used to provide web access for internal services at the kvm.",
      "properties": {
        "instance-guid": {
          "title": "Main Frontend Instance ID",
          "description": "Unique identifier of the frontend instance, like \"SOFTINST-11031\".",
          "type": "string",
          "default": ""
        },
        "frontend-software-type": {
          "title": "Frontend Software Type",
          "description": "Type of the frontend instance, like \"frontend\".",
          "type": "string",
          "default": "custom-personal"
        },
        "frontend-software-url": {
          "title": "Frontend Software URL",
          "description": "Software Release URL of the frontend instance, like \"http://example.com/path/to/software.cfg\".",
          "type": "string",
          "format": "uri",
          "default": "http://git.erp5.org/gitweb/slapos.git/blob_plain/HEAD:/software/apache-frontend/software.cfg"
        },
        "slave-frontend-dict": {
          "title": "Shared Front end definition",
          "description": "Shared Front end definition",
          "patternProperties": {
            ".*": {
              "properties": {
                "domain": {
                  "title": "Name of the domain to be used",
                  "description": "Name of the domain to be used (example: mydomain.com). Subdomains of this domain will be used for the shared instances (example: instance12345.mydomain.com).",
                  "type": "string",
                  "default": ""
                },
                "url": {
                  "title": "URL of backend to use.",
                  "description": "URL of backend to use. This URL will be used to request frontend if parameter 'kvm-partition-name' is not set.",
                  "format": "uri",
                  "type": "string",
                  "default": ""
                },
                "enable-cache": {
                  "title": "Use cache for this shared frontend.",
                  "description": "Specify if shared frontend should use a cache to connect to backend.",
                  "type": "boolean",
                  "default": false
                },
                "type": {
                  "title": "Specify if shared frontend will redirect to a zope backend.",
                  "description": "If specified, Apache RewriteRule will use Zope's Virtual Host Daemon. Possible values: 'zope', 'default'.",
                  "type": "string",
                  "default": "default"
                },
                "zope-path": {
                  "title": "Path to the VirtualHostRoot of the zope.",
                  "description": "Only used if type is 'zope'. Will append the specified path to the VirtualHostRoot of the zope's VirtualHostMonster.",
                  "type": "string",
                  "default": ""
                },
                "https-only": {
                  "title": "Access website with https url only.",
                  "description": "Specify if website should be accessed using https only. If so, the frontend will redirect the user to https if accessed from http.",
                  "type": "boolean",
                  "default": false
                },
                "kvm-partition-name": {
                  "title": "Reference name in kvm instance definition to get url from.",
                  "description": "Compose url from kvm definition. Only work if 'use-nat' is true and 'service-port' is set. This will allow to get URL from defined nat-rules. Play the same as url, but help if you don't know kvm ipv6 yet.",
                  "type": "string",
                  "default": ""
                },
                "service-port": {
                  "title": "Port of service into the VM (require: kvm-name).",
                  "description": "This will allow to get URL from defined nat-rules. The port should exist in nat-rules of KVM you have referenced by 'kvm-partition-name'",
                  "type": "integer"
                },
                "url-scheme": {
                  "title": "Scheme of HTTP service into the VM (require: kvm-name).",
                  "description": "Say If HTTP service to run/or running into the Virtual Machine will use http or https. Possible values: http, https.",
                  "type": "string",
                  "enum": [
                    "http",
                    "https"
                  ],
                  "default": "http"
                }
              },
              "type": "object"
            }
          },
          "type": "object"
        }
      },
      "type": "object"
    },
    "fw-restricted-access": {
      "title": "Restrict all access to VM with firewall.",
      "description": "When Firewall is enabled, this parameter define if only vm of this cluster and authorized sources ip should have access to cluster.",
      "type": "string",
      "enum": [
        "on",
        "off"
      ],
      "default": "off"
    },
    "fw-authorized-sources": {
      "title": "List of IP/Network address authorized to cluster.",
      "description": "When Firewall is enabled, this contain the list of IP address to authorize for access to all VM of this cluster.",
      "type": "array",
      "optional": true
    },
    "fw-reject-sources": {
      "title": "List of IP/Network address rejected, if 'Restrict all access' is off.",
      "description": "When Firewall is enabled, this contain the list of IP address which should not access to all VM of this cluster.",
      "type": "array",
      "optional": true
    },
    "authorized-keys": {
      "title": "Public keys for virtual machines.",
      "description": "Set the list of public keys to add in your virtual machine. The public key file will be available in the VM via url http://10.0.2.100/authorized_keys if you keep the NAT interface enabled",
      "type": "array"
    },
    "bootstrap-script-url": {
      "title": "Virtual Machines bootstrap script URL.",
      "description": "If dedicaced disk image is used, this script will be downloaded and run at first boot of the virtual machine. Set md5sum to URL like: http://example.com/file#MD5SUM. Get file in vm at http://10.0.2.100/vm-bootstrap.",
      "type": "string",
      "format": "uri"
    },
    "cluster-data": {
      "title": "Text content to share with virtual machines.",
      "description": "Text content which will be written in a file data of cluster http server. All VM will be able to download that file via the static URL of cluster HTTP server: https://10.0.2.101/FOLDER_HASH/data.",
      "type": "string"
    },
    "monitor-interface-url": {
      "title": "Monitor Web Interface URL",
      "description": "Give Url of HTML web interface that will be used to render this monitor instance.",
      "type": "string",
      "format": "uri",
      "default": "https://monitor.app.officejs.com"
    },
    "kvm-partition-dict": {
      "title": "kvm instances definition",
      "description": "kvm instances definition",
      "patternProperties": {
        ".*": {
          "unevaluatedProperties": false,
          "allOf": [
            {
              "$ref": "#/$defs/vm-parameters-only-for-cluster"
            },
            {
              "$ref": "./boot-image-input-schema.json#/$defs/instance-parameters"
            },
            {
              "$ref": "./instance-kvm-input-schema.json#/$defs/instance-parameters"
            }
          ]
        }
      },
      "type": "object"
    }
  }
}

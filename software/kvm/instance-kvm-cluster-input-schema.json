{
  "type": "object",
  "$schema": "http://json-schema.org/draft-04/schema",
  "title": "Input Parameters",
  "properties": {
    "frontend": {
      "title": "KVM frontend (web socket)",
      "description": "Front end used to provide VNC.",
      "properties": {
        "frontend-instance-guid": {
          "title": "Frontend Instance ID",
          "description": "Unique identifier of the frontend instance, like \"SOFTINST-11031\".",
          "type": "string",
          "default": ""
        },
        "frontend-software-type": {
          "title": "Frontend Software Type",
          "description": "Type of the frontend instance, like \"frontend\".",
          "type": "string",
          "default": "frontend"
        },
        "frontend-software-url": {
          "title": "Frontend Software URL",
          "description": "Software Release URL of the frontend instance, like \"http://example.com/path/to/software.cfg\".",
          "type": "string",
          "format": "uri",
          "default": "http://git.erp5.org/gitweb/slapos.git/blob_plain/refs/tags/slapos-0.92:/software/kvm/software.cfg"
        }
      },
      "type": "object"
    },
    "slave-frontend": {
      "title": "Web frontend",
      "description": "Front end used to provide web access for internal services at the kvm.",
      "properties": {
        "instance-guid": {
          "title": "Main Frontend Instance ID",
          "description": "Unique identifier of the frontend instance, like \"SOFTINST-11031\".",
          "type": "string",
          "default": ""
        },
        "frontend-software-type": {
          "title": "Frontend Software Type",
          "description": "Type of the frontend instance, like \"frontend\".",
          "type": "string",
          "default": "default"
        },
        "frontend-software-url": {
          "title": "Frontend Software URL",
          "description": "Software Release URL of the frontend instance, like \"http://example.com/path/to/software.cfg\".",
          "type": "string",
          "format": "uri",
          "default": "http://git.erp5.org/gitweb/slapos.git/blob_plain/HEAD:/software/apache-frontend/software.cfg"
        },
        "slave-frontend-dict": {
          "title": "Slave Front end definition",
          "description": "Slave Front end definition",
          "patternProperties": {
            ".*": {
              "properties": {
                "domain": {
                  "title": "Name of the domain to be used",
                  "description": "Name of the domain to be used (example: mydomain.com). Subdomains of this domain will be used for the slave instances (example: instance12345.mydomain.com).",
                  "type": "string",
                  "default": ""
                },
                "url": {
                  "title": "URL of backend to use.",
                  "description": "URL of backend to use. This URL will be used to request frontend if parameter 'kvm-partition-name' is not set.",
                  "format": "uri",
                  "type": "string",
                  "default": ""
                },
                "enable-cache": {
                  "title": "Use cache for this slave frontend.",
                  "description": "Specify if slave frontend should use a squid to connect to backend.",
                  "type": "boolean",
                  "default": false
                },
                "type": {
                  "title": "Specify if slave frontend will redirect to a zope backend.",
                  "description": "If specified, Apache RewriteRule will use Zope's Virtual Host Daemon. Possible values: 'zope', 'default'.",
                  "type": "string",
                  "default": "default"
                },
                "zope-path": {
                  "title": "Path to the VirtualHostRoot of the zope.",
                  "description": "Only used if type is 'zope'. Will append the specified path to the VirtualHostRoot of the zope's VirtualHostMonster.",
                  "type": "string",
                  "default": ""
                },
                "https-only": {
                  "title": "Access website with https url only.",
                  "description": "Specify if website should be accessed using https only. If so, the frontend will redirect the user to https if accessed from http.",
                  "type": "boolean",
                  "default": false
                },
                "kvm-partition-name": {
                  "title": "Reference name in kvm instance definition to get url from.",
                  "description": "Compose url from kvm definition. Only work if 'use-nat' is true and 'service-port' is set. This will allow to get URL from defined nat-rules. Play the same as url, but help if you don't know kvm ipv6 yet.",
                  "type": "string",
                  "default": ""
                },
                "service-port": {
                  "title": "Port of service into the VM (require: kvm-name).",
                  "description": "This will allow to get URL from defined nat-rules. The port should exist in nat-rules of KVM you have referenced by 'kvm-partition-name'",
                  "type": "integer"
                },
                "url-scheme": {
                  "title": "Scheme of HTTP service into the VM (require: kvm-name).",
                  "description": "Say If HTTP service to run/or running into the Virtual Machine will use http or https. Possible values: http, https.",
                  "type": "string",
                  "enum": ["http", "https"],
                  "default": "http"
                }
              },
              "type": "object"
            }
          },
         "type": "object"
        }
      },
      "type": "object"
    },
    "authorized-key": {
      "title": "Public keys for virtual machines.",
      "description": "Set the list of public keys to add in your virtual machine. The public key file will be available in the VM via url http://10.0.2.100/authorized_keys if you keep the NAT interface enabled",
      "type": "array"
    },
    "kvm-partition-dict": {
      "title": "kvm instances definition",
      "description": "kvm instances definition",
      "patternProperties": {
        ".*": {
          "properties": {
            "computer-guid": {
              "title": "ID of the computer where to deploy this VM.",
              "description": "Unique identifier of the computer, like \"COMP-1234\". By default, let Master choose a computer.",
              "type": "string",
              "default": ""
            },
            "ram-size": {
              "title": "RAM size",
              "description": "RAM size, in MB.",
              "type": "integer",
              "default": 1024,
              "minimum": 128,
              "multipleOf": 128,
              "maximum": 16384
            },
            "disk-size": {
              "title": "Disk size",
              "description": "Disk size, in GB.",
              "type": "integer",
              "default": 10,
              "minimum": 1,
              "maximum": 1000
            },
            "disk-type": {
              "title": "Disk type",
              "description": "Type of QEMU disk drive.",
              "type": "string",
              "default": "virtio",
              "enum": [
                "ide",
                "scsi",
                "sd",
                "mtd",
                "floppy",
                "pflash",
                "virtio"
              ]
            },
            "cpu-count": {
              "title": "CPU count",
              "description": "Number of CPU cores.",
              "type": "integer",
              "minimum": 1,
              "maximum": 8
            },
            "cpu-options": {
              "title": "CPU Additional options: cores, threads, sockets, maxcpus.",
              "description": "Additional options to use with cpu-count. Options are separated by coma: [cores=cores][,threads=threads][,sockets=sockets][,maxcpus=maxcpus]. Set this option if you know what you're doing.",
              "type": "string"
            },
            "numa": {
              "title": "Simulate a multi node NUMA system.",
              "description": "Simulate a multi node NUMA system. If mem and cpus are omitted, resources are split equally. Each numa option are separated by space: node,nodeid=4,cpus=40-49,mem=64g node,nodeid=1,cpus=10-19,mem=128g. Set this option if you know what you're doing.",
              "type": "string"
            },
            "nbd-host": {
              "title": "NBD hostname or IP",
              "description": "hostname (or IP) of the NBD server containing the boot image.",
              "type": "string",
              "format": [
                "host-name",
                "ip-address",
                "ipv6"
              ],
              "default": "debian.nbd.vifib.net"
            },
            "nbd-port": {
              "title": "NBD port",
              "description": "Port of the NBD server containing the boot image.",
              "type": "integer",
              "default": 1024,
              "minimum": 1,
              "maximum": 65535
            },
            "nbd2-host": {
              "title": "Second NBD hostname or IP",
              "description": "hostname (or IP) of the second NBD server (containing drivers for example).",
              "type": "string",
              "format": [
                "host-name",
                "ip-address",
                "ipv6"
              ]
            },
            "nbd2-port": {
              "title": "Second NBD port",
              "description": "Port of the second NBD server containing the boot image.",
              "type": "integer",
              "minimum": 1,
              "maximum": 65535
            },
            "virtual-hard-drive-url": {
              "title": "Existing disk image URL",
              "description": "If specified, will download an existing disk image (qcow2, raw, ...), and will use it as main virtual hard drive. Can be used to download and use an already installed and customized virtual hard drive.",
              "format": "uri",
              "type": "string"
            },
            "virtual-hard-drive-md5sum": {
              "title": "Checksum of virtual hard drive",
              "description": "MD5 checksum of virtual hard drive, used if virtual-hard-drive-url is specified.",
              "type": "string"
            },
            "virtual-hard-drive-gzipped": {
              "title": "Virtual hard drive to download is gzipped",
              "description": "Define if virtual hard drive to download is gzipped using gzip. This help to reduce size of file to download.",
              "type": "boolean",
              "default": false
            },
            "external-disk-number": {
              "title": "Number of additional disk to create for virtual machine",
              "description": "Specify the number of additional disk to create for virtual machine in data folder of SlapOS Node. Requires instance_storage_home to be configured on SlapOS Node.",
              "type": "integer",
              "minimum": 0,
              "default": 0
            },
            "external-disk-size": {
              "title": "Size of additional disk to create for virtual machine, in Gigabytes",
              "description": "Specify the size of additional disk to create for virtual machine in data folder of SlapOS Node. Requires instance_storage_home to be configured on SlapOS Node.",
              "type": "integer",
              "minimum": 10,
              "maximum": 1000,
              "default": 20
            },
            "external-disk-format": {
              "title": "Type of external disk drive to create by QEMU.",
              "description": "Type of QEMU disk drive, to create.",
              "type": "string",
              "default": "qcow2",
              "enum": ["qcow2", "raw", "vdi", "vmdk", "cloop"]
            },
            "use-tap": {
              "title": "Use QEMU TAP network interface",
              "description": "Use QEMU TAP network interface, might require a bridge on SlapOS Node.",
              "type": "boolean",
              "default": true
            },
            "use-nat": {
              "title": "Use QEMU USER Mode networking",
              "description": "Use QEMU user-mode network stack (NAT).",
              "type": "boolean",
              "default": true
            },
            "nat-rules": {
              "title": "List of rules for NAT of QEMU user mode network stack.",
              "description": "List of rules for NAT of QEMU user mode network stack, as comma-separated list of ports. For each port specified, it will redirect port x of the VM (example: 80) to the port x + 10000 of the public IPv6 (example: 10080). Defaults to \"22 80 443\".",
              "type": "array",
              "default": [
                22,
                80,
                443
              ]
            }
          },
          "type": "object"
        }
      },
      "type": "object"
    }
  }
}

[buildout]
extends = {{ software_parameter_dict['instance-common.cfg.in'] }}

parts =
  cdn-request



[software-parameter-section]
{%- for key,value in software_parameter_dict.items() %}
{{ key }} = {{ dumps(value) }}
{%- endfor %}



[slap-configuration]
# Fetches parameters defined in SlapOS Master for this instance.
# Always the same.
recipe = slapos.cookbook:slapconfiguration.jsonschema.localdb
jsonschema = {{ software_parameter_dict['software.cfg.json'] }}
depends = 
  {{ software_parameter_dict['instance-requester-input-schema.json'] }}
  {{ software_parameter_dict['instance-slave-input-schema.json'] }}
set-default = main
validate-parameters = all
instance-db-path = ${buildout:directory}/slapconfiguration-shared-instance.sqlite
computer = ${slap-connection:computer-id}
partition = ${slap-connection:partition-id}
url = ${slap-connection:server-url}
key = ${slap-connection:key-file}
cert = ${slap-connection:cert-file}

[cdn-request]
recipe = slapos.cookbook:cdnrequest
instance-db-path = ${slap-configuration:instance-db-path}
requestinstance-db-path = ${buildout:directory}/requestinstance-db.sqlite
domainvalidation-db-path = ${buildout:directory}/domainvalidation-db.sqlite
server-url = ${slap-connection:server-url}
computer-id = ${slap-connection:computer-id}
partition-id = ${slap-connection:partition-id}
software-url = ${slap-configuration:configuration.cdn-software-url}
software-type = ${slap-configuration:configuration.cdn-software-type}
shared = true
key-file = ${slap-connection:key-file}
cert-file = ${slap-connection:cert-file}
openssl-binary = {{ software_parameter_dict["openssl-binary"] }}
dns-nameserver = 8.8.8.8, 8.8.4.4, 2001:4860:4860::8888

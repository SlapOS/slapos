[directory]
tests = ${:srv}/tests

[xserver]
display-num = 42

[wmctrl]
recipe = slapos.cookbook:wrapper
command-line = {{ wmctrl_bin }}
wrapper-path = ${directory:bin}/wmctrl
environment =
  XORG_LOCK_DIR=${xserver:lock-dir}
  DISPLAY=${xserver:display}

[xdotool]
recipe = slapos.cookbook:wrapper
command-line = {{ xdotool_bin }}
wrapper-path = ${directory:bin}/xdotool
environment =
  XORG_LOCK_DIR=${xserver:lock-dir}
  DISPLAY=${xserver:display}

[runTestSuite]
env.sh  = ${beremiz-env.sh:output}
workdir = {{ beremiz_location }}

[beremiz-tests]
recipe = slapos.recipe.template
mode = 0700
inline = #!/bin/sh
  cd {{ beremiz_location }}/tests
  make test_dir=${directory:tests} xserver_command='echo "Using ${xserver:display} on Slapos X Server !";' "$@"
output = ${directory:bin}/beremiztest

[sikulix]
recipe = slapos.cookbook:wrapper
command-line = {{ sikulix_bin }} -v
wrapper-path = ${directory:bin}/sikulix
environment =
  JAVA_TOOL_OPTIONS=-Duser.home=${buildout:directory} -Djava.io.tmpdir=${directory:tmp}

[buildout]
extends =
  {{ instance_nxdtest }}
  {{ instance_beremiz }}

parts +=
  sikulix
  wmctrl
  xdotool
  beremiz-tests
  runTestSuite

eggs-directory = {{ eggs_directory }}
develop-eggs-directory = {{ develop_eggs_directory }}
offline = true

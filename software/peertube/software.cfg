[buildout]

extends =
# buildout.hash.cfg is used for automated hash calculation of managed
# instance files by calling update-hash
# buildout.hash.cfg
# "slapos" stack describes basic things needed for 99.9% of SlapOS Software
# Releases
  ../../stack/slapos.cfg
  ../../stack/monitor/buildout.cfg
# Extend here component profiles, like openssl, apache, mariadb, curl...
# Or/and extend a stack (lamp, tomcat) that does most of the work for you
# In this example we extend from helloweb component.
  ../../component/unzip/buildout.cfg
  ../../component/curl/buildout.cfg
  ../../component/vim/buildout.cfg
  ../../component/nodejs/buildout.cfg
  ../../component/yarn/buildout.cfg
  ../../component/python3/buildout.cfg
  ../../component/nginx/buildout.cfg
  ../../component/ffmpeg/buildout.cfg
  ../../component/postgresql/buildout.cfg
  ../../component/openssl/buildout.cfg
  ../../component/gcc/buildout.cfg
# redis-server
  ../../component/redis/buildout.cfg
  ../../component/git/buildout.cfg
  ../../component/wget/buildout.cfg

parts =
# Call installation of slapos.cookbook egg defined in stack/slapos.cfg (needed
# in 99,9% of Slapos Software Releases)
  slapos-cookbook
# Call creation of instance.cfg file that will be called for deployment of
# instance
  instance-profile
  unzip
  curl
  vim
  nodejs
  yarn
  python3
  nginx
  ffmpeg
  postgresql
  gcc
  redis
  git
  wget
# peetube sections
  directory
  peertube-download
  postgresql

[directory]
recipe = slapos.cookbook:mkdirectory
srv = $${buildout:directory}/srv
var = $${:srv}/var
www = $${:var}/www
peertube_directory = ${:www}/peertube
config = $${:peertube_directory}/config
storage = $${:peertube_directory}/storage
versions = $${:peertube_directory}/versions

[peertube-download]
recipe = slapos.recipe.build:download
url = https://github.com/Chocobozzz/PeerTube/releases/download/v4.2.2/peertube-v4.2.2.zip
destination = ${directory:versions}
# md5sum =

[postgresql]
recipe = slapos.cookbook:postgres
bin = ${postgresql10:location}/bin/
services = $${directory:service}
dbname  = peertube
superuser = peertube
password = $${postgresql-password:passwd}
pgdata-directory = $${directory:srv}/postgresql



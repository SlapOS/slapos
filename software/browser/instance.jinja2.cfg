[buildout]
parts =
  xvfb-instance
  firefox-instance
  browse-url

eggs-directory =  {{ buildout['eggs-directory'] }}
develop-eggs-directory = {{ buildout['develop-eggs-directory'] }}
offline = true

[instance]
# Fetch arbitrary parameters defined by the user in SlapOS Master for his instance.
# See docstring of slapos.cookbook:slapconfiguration for more information.
recipe = slapos.cookbook:slapconfiguration
computer = ${slap_connection:computer_id}
partition = ${slap_connection:partition_id}
url = ${slap_connection:server_url}
key = ${slap_connection:key_file}
cert = ${slap_connection:cert_file}

# Configurable parameters by <instance>/inspectInstance -> Parameters
configuration.browser-url = https://www.nexedi.com/
configuration.browser-timeout = 99

# Create all needed directories, depending on your needs
[directory]
recipe = slapos.cookbook:mkdirectory
home = ${buildout:directory}
bin = ${:home}/bin
etc = ${:home}/etc
var = ${:home}/var
srv = ${:home}/srv
log = ${:var}/log
run = ${:var}/run
# Executables put here will be started but not monitored (for startup scripts)
script = ${:etc}/run
# Executables put here will be started and monitored (for daemons)
service = ${:etc}/service
# Executables to be run periodically
promise = ${:etc}/promise
# Software-specific folders
# Xserver
framebuffer = ${directory:srv}/framebuffer

[browse-url]
recipe = slapos.recipe.template:jinja2
template = {{ buildout['directory'] }}/browse-url.jinja2.sh
md5sum = 57751f77796c4117d260939cc8373861
rendered = ${directory:bin}/browse-url.sh
mode = 0744
context =
  raw dash {{ dash }}/bin/dash
  key browser firefox-instance:runner-path
  key url instance:configuration.browser-url
  key timeout instance:configuration.browser-timeout

[firefox-instance]
recipe = slapos.cookbook:firefox
firefox-path = {{ firefox }}/firefox-slapos
runner-path = ${directory:bin}/firefox-sandboxed
prefsjs-path = ${directory:etc}/prefs.js
shell-path = {{ dash }}/bin/dash
tmp-path = ${directory:run}

[xvfb-instance]
recipe = slapos.cookbook:xvfb
xvfb-path = {{ xserver }}/bin/Xvfb
runner-path = ${directory:service}/xvfb
fbdir-path = ${directory:framebuffer}
tmp-path = ${directory:run}
shell-path = {{ dash }}/bin/dash
xwd-path = {{ xwd }}/bin/xwd
xwd-hook-path = ${directory:bin}/xwd
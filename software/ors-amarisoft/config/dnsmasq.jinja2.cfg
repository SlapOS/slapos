# XXX -> ru/lopcomm
{# if ru == "lopcomm" #}
{% if True %}  {# XXX temp disabled #}
dhcp-leasefile={{ directory['etc'] }}/dnsmasq.leases
port=5354
dhcp-range=::1,::1,constructor:{{ ru.cpri_link._tap }},ra-names,64,5m
dhcp-host={{ ru.mac_addr }},[{{ vtap[ru.cpri_link._tap].gateway }}]
{# XXX kill  dhcp-option=option6:dns-server,[{{ netaddr.IPAddress(slap_configuration.get('tap-ipv6-gateway', '')) + 1 }}],[{{ netaddr.IPAddress(slap_configuration.get('tap-ipv6-gateway', '')) + 2 }}]  #}
{# XXX kill  dhcp-option=option6:domain-search,bbu.local  #}
# option 17 used for RU callhome
# dhcp-option=option6:17,[{{ vtap[ru.cpri_link._tap].addr }}]
log-queries
log-dhcp
log-facility={{ directory['home'] }}/var/log/dnsmasq.log
enable-ra
ra-param=adv-send-advert
ra-param=adv-managed-flag
ra-param=adv-other-config-flag
ra-param=adv-autonomous
{% else %}
interface={{ slap_configuration.get('tun-name', '') }}
port=5353
{%- set filtered_slave_instance_list = [] %}
{%- for slave_instance in slap_configuration.get('slave-instance-list', []) %}
{%-   if slave_instance.get('_', '') != '' %}
{%-     set slave = json_module.loads(slave_instance.pop('_')) %}
{%-   else %}
{%-     set slave = slave_instance %}
{%-   endif %}
{%-   if slave.get('subdomain', '') != '' %}
{%-     do filtered_slave_instance_list.append(slave) %}
{%-   endif %}
{%- endfor %}

{% for i, slave in enumerate(filtered_slave_instance_list) -%}
address=/{{ slave['subdomain'] }}.{{ slap_configuration['configuration'].get('local_domain', '') }}/{{ slave.get('ip', '') }}
{% endfor -%}
{% endif %}

{%- for (ru_ref, iru) in iru_dict|dictsort | selectattr('1._.cpri_link', 'defined') %}
{%-   set ru = iru['_'] %}
{%-   set ru_tap = ru.cpri_link._tap  %}
{%-   set vtap = json_module.loads(vtap_jdict[ru_tap])  %}

# {{ ru_ref }} @ {{ ru_tap }}
dhcp-leasefile={{ directory['etc'] }}/dnsmasq.leases
port=5354
dhcp-range=::1,::1,constructor:{{ ru_tap }},ra-names,64,5m
dhcp-host={{ ru.mac_addr }},[{{ vtap[ru_tap].gateway }}]
{# XXX kill  dhcp-option=option6:dns-server,[{{ netaddr.IPAddress(slap_configuration.get('tap-ipv6-gateway', '')) + 1 }}],[{{ netaddr.IPAddress(slap_configuration.get('tap-ipv6-gateway', '')) + 2 }}]  #}
{# XXX kill  dhcp-option=option6:domain-search,bbu.local  #}
# option 17 used for RU callhome
# dhcp-option=option6:17,[{{ vtap[ru_tap].addr }}]
{%- endfor %}

log-queries
log-dhcp
log-facility={{ directory['home'] }}/var/log/dnsmasq.log
enable-ra
ra-param=adv-send-advert
ra-param=adv-managed-flag
ra-param=adv-other-config-flag
ra-param=adv-autonomous

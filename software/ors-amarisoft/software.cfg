[buildout]
extends =
  buildout.hash.cfg
  ../../stack/slapos.cfg
  ../../stack/monitor/buildout.cfg
  ../../component/logrotate/buildout.cfg
  ../../component/nghttp2/buildout.cfg
  ../../component/iperf3/buildout.cfg
  ../../component/python3/buildout.cfg
  ../../component/python-pynacl/buildout.cfg
  ../../component/bcrypt/buildout.cfg

parts +=
  template
  slapos-cookbook
  ltelogs.jinja2.sh
# copy all configs by default
  mme.jinja2.cfg
  ims.jinja2.cfg
  enb.jinja2.cfg
  gnb.jinja2.cfg
  ue_db.jinja2.cfg
  ue-lte.jinja2.cfg
  ue-nr.jinja2.cfg
  sib23.asn
# copy all gadget file
  g-chart.line.js
  promise.gadget.js
  software.cfg.html
  iperf3
  eggs

# unimplemented parts - the http monitor and better log handling using logrotate
#  apache-php
#  logrotate

[template]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/${:filename}
output = ${buildout:directory}/template.cfg

[download-base]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:_update_hash_filename_}

[amarisoft-stats.jinja2.py]
<= download-base

[amarisoft-rf-info.jinja2.py]
<= download-base

[lopcomm-rrh-stats.jinja2.py]
<= download-base

[template-lte-enb-epc]
<= download-base

[template-lte-gnb-epc]
<= download-base

[template-lte-epc]
<= download-base

[template-lte-enb]
<= download-base

[template-lte-gnb]
<= download-base

[template-lte-mme]
<= download-base

[template-lte-ue-lte]
<= download-base

[template-lte-ue-nr]
<= download-base

[copy-to-instance]
recipe  = slapos.recipe.build:download
url     = ${:_profile_base_location_}/${:_buildout_section_name_}

[copy-config-to-instance]
recipe  = slapos.recipe.build:download
url     = ${:_profile_base_location_}/config/${:_buildout_section_name_}

[gadget-directory]
recipe = slapos.recipe.build
location = ${buildout:directory}/gadget
install =
  import os
  os.mkdir(location)

[copy-gadget-to-software]
recipe      = slapos.recipe.build:download
url         = ${:_profile_base_location_}/gadget/${:_buildout_section_name_}
destination = ${gadget-directory:location}/${:_buildout_section_name_}

[enb.jinja2.cfg]
<= copy-config-to-instance
filename = enb.jinja2.cfg
[sib23.asn]
<= copy-config-to-instance
filename = sib23.asn
[gnb.jinja2.cfg]
<= copy-config-to-instance
filename = gnb.jinja2.cfg
[ltelogs.jinja2.sh]
<= copy-to-instance
filename = ltelogs.jinja2.sh
[ue_db.jinja2.cfg]
<= copy-config-to-instance
filename = ue_db.jinja2.cfg
[mme.jinja2.cfg]
<= copy-config-to-instance
filename = mme.jinja2.cfg
[ims.jinja2.cfg]
<= copy-config-to-instance
filename = ims.jinja2.cfg
[ue-lte.jinja2.cfg]
<= copy-config-to-instance
filename = ue-lte.jinja2.cfg
[ue-nr.jinja2.cfg]
<= copy-config-to-instance
filename = ue-nr.jinja2.cfg

# Download gadget files
[software.cfg.html]
<= copy-gadget-to-software
[promise.gadget.js]
<= copy-gadget-to-software

[renderjs.js]
<= copy-gadget-to-software
url = https://lab.nexedi.com/nexedi/renderjs/raw/master/dist/renderjs-latest.js
md5sum = 7e074a29b07e0045d2ba8a8e63bd499e

[rsvp.js]
<= copy-gadget-to-software
url = https://lab.nexedi.com/nexedi/rsvp.js/raw/master/dist/rsvp-2.0.4.js
md5sum = 2b0f2d52857b17fdfb8a5c2ea451a5ad

[g-chart.line.js]
<= copy-gadget-to-software

[eggs]
recipe = zc.recipe.egg
eggs =
  websocket-client
  ${python-pynacl:egg}
  ${bcrypt:egg}
  xmltodict
  ncclient
interpreter = pythonwitheggs

[versions]
websocket-client = 1.4.2
ncclient = 0.6.13
xmltodict = 0.13.0

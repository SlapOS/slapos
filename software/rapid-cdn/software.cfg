[buildout]
extends =
  buildout.hash.cfg
  ../../stack/caucase/buildout.cfg
  ../../stack/slapos.cfg
  ../../component/python3/buildout.cfg

parts +=
  caucase-eggs
  template
  kedifa

#[python]
#part = python3

[template-render-base]
recipe = slapos.recipe.template:jinja2
template = ${:_profile_base_location_}/${:filename}
rendered = ${buildout:directory}/${:_buildout_section_name_}.cfg
mode = 0644
context =
  section software_parameter_dict software-parameter-section
  ${:extra-context}
extra-context =

[template]
<= template-render-base

[template-common]
<= template-render-base

[template-download-base]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:filename}
mode = 0644

[template-rapid-cdn-frontend]
<= template-download-base

[template-rapid-cdn-human]
<= template-download-base

[template-rapid-cdn-kedifa]
<= template-download-base

[template-rapid-cdn-log-aggregator]
<= template-download-base

[kedifa]
recipe = zc.recipe.egg
eggs =
  ${python-cryptography:egg}
  kedifa

[software-parameter-section]
# This section passes binaries and other software provided outputs to all
# profiles. In the same time allows to gather all parameters in one place.

# Buildout parameters
develop-eggs-directory = ${buildout:develop-eggs-directory}
eggs-directory = ${buildout:eggs-directory}

# Software
bin-directory = ${buildout:bin-directory}
dash = ${dash-output:dash}
kedifa = ${kedifa:bin-directory}/kedifa
kedifa-updater = ${kedifa:bin-directory}/kedifa-updater
openssl = ${openssl:location}/bin/openssl
openssl_cnf = ${openssl:location}/etc/ssl/openssl.cnf

# Libraries
caucase-jinja2-library = ${caucase-jinja2-library:target}

# Templates
template-common = ${template-common:rendered}
template-monitor2 = ${monitor2-template:rendered}
template-rapid-cdn-frontend = ${template-rapid-cdn-frontend:target}
template-rapid-cdn-human = ${template-rapid-cdn-human:target}
template-rapid-cdn-kedifa = ${template-rapid-cdn-kedifa:target}
template-rapid-cdn-log-aggregator = ${template-rapid-cdn-log-aggregator:target}

[versions]
kedifa = 0.0.5
# modernish zc.lockfile is required by kedifa
zc.lockfile = 1.4

[buildout]
extends =
  ../../component/rust/buildout.cfg
  ../../stack/caucase/buildout.cfg
  ../../stack/slapos.cfg
  buildout.hash.cfg

parts =
  slapos-cookbook
  caucase-eggs
  instance.cfg.in

[zdaemon]
recipe = zc.recipe.egg
egg = ${:_buildout_section_name_}

[dufs]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/sigoden/dufs/archive/refs/tags/v0.31.0.tar.gz
md5sum = 4340e59915605e30dcdb70aa9eb06acb
configure-command = :
make-binary = cargo install --root=%(location)s --path .
make-targets =
environment =
  PATH=${rustc:location}/bin:%(PATH)s


[instance.cfg.in]
recipe = slapos.recipe.template:jinja2
output = ${buildout:directory}/instance.cfg
url = ${:_profile_base_location_}/${:filename}
context =
  section buildout buildout
  raw openssl_bin ${openssl:location}/bin/openssl
  raw dash_bin ${dash:location}/bin/dash
  raw curl_bin ${curl:location}/bin/curl
  raw dufs_bin ${dufs:location}/bin/dufs
  raw zdaemon_bin ${buildout:bin-directory}/${zdaemon:egg}
  key template_monitor monitor2-template:output
import-list =
  file caucase caucase-jinja2-library:target

[buildout]

extends =
  ../../stack/slapos.cfg
  ../../software/caddy/software.cfg
  ../../software/fluentd/software.cfg

parts =
  slapos-cookbook
  eggs
  caddy
  fluentd
  instance-profile
  template-runTestSuite
  template-fluentdConfig
  
  

[instance-profile]
recipe = slapos.recipe.template
md5sum = 45c4adaae557bed5c25c24f4c4506b3d
url = ${:_profile_base_location_}/instance.cfg.in
output = ${buildout:directory}/instance.cfg
mode = 0644

[template-runTestSuite]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/runTestSuite.in
#md5sum = ff66d13f73982e8257eb5535cdb541c7
output = ${buildout:directory}/runTestSuite.in
mode = 0644

[eggs]
recipe = zc.recipe.egg
eggs =
  erp5.util
  selenium
  ${lxml-python:egg}
interpreter = pythonwitheggs

[template-fluentdConfig]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/fluentd-conf.cnf.in
#md5sum = ff66d13f73982e8257eb5535cdb541c7
output = ${buildout:directory}/fluentd-conf.cnf.in
mode = 0644

[fluentd]
gems +=
  fluent-plugin-wendelin==0.3
  fluent-plugin-bin

[template-caddy-service]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/template-caddy-service.sh.in
md5sum = 0119e5b6126215204c04285c2389fe1f
output = ${buildout:directory}/template-caddy-service.sh.in
mode = 0644

[template-caddyfile]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/Caddyfile.in
md5sum = 3132b99d65c75b72fc6dacb702ddca0b
filename = Caddyfile.in
location = ${buildout:parts-directory}/${:_buildout_section_name_}
mode = 0644

[template-caddy-fluentd]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance-caddy-fluentd.cfg.in
md5sum = 33652e8cdbf244911fc861c901a10af4
output = ${buildout:directory}/instance-caddy-fluentd.cfg.in
mode = 0644

[caddy]
recipe  = slapos.recipe.cmmi
path    = ${go_github.com_mholt_caddy:location}
go      = ${gowork:golang}/bin/go
configure-command = :
make-targets =
make-binary = cd ${:path}/caddy  && ${:go} install -v
environment =
  PATH=${pkgconfig:location}/bin:${gowork:golang}/bin:${buildout:bin-directory}:%(PATH)s
  GOPATH=${gowork:directory}
output =  ${gowork:bin}/caddy

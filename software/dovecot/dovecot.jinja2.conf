protocols = " imap lmtp pop3"
auth_debug = yes
auth_mechanisms = plain login
auth_username_format = %n
auth_verbose = yes
base_dir = {{ directory['run'] }}

default_internal_user = {{ slap_configuration.['user-name'] }}
default_login_user = {{ slap_configuration.['user-name'] }}
default_internal_group = {{ slap_configuration.['user-name'] }}

disable_plaintext_auth = no
mail_location = maildir:~/Maildir
mail_debug = yes

service anvil {
  chroot =
}
service imap-login {
  chroot =
}
service pop3-login {
  chroot =
}
service imap-login {
  inet_listener imap {
    port = 10143
  }
  inet_listener imaps {
    port = 10993
  }
}
service auth {
  unix_listener {{ postfix_auth }} {
    mode = 0660
    # Assuming the default Postfix user and group
    user = postfix
    group = postfix
  }
}
service lmtp {
  unix_listener {{ postfix_dovecot_lmtp }} {
    group = postfix
    mode = 0600
    user = postfix
  }
}
log_path = {{ directory['log'] }}/dovecot.log


namespace inbox {
  inbox = yes
  location =
  mailbox Drafts {
    special_use = \Drafts
  }
  mailbox Junk {
    special_use = \Junk
  }
  mailbox Sent {
    special_use = \Sent
  }
  mailbox "Sent Messages" {
    special_use = \Sent
  }
  mailbox Trash {
    special_use = \Trash
  }
  prefix =
}

ssl = no

passdb {
  args = {{ dovecot_passwd }}
  driver = passwd-file
}
userdb {
  driver = passwd
  args = uid={{ slap_configuration.['user-name'] }} gid={{ slap_configuration.['user-name'] }} home=/home/%u
}

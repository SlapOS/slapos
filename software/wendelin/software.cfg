[buildout]
versions = versions
extends =
  ../../component/msgpack-python/buildout.cfg
  ../../component/msgpack-numpy/buildout.cfg
  ../../component/scipy/buildout.cfg
  ../../software/erp5/software.cfg
parts +=
  wendelin
  scipy
  msgpack-python
  msgpack-numpy
  ipython
  jupyter
  jupyter-notebook-initialized-scripts

[eggs]
initialization =
  import scipy.spatial.ckdtree # load our own libstdc++ explicitly at the very beginning
extra-paths +=
  ${wendelin:location}
eggs +=
  astor
  ${scipy:egg}
  ${msgpack-python:egg}
  ${msgpack-numpy:egg}
  ${ipython:egg}

[generic_testrunner_init]
recipe = slapos.recipe.build
init =
  import struct
  gcc = self.buildout['gcc']
  options['initialization'] %= (
    gcc['prefix'] + '/lib%s/libstdc++.so' % (8 * struct.calcsize("P"))
    ) if 'part' in gcc else ''
initialization =
  # The 4 lines below will replace the process with another one, with the proper
  # LD_PRELOAD environment variable. This is necessary because LD_PRELOAD is only
  # taken into account when the process starts. Modifying it in runtime doesn't
  # work.
  import os
  if not os.getenv('LD_PRELOAD'):
    os.environ['LD_PRELOAD'] = %r
    os.execve(os.path.realpath(__file__), sys.argv, os.environ)

[test_suite_runner]
# we need to override the test suite runner to add our custom libstdc++ dynamic
# library to the path
initialization +=
  ${generic_testrunner_init:initialization}

[testrunner]
# we need to override the test suite runner to add our custom libstdc++ dynamic
# library to the path
initialization +=
  ${generic_testrunner_init:initialization}

[erp5_repository_list]
repository_id_list += wendelin

[default-bt5]
list =
  erp5_full_text_mroonga_catalog
  erp5_wendelin_configurator

[local-bt5-repository]
list += ${wendelin:location}/bt5

# Jupyter is by default enabled in Wendelin
# and also the soft limit of open file descriptors is set
# to the hard limit.
[erp5-defaults]
jupyter-enable-default = true
with-max-rlimit-nofile-enable-default = true

[wendelin]
recipe = slapos.recipe.build:gitclone
git-executable = ${git:location}/bin/git
repository = https://lab.nexedi.com/nexedi/wendelin.git
branch = master

[versions]
msgpack-numpy = 0.4.4.3


# Test Suite: Wendelin.UnitTest-Master ran at 2024/11/26 11:40:42.979966 UTC
#             0 failures, 0 errors, 73 total, status: PASS

[slapos]
revision = 275ef4b069ad6b46e58fc3b8a70d38ddd5f98aae


[erp5]
revision = 0236f68bd9fda5ff7b34e47bb06135c3643c4145


[wendelin]
revision = e99df425a44301ee7fa0e69548eced931a52b50d


[wendelin.core]
revision = db6fea3d313a0c9e12ba5cb156adf6ab5db6d9cb


[erp5-bin]
revision = 073f7f6498d0bd5e45ed3c3beaa21cfdb34244ea


[erp5-doc]
revision = 3996ae1f832ca438ead9fbcf0ab8082dd1d22021


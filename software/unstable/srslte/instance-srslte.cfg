[buildout]

extends = {{ monitor_template_output }}

parts =
 config-drb
 config-enb
 config-epc
 config-mbms
 config-rr
 config-sib
 config-ue
 config-user_db
 srsepc
 srsenb
 monitor-base
 publish-connection-information

eggs-directory = {{ eggs_directory }}
develop-eggs-directory = {{ develop_eggs_directory }}
offline = true

[directory]
srsconfig = $${buildout:directory}/.srs

[config-base]
recipe = slapos.recipe.template:jinja2
extensions = jinja2.ext.do
context =
  section directory directory

[config-drb]
<= config-base
url = {{ config_drb_template }}
output = $${directory:srsconfig}/drb.conf

[config-enb]
<= config-base
url = {{ config_enb_template }}
output = $${directory:srsconfig}/enb.conf

[config-epc]
<= config-base
url = {{ config_epc_template }}
output = $${directory:srsconfig}/epc.conf

[config-mbms]
<= config-base
url = {{ config_mbms_template }}
output = $${directory:srsconfig}/mbms.conf

[config-rr]
<= config-base
url = {{ config_rr_template }}
output = $${directory:srsconfig}/rr.conf

[config-sib]
<= config-base
url = {{ config_sib_template }}
output = $${directory:srsconfig}/sib.conf

[config-ue]
<= config-base
url = {{ config_ue_template }}
output = $${directory:srsconfig}/ue.conf

[config-user_db]
<= config-base
url = {{ config_user_db_template }}
output = $${directory:srsconfig}/user_db.csv

[srsepc]
recipe = slapos.cookbook:wrapper
wrapper-path = $${directory:services}/$${:_buildout_section_name_}
pidfile = $${directory:run}/srsepc.pid
command-line =
  /usr/bin/sudo {{ srsepc_bin }}

[srsenb]
recipe = slapos.cookbook:wrapper
wrapper-path = $${directory:services}/$${:_buildout_section_name_}
pidfile = $${directory:run}/srsenb.pid
command-line =
  /usr/bin/sudo {{ srsenb_bin }}

[publish-connection-information]
recipe = slapos.cookbook:publish
monitor-setup-url = https://monitor.app.officejs.com/#page=settings_configurator&url=$${monitor-publish-parameters:monitor-url}&username=$${monitor-publish-parameters:monitor-user}&password=$${monitor-publish-parameters:monitor-password}

#!/bin/sh

# Sign a single certificate if not exists yet
BASE_DIR={{ base_directory }}

sign_cert() {
  BASE_DOMAIN=$1
  DOMAINS=$2
  if [ -s "$BASE_DIR/certs/$BASE_DOMAIN/fullchain.pem" ]; then
    exit 0;
  fi
  {{ dehydrated_wrapper }} --domain $DOMAINS --lock-suffix $BASE_DOMAIN
}

{% for domain_string in domain_list -%}
sign_cert {{ domain_string.split(' ')[0] }} "{{ domain_string }}"
{% endfor -%}

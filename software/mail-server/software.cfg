[buildout]
extends =
  ../../component/xz-utils/buildout.cfg
  ../../component/postfix/buildout.cfg
  ../../component/dovecot/buildout.cfg
  ../../component/logrotate/buildout.cfg
  ../../stack/monitor/buildout.cfg
  ../../component/apache-php/buildout.cfg
  buildout.hash.cfg
  ../../stack/slapos.cfg

parts =
  slapos-cookbook
  template
  dovecot
  postfix
  apache-php

[template]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/${:filename}
output = ${buildout:directory}/template.cfg

[template-default]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/${:_update_hash_filename_}
output = ${buildout:directory}/instance-default.cfg.jinja2

[template-download-base]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:filename}

[template-apache.conf]
<= template-download-base

[template-php.ini]
<= template-download-base

[template-apache-httpd]
<= template-download-base

[template-snappymail.jinja2.ini]
<= template-download-base

[template-snappymail-domain.jinja2.json]
<= template-download-base

[copy-to-instance]
recipe   = slapos.recipe.build:download
url      = ${:_profile_base_location_}/${:_buildout_section_name_}
filename = ${:_buildout_section_name_}

[dovecot.jinja2.conf]
< = copy-to-instance

[password.php.in]
< = copy-to-instance

[postfix_main.jinja2.cf]
< = copy-to-instance

[postfix_master.jinja2.cf]
< = copy-to-instance

[postfix_relays.in]
< = copy-to-instance

[snappymail]
url = https://github.com/the-djmaze/snappymail/releases/download/v2.38.2/snappymail-2.38.2.tar.gz
md5sum = 551af7a01691f8d988c16aa73c75e686
recipe = slapos.recipe.build:download-unpacked
archive-root =

[copy-at-root]
<= copy-to-instance
destination = ${buildout:directory}/${:_buildout_section_name_}

[software.cfg.json]
<= copy-at-root

[instance-default-input-schema.json]
<= copy-at-root

[instance-slave-input-schema.json]
<= copy-at-root

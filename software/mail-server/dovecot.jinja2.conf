protocols = " imap lmtp pop3"
auth_debug = yes
auth_mechanisms = plain login
auth_username_format = %Lu
auth_verbose = yes
auth_debug_passwords = yes
auth_verbose_passwords = yes
base_dir = {{ dovecot_directory['run'] }}
state_dir = {{ dovecot_directory['var'] }}
mail_temp_dir = {{ dovecot_directory['tmp'] }}

default_internal_user = {{ user_name }}
default_login_user = {{ user_name }}
default_internal_group = {{ user_name }}

disable_plaintext_auth = no
mail_location = maildir:~/Maildir
mail_debug = yes

service anvil {
  chroot =
}
service imap-login {
  chroot =
}
service pop3-login {
  chroot =
  inet_listener pop3 {
    port = 10110
  }
  inet_listener pop3s {
    port = 10995
  }
}
service imap-login {
  inet_listener imap {
    port = {{ imap_port }}
  }
  inet_listener imaps {
    port = 10993
  }
}
service auth {
  unix_listener {{ postfix_auth }} {
    mode = 0660
    user = {{ user_name }}
    group = {{ user_name }}
  }
}
service lmtp {
  unix_listener {{ postfix_dovecot_lmtp }} {
    user = {{ user_name }}
    group = {{ user_name }}
    mode = 0600
  }
}
log_path = {{ directory['log'] }}/dovecot.log


namespace inbox {
  inbox = yes
  location =
  mailbox Drafts {
    special_use = \Drafts
  }
  mailbox Junk {
    special_use = \Junk
  }
  mailbox Sent {
    special_use = \Sent
  }
  mailbox "Sent Messages" {
    special_use = \Sent
  }
  mailbox Trash {
    special_use = \Trash
  }
  prefix =
}

ssl = no
passdb { 
  driver = passwd-file
  args = scheme=PLAIN username_format=%u {{ dovecot_passwd }}
}

userdb {
    driver = passwd-file
    args = username_format=%u {{ dovecot_passwd }}
    default_fields = uid={{ user_name }} gid={{ user_name }} home={{ dovecot_directory['home'] }}/%d/%n
}
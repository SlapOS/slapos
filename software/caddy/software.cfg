[buildout]
extends =
  ../../component/caddy/buildout.cfg
  ../../stack/slapos.cfg
  ../../component/dash/buildout.cfg

parts =
  golang19
  slapos-cookbook
  instance-profile
  template-caddy-service
  template-caddy
  caddy

[instance-profile]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance.cfg.in
md5sum = ae83c35995ce14432ded78ca30cab61b
output =${buildout:directory}/instance.cfg
filename = instance.cfg
mode = 0644

[gopath]
directory = ${buildout:directory}/go.work
src	= ${:directory}/src
bin	= ${:directory}/bin

[template-caddy-service]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/template-caddy-service.sh.in
md5sum = 61da5aea191595962ab020b4197b5390
output = ${buildout:directory}/template-caddy-service.sh.in
mode = 0644

[template-Caddyfile]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/Caddyfile.in
md5sum = c3ad1c9ea830dab84fa18bd58b5dc2ed
output = ${buildout:directory}/Caddyfile.in
mode = 0644

[template-caddy]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance-caddy.cfg.in
md5sum = 3c9c4ef2963a57e5a68188f00a5938b9
output = ${buildout:directory}/instance-caddy.cfg.in
mode = 0644


[caddy]
recipe  = slapos.recipe.cmmi
path    = ${caddy-repository:location}
go      = ${golang19:location}/bin/go
configure-command = cd ${:path}/caddy && ${:go} get -v
make-targets =
make-binary = cd ${:path}/caddy && ${:go} install -v
environment =
  PATH=${pkgconfig:location}/bin:${golang19:location}/bin:${buildout:bin-directory}:%(PATH)s
  GOPATH=${gopath:directory}
path-to-bin =  ${gopath:bin}/caddy
[buildout]
extends =
    ../../stack/lamp/buildout.cfg
    ../../stack/slapos.cfg
parts =
    slapos-cookbook
    instance
# to create file instance-matomo.cfg in instance of apache-php
    template-matomo-instance

#to make sure we use python3
[python]
part = python3

[application]
url = https://builds.matomo.org/matomo-4.7.1.zip
md5sum = 8d592676bc2c0d51363ad7b2caf171fe

[custom-application-deployment]
path = ${template-matomo-instance:rendered}
part-list = matomo-backup.sh matomo-apache-httpd

[matomo-download]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:filename}

[template-matomo-instance]
recipe = slapos.recipe.template:jinja2
template = ${:_profile_base_location_}/${:filename}
rendered = ${buildout:directory}/instance-matomo.cfg
extensions = jinja2.ext.do
context =
    key gzip_location gzip:location
    key python3_location python3:location
    key php_location apache-php:location
    key matomo_backup_sh template-matomo-backup.sh:target
    key matomo_apache_httpd template-apache-httpd:target

# download matomo-backup.sh.in
[template-matomo-backup.sh] 
<= matomo-download

#download apache-httpd.conf.in
[template-apache-httpd]
<= matomo-download



[buildout]

extends =
  ../../stack/slapos.cfg
  ../../component/autoconf/buildout.cfg
  ../../component/flex/buildout.cfg
  ../../component/fonts/buildout.cfg
  ../../component/noVNC/buildout.cfg
  ../../component/shellinabox/buildout.cfg
  ../../component/nginx/buildout.cfg
  ../../component/lxml-python/buildout.cfg
  ../../component/numpy/buildout.cfg
  ../../component/numpy/openblas.cfg
  ../../component/matplotlib/buildout.cfg
  ../../component/wxpython/buildout.cfg
  ../../component/matiec/buildout.cfg
  ../../component/mesa/buildout.cfg
  ../../component/wxwidgets/buildout.cfg
  ../../component/libvnc/buildout.cfg
  ../../component/open62541/buildout.cfg
  ../../component/sikuli/buildout.cfg
  ../../component/fluxbox/buildout.cfg
  ../../component/pygolang/buildout.cfg
  ../../stack/monitor/buildout.cfg
  ../../stack/nxdtest.cfg
  ./buildout.hash.cfg

parts +=
  slapos-cookbook
  beremiz-eggs
  open62541
  Modbus
  instance

[gcc]
# Always build GCC for Fortran (see openblas).
max_version = 0

[python]
part = python2.7

[open62541]
# Beremiz need it to be in folder parts/open62541
shared = false
post-install =
  mkdir -p @@LOCATION@@/build/bin
  ln -sf @@LOCATION@@/lib/libopen62541.a @@LOCATION@@/build/bin/libopen62541.a

[beremiz-eggs]
recipe = zc.recipe.egg
eggs =
  ${wxPython:egg}
  ${python-cryptography:egg}
  ${lxml-python:egg}
  ${matplotlib:egg}
  future
  websockify
  zeroconf2
  enum34
  pyro
  twisted
  nevow
  autobahn
  pycountry
  fonttools
  ${beremiz-setup:egg}
  opcua
  msgpack

[python-interpreter]
recipe = zc.recipe.egg:scripts
interpreter = python
eggs =
  ${beremiz-eggs:eggs}
  ${pygolang:egg}
# Beremiz will use sys.executable to start some internal processes
# then they won't have installed eggs in sys.path.
# -> use pymain from gpython to workaround that and generate
# python where sys.executable point to interpreter
initialization =
  from gpython import pymain
  pymain(sys.argv)
  sys.exit(0)

[beremiz]
recipe = slapos.recipe.build:download-unpacked
# download beremiz at revision bc72db1aa49fb5deabc950ed587772d027733a26
url = https://github.com/beremiz/beremiz/archive/bc72db1aa49fb5deabc950ed587772d027733a26.tar.gz
md5sum = 9ae7a55d4f2e673cbc8d2c4528e069b9

[beremiz-setup]
recipe  = zc.recipe.egg:develop
egg = beremiz
setup = ${beremiz:location}

[download-template]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:filename}

[instance]
recipe = slapos.recipe.template:jinja2
rendered = ${buildout:directory}/instance.cfg
template = ${:_profile_base_location_}/${:filename}
python-bin = ${buildout:bin-directory}/${python-interpreter:interpreter}
type = beremiz
context =
    key autoconf_location  autoconf:location
    key automake_location  automake:location
    key bash_location bash:location
    key beremiz_location beremiz-setup:setup
    key bin_directory buildout:bin-directory
    key buildout_egg_directory buildout:eggs-directory
    key buildout_develop_directory buildout:develop-eggs-directory
    key buildout_directory buildout:directory
    key template_fluxbox_menu template-fluxbox-menu.in:target
    key template_fonts_conf_target template-fonts-conf:output
    key template_monitor_cfg monitor2-template:rendered
    key template_instance_beremiz template-instance-beremiz:target
    key template_instance_beremiz_test template-instance-beremiz-test:target
    key template_logrotate template-logrotate-base:rendered
    key fontconfig_location fontconfig:location
    key font_dejavu dejavu-fonts:location
    key font_liberation liberation-fonts:location
    key logrotate_cfg template-logrotate-base:rendered
    key bison_location bison:location
    key flex_location flex:location
    key fluxbox_location fluxbox:location
    key gcc_location gcc:prefix
    key gtk3_location gtk-3:location
    key instance_template_type :type
    key matiec_location matiec:location
    key mesa_location mesa:location
    key novnc_location noVNC:location
    key nxdtest_template nxdtest-instance.cfg:rendered
    key python_bin :python-bin
    key openssl_location openssl:location
    key sikulix_bin sikuli:rendered
    key xserver_location xserver:location
    key x11vnc_location x11vnc:location
    key wmctrl_location wmctrl:location

[template-instance-beremiz]
<= download-template
output = ${buildout:directory}/instance-beremiz.cfg.jinja2

[template-instance-beremiz-test]
<= download-template
output = ${buildout:directory}/instance-beremiz-test.cfg.jinja2

[template-fluxbox-menu.in]
<= download-template
output = ${buildout:directory}/fluxbox-menu.in

[versions]
Pillow = 6.2.2
matplotlib = 2.2.5
kiwisolver = 1.1.0
cycler = 0.10.0
websockify = 0.9.0
Pyro = 3.16
zeroconf2 = 0.19.2
cython = 0.29.24
sphinx = 1.8.5
doc2dash = 2.3.0
Twisted = 20.3.0
autobahn = 19.11.2
attrs = 19.2.0
Automat = 0.3.0
zope.interface = 4.4.2
Nevow = 0.14.5
PyHamcrest = 2.0.3
constantly = 15.1.0
hyperlink = 21.0.0
incremental = 21.3.0
future = 0.18.2
pycountry = 18.12.8
fonttools = 3.44.0
idna = 2.10
PyHamcrest = 2.0.2
txaio = 18.8.1
characteristic = 14.3.0
typing = 3.10.0.0
ifcfg = 0.22
opcua = 0.98.13
futures = 3.3.0
trollius = 2.2.1

[buildout]
extends =
  buildout.hash.cfg
  ../../stack/slapos.cfg
  ../../component/bison/buildout.cfg
  ../../component/flex/buildout.cfg
  ../../component/cmake/buildout.cfg
  ../../component/make/buildout.cfg

parts =
  slapos-cookbook
  instance-profile
  fluent-bit-source
  fluent-bit

# Needed, because of ARMv7
[python]
part = python3

[instance-profile]
recipe = slapos.recipe.template:jinja2
template = ${:_profile_base_location_}/instance.cfg.in
rendered = ${buildout:directory}/instance.cfg
context =
  section buildout buildout
  key fluent_bit_source_location fluent-bit-source:location

[fluent-bit-source]
recipe = slapos.recipe.build:download-unpacked
url = https://github.com/fluent/fluent-bit/archive/refs/tags/v1.9.7.tar.gz
shared = true

[fluent-bit]
recipe = slapos.recipe.cmmi
path = ${fluent-bit-source:location}
environment =
  PATH=${bison:location}/bin:${flex:location}/bin:${fluent-bit-source:location}:%(PATH)s
destination = @@LOCATION@@
configure-command =
  ${cmake:location}/bin/cmake .
configure-options =
  -DFLB_CONFIG_YAML=Off
  -DCMAKE_INSTALL_PREFIX=@@LOCATION@@
make-binary =
  ${make:location}/bin/make

# Needed, because of the "Permission Denied!" error!
make-targets = 

[buildout]
extends =
  buildout.hash.cfg
  ../../stack/slapos.cfg
  ../../stack/monitor/buildout.cfg
  ../../component/make/buildout.cfg
  ../../component/fluent-bit/buildout.cfg

parts =
  slapos-cookbook
  instance-profile
  fluent-bit

# Needed, because of ARMv7
[python]
part = python3

[instance-profile]
recipe = slapos.recipe.template:jinja2
template = ${:_profile_base_location_}/instance.cfg.in
rendered = ${buildout:directory}/instance.cfg
context =
  section buildout buildout
  key fluent_bit_source_location fluent-bit-source:location

[fluent-bit]
recipe = slapos.recipe.cmmi
part = fluent-bit
make-binary = ${make:location}/bin/make
make-targets =

# Post-Install is needed, in order a shell command to be executed
# after the installation, in our case to copy the fluent-bit
# binary file from the source directory to the main directory.
post-install = cp ${fluent-bit-source:location}/bin/fluent-bit ../fluent-bit

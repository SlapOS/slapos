[buildout]
extends =
  buildout.hash.cfg
  ../../stack/slapos.cfg
  ../../component/cmake/buildout.cfg
  ../../component/make/buildout.cfg
  ../../component/bison/buildout.cfg
  ../../component/flex/buildout.cfg

parts =
  slapos-cookbook
  fluent-bit
  instance-profile

# we need to have bootstrap Python for buildout in Python3 explicitly for ARMv7 
[python]
part = python3

[instance-profile]
recipe = slapos.recipe.template:jinja2
template = ${:_profile_base_location_}/instance.cfg.in
rendered = ${buildout:directory}/instance.cfg
context =
  section buildout buildout
  key fluent_bit_location fluent-bit:location

[fluent-bit]
recipe = slapos.recipe.cmmi
url = https://github.com/fluent/fluent-bit/archive/refs/tags/v1.9.7.tar.gz
configure-command =
  ${cmake:location}/bin/cmake .
configure-options =
  -DFLB_CONFIG_YAML=Off
  -DCMAKE_INSTALL_PREFIX=${buildout:directory}/parts/fluent-bit
make-targets =
make-binary =
  make && make DESTDIR=${buildout:directory}/parts/fluent-bit install
environment =
  PATH=${bison:location}/bin:${flex:location}/bin:%(PATH)s

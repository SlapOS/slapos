LoadModule log_config_module modules/mod_log_config.so
LoadModule cache_module modules/mod_cache.so
LoadModule file_cache_module modules/mod_file_cache.so


Alias /web-public {{ parameters.runner_home }}/public
<Directory {{ parameters.runner_home }}/public>
    Order Allow,Deny
    Allow from all
    AllowOverride All
    Satisfy Any
    Options Indexes FollowSymLinks
    DirectoryIndex index.html
    <Files .htaccess>
        order allow,deny
        deny from all
    </Files>
</Directory>

Alias /shared {{ parameters.runner_home }}
<Directory {{ parameters.runner_home }}>
    DirectoryIndex disabled
    DAV On
    Options Indexes FollowSymLinks
    AuthType Basic
    AuthName "webdav"
    AuthUserFile "{{ parameters.etc_dir }}/monitor-htpasswd"
    <LimitExcept OPTIONS>
        Require valid-user
    </LimitExcept>
</Directory>


SetEnv GIT_HTTP_EXPORT_ALL
ScriptAlias /git/ {{ parameters.git_http_backend }}/
ScriptAlias /git-public/ {{ parameters.git_http_backend }}/

RewriteCond %{QUERY_STRING} service=git-receive-pack [OR]
RewriteCond %{REQUEST_URI} /git-receive-pack$

<LocationMatch "^/git/">
        SetEnv GIT_PROJECT_ROOT:{{ parameters.project_private_folder }}
        Order Deny,Allow
        Deny from env=AUTHREQUIRED

        AuthType Basic
        AuthName "Git Access"
        AuthUserFile "{{ parameters.etc_dir }}/monitor-htpasswd"
        Require valid-user
</LocationMatch>

<LocationMatch "^/git-public/">
        SetEnv GIT_PROJECT_ROOT:{{ parameters.project_public_folder }}
        Order Deny,Allow
        Deny from env=AUTHREQUIRED

        AuthType Basic
        AuthName "Git Access"
        AuthUserFile "{{ parameters.etc_dir }}/monitor-htpasswd"
        Require valid-user
        Satisfy any
</LocationMatch>


[buildout]
extends =
    ../../component/java/buildout.cfg
    ../../component/xz-utils/buildout.cfg
    ../../component/gzip/buildout.cfg
    ../../component/mariadb/buildout.cfg
    ../../stack/erp5/buildout.cfg
    ../../stack/slapos.cfg

parts =
  slapos-cookbook
  instance


[vanilla]
recipe = slapos.recipe.build:download-unpacked
url = http://dl.bpm-conseil.com/v8/Server/vanilla-jetty-8.0_GA.zip
md5sum = 4edbe7c93250c9bce683d17a5f20c4fa

[instance]
recipe = slapos.recipe.template:jinja2
output = ${buildout:directory}/instance.cfg
url = ${:_profile_base_location_}/${:filename}
context =
    key bash_location bash:location
    key bin_directory buildout:bin-directory
    key buildout_egg_directory buildout:eggs-directory
    key buildout_develop_directory buildout:develop-eggs-directory
    key buildout_directory buildout:directory
    key gzip_location gzip:location
    key xz_utils_location xz-utils:location
    key findutils_location findutils:location
    key template_logrotate template-logrotate-base:output
    key logrotate_cfg template-logrotate-base:output
    key vanilla_location vanilla:location
    key java_location java:location
    key template_mariadb template-mariadb:target
    key template_mariadb_initial_setup template-mariadb-initial-setup:target
    key template_mysqld_wrapper template-mysqld-wrapper:output
    key template_my_cnf template-my-cnf:target
    key template_vanilla_properties template-vanilla-properties:target
    key unixodbc_location unixodbc:location
    key mariadb_link_binary template-mariadb:link-binary
    key mariadb_location mariadb:location
    key mariadb_resiliency_after_import_script mariadb-resiliency-after-import-script:target
    key mariadb_slow_query_report_script mariadb-slow-query-report-script:target
    key mariadb_start_clone_from_backup mariadb-start-clone-from-backup:target
    key mroonga_mariadb_install_sql mroonga-mariadb:install-sql
    key mroonga_mariadb_plugin_dir mroonga-mariadb:plugin-dir
    key groonga_plugin_dir groonga:groonga-plugin-dir
    key groonga_mysql_normalizer_plugin_dir groonga-normalizer-mysql:groonga-plugin-dir
    key percona_toolkit_location percona-toolkit:location


[template-vanilla-properties]
<= download-template
output = ${buildout:directory}/vanilla.properties.in

[erp5]
# disable this section
recipe =

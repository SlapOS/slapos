[buildout]
extends =
  buildout.hash.cfg
  https://lab.nexedi.com/nexedi/slapos/raw/1.0.387/component/gzip/buildout.cfg
  https://lab.nexedi.com/nexedi/slapos/raw/1.0.387/software/kvm/software.cfg
parts =
  python-with-eggs
  template-deploy-test
  runTestSuite_py
  playbook

[runTestSuite_py]
recipe = zc.recipe.egg
eggs =
  erp5.util
  requests
interpreter = ${:_buildout_section_name_}

[playbook]
recipe = plone.recipe.command
stop-on-error = true
environment = export PATH=${tar:location}/bin:${gzip:location}/bin:$PATH
location = ${buildout:parts-directory}/${:_buildout_section_name_}
output = ${:location}/playbook.tar.gz
command =
  ${:environment}
  rm -fr ${:location}
  mkdir -p ${:location}
  cd ${slapos-package:location}/playbook
  tar czf ${:output} .
update-command = ${:command}

[test-location]
base = ${slapos-package:location}

[slapos-package]
recipe = slapos.recipe.build:gitclone
repository = https://lab.nexedi.com/nexedi/slapos.package.git
branch = cdn-test
git-executable = ${git:location}/bin/git

[template]
output = ${buildout:directory}/template-original.kvm.cfg

[deploy-script-controller-script]
location = ${:_profile_base_location_}/${:filename}

[standalone-local-playbook]
filename = standalone-local-playbook
location = ${:_profile_base_location_}/${:filename}

[template-deploy-test]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/${:filename}
output = ${buildout:directory}/template.cfg

[download]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:filename}

[instance-deploy-test.cfg.jinja2]
<= download

[versions]
erp5.util = 0.4.69

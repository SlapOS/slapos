[buildout]

eggs-directory = {{ eggs_directory }}
develop-eggs-directory = {{ develop_eggs_directory }}
offline = true

parts =
  request-kvm

[request-kvm]
<= slap-connection

recipe = slapos.cookbook:request
software-url = ${slap-connection:software-release-url}
software-type = kvm
name = test-kvm
sla-computer_guid = ${slap-connection:computer-id}

# Tested image
# Passed by request
config-virtual-hard-drive-url = {{ slapparameter_dict['image-to-test-url'] }}
config-virtual-hard-drive-md5sum = {{ slapparameter_dict['image-to-test-md5sum'] }}
config-virtual-hard-drive-gzipped = {{ slapparameter_dict.get('image-to-test-gzipped', 'False') }}

# The test script
config-bootstrap-script-url = file://{{ in_vm_test_script }}#{{ in_vm_test_script_md5 }}

# Script configuration
config-data-to-vm =
  SLAPOS_TEST_COMPUTER_TOKEN=GENERATE_ME

# require HTTP server
config-enable-http-server = true

# VM options
config-ram-size = 4096
config-cpu-count = 2

# await for system to be ready
return =
  url
  backend-url
  ipv6
  nat-rule-port-tcp-443
  nat-rule-port-tcp-80

[directory]
recipe = slapos.cookbook:mkdirectory
home = ${buildout:directory}
etc = ${:home}/etc/
var = ${:home}/var/
srv = ${:home}/srv/
bin = ${:home}/bin/
tmp = ${:home}/tmp/
log = ${:var}/log/
services = ${:etc}/service/
scripts = ${:etc}/run/

[buildout]

extends =
  ../../../../stack/slapos.cfg
  ../../../../software/caddy/software.cfg
  ../../../../software/fluentd/software.cfg

index = https://pypi.python.org/simple/

parts =
  slapos-cookbook
  eggs
  caddy
  fluentd
  fluentd-plugin-dev-repository
  instance-profile
  template-runTestSuite
  template-fluentdConfig
  

[instance-profile]
recipe = slapos.recipe.template
md5sum = 45c4adaae557bed5c25c24f4c4506b3d
url = ${:_profile_base_location_}/instance.cfg.in
output = ${buildout:directory}/instance.cfg
mode = 0644

[template-runTestSuite]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/runTestSuite.in
#md5sum = ff66d13f73982e8257eb5535cdb541c7
output = ${buildout:directory}/runTestSuite.in
mode = 0644

[template-test]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/testIngestion.py
#md5sum = ff66d13f73982e8257eb5535cdb541c7
output = ${buildout:directory}/testIngestion.py
mode = 0644

[eggs]
recipe = zc.recipe.egg
eggs =
  erp5.util
  ${lxml-python:egg}
  requests
interpreter = pythonwitheggs

[template-fluentdConfig]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/fluentd-conf.cnf.in
md5sum = fd896793455e1d04082449212d285b55
filename = fluentd-conf.cnf.in
location = ${buildout:parts-directory}/${:_buildout_section_name_}
mode = 0644

[fluentd-plugin-dev-repository]
recipe  = slapos.recipe.build:gitclone
repository = https://lab.nexedi.com/Sokhoyan/fluent-plugin-wendelin.git
branch = add-keep-alive
# dir is pretty name as top-level -dev recipe
git-executable = ${git:location}/bin/git

[fluentd]
gems =
  fluentd
  fluent-plugin-td
  bundler
  fluent-plugin-bin

[template-caddy-service]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/template-caddy-service.sh.in
md5sum = 3e09969c479931ca4df6546abbd1a117
output = ${buildout:directory}/template-caddy-service.sh.in
mode = 0644

[template-caddyfile]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/Caddyfile.in
md5sum = 8644e98038ab76a8e5a499e22f92660a
output = ${buildout:directory}/Caddyfile.in
mode = 0644

[template-caddy-fluentd]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance-caddy-fluentd.cfg.in
md5sum = 4e0c6e0464ad1b2f1adadda10771bb86
output = ${buildout:directory}/instance-caddy-fluentd.cfg.in
mode = 0644

[caddy]
recipe  = slapos.recipe.cmmi
path    = ${go_github.com_mholt_caddy:location}
go      = ${gowork:golang}/bin/go
configure-command = :
make-targets =
make-binary = cd ${:path}/caddy  && ${:go} install -v
environment =
  PATH=${pkgconfig:location}/bin:${gowork:golang}/bin:${buildout:bin-directory}:%(PATH)s
  GOPATH=${gowork:directory}
output =  ${gowork:bin}/caddy

[versions]
slapos.recipe.template = 4.3
erp5.util = 0.4.50

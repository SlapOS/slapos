[buildout]
extends =
  ../../stack/slapos.cfg
  ../../component/git/buildout.cfg
  ../../component/lxml-python/buildout.cfg
  ../../component/zip/buildout.cfg
  ../../component/busybox/buildout.cfg
  ../../component/shellinabox/buildout.cfg
  ../../component/pwgen/buildout.cfg
  ../../component/apache/buildout.cfg
  ../../component/mariadb/buildout.cfg
  ../../component/gcc/buildout.cfg
  ../../component/dash/buildout.cfg
  ../../component/inkscape/buildout.cfg
  ../../component/ghostscript/buildout.cfg
  ../../component/openssl/buildout.cfg
  ../../component/libreoffice-bin/buildout.cfg
  ../../component/imagemagick/buildout.cfg
  ../../component/boost-lib/buildout.cfg
  ../../component/cmake/buildout.cfg
  ../../component/gtk-2/buildout.cfg
  ../../component/graphviz/buildout.cfg
  ../../component/xorg/buildout.cfg
  ../../component/mesa/buildout.cfg
  ../../component/firefox/buildout.cfg
  ../../component/w3-validator/buildout.cfg
  ../../component/perl-SGML-Parser-OpenSP/buildout.cfg
  ../../component/opensp/buildout.cfg
  ../../component/w3m/buildout.cfg
  ../../component/xz-utils/buildout.cfg
  ../../component/openblas/buildout.cfg
  ../../component/ncurses/buildout.cfg
  ../../component/readline/buildout.cfg
  ../../component/sqlite3/buildout.cfg
  ../../component/gettext/buildout.cfg
  ../../component/lunzip/buildout.cfg
  ../../component/pkgconfig/buildout.cfg
  ../../component/curl/buildout.cfg
  ../../component/jemalloc/buildout.cfg
  ../../component/m4/buildout.cfg
  ../../component/bzip2/buildout.cfg
  ../../component/gmp/buildout.cfg
  ../../component/rsync/buildout.cfg
  ../../component/librsync/buildout.cfg
  ../../component/groonga/buildout.cfg
  ../../component/libxml2/buildout.cfg
  ../../component/aspell/buildout.cfg
  ../../component/tesseract/buildout.cfg
  ../../component/cpio/buildout.cfg
  ../../component/subversion/buildout.cfg
  ../../component/poppler/buildout.cfg
  ../../component/postfix/buildout.cfg
  ../../component/coreutils/buildout.cfg
  ../../component/libdmtx/buildout.cfg
  ../../component/patch/buildout.cfg
  ../../component/findutils/buildout.cfg
  ../../component/zlib/buildout.cfg
  ../../component/fonts/buildout.cfg
  ../../component/freetype/buildout.cfg

parts =
  slapos-cookbook-develop
  slapos-core-develop
  erp5-util-develop
  slapos-cookbook
  template
  lxml-python
  eggs
  zip
  git
  apache-antiloris
  software_link


[software_link]
recipe = collective.recipe.template
output = ${buildout:parts-directory}/software_link/software_link.cfg
input = inline:
  [perl]
  recipe =
  location = ${perl:location}
  [python2.7]
  recipe =
  location = ${python2.7:location}
  # This python will be used by buildout as executable
  executable = ${python2.7:executable}
  [apache]
  recipe =
  location = ${apache:location}
  [mariadb]
  recipe =
  location = ${mariadb:location}
  [mroonga-mariadb]
  recipe =
  location = ${mroonga-mariadb:location}
  [git]
  recipe =
  location = ${git:location}
  [gcc]
  recipe =
  location = ${gcc:location}
  [gcc-fortran]
  recipe =
  location = ${gcc-fortran:location}
  [dash]
  recipe =
  location = ${dash:location}
  [ghostscript]
  recipe =
  location = ${ghostscript:location}
  [ghostscript-fonts]
  recipe =
  location = ${ghostscript-fonts:location}
  [inkscape]
  recipe =
  location = ${inkscape:location}
  [openssl]
  recipe =
  location = ${openssl:location}
  [libreoffice-bin]
  recipe =
  location = ${libreoffice-bin:location}
  [imagemagick]
  recipe =
  location = ${imagemagick:location}
  [boost-lib]
  recipe =
  location = ${boost-lib:location}
  [cmake]
  recipe =
  location = ${cmake:location}
  [gtk-2]
  recipe =
  location = ${gtk-2:location}
  [gtkmm]
  recipe =
  location = ${gtkmm:location}
  [gdk-pixbuf]
  recipe =
  location = ${gdk-pixbuf:location}
  [glib]
  recipe =
  location = ${glib:location}
  [glibmm]
  recipe =
  location = ${glibmm:location}
  [graphviz]
  recipe =
  location = ${graphviz:location}
  [xserver]
  recipe =
  location = ${xserver:location}
  [mesa]
  recipe =
  location = ${mesa:location}
  [glu]
  recipe =
  location = ${glu:location}
  [firefox]
  recipe =
  location = ${firefox:location}
  [w3-validator]
  recipe =
  location = ${w3-validator:location}
  [w3m]
  recipe =
  location = ${w3m:location}
  [opensp]
  recipe =
  location = ${opensp:location}
  [perl-SGML-Parser-OpenSP]
  recipe =
  location = ${perl-SGML-Parser-OpenSP:location}
  [xz-utils]
  recipe =
  location = ${xz-utils:location}
  [openblas]
  recipe =
  location = ${openblas:location}
  [ncurses]
  recipe =
  location = ${ncurses:location}
  [readline]
  recipe =
  location = ${readline:location}
  [sqlite3]
  recipe =
  location = ${sqlite3:location}
  [gettext]
  recipe =
  location = ${gettext:location}
  [lunzip]
  recipe =
  location = ${lunzip:location}
  [pkgconfig]
  recipe =
  location = ${pkgconfig:location}
  [curl]
  recipe =
  location = ${curl:location}
  [jemalloc]
  recipe =
  location = ${jemalloc:location}
  [m4]
  recipe =
  location = ${m4:location}
  [bzip2]
  recipe =
  location = ${bzip2:location}
  [gmp]
  recipe =
  location = ${gmp:location}
  [rsync]
  recipe =
  location = ${rsync:location}
  [librsync]
  recipe =
  location = ${librsync:location}
  [groonga]
  recipe =
  location = ${groonga:location}
  [libxml2]
  recipe =
  location = ${libxml2:location}
  [aspell]
  recipe =
  location = ${aspell:location}
  [apr]
  recipe =
  location = ${apr:location}
  [tesseract]
  recipe =
  location = ${tesseract:location}
  [tesseract-eng-traineddata]
  recipe =
  location = ${tesseract-eng-traineddata:location}
  [cpio]
  recipe =
  location = ${cpio:location}
  [subversion]
  recipe =
  location = ${subversion:location}
  [poppler]
  recipe =
  location = ${poppler:location}
  [postfix]
  recipe =
  location = ${postfix:location}
  [coreutils]
  recipe =
  location = ${coreutils:location}
  [libdmtx]
  recipe =
  location = ${libdmtx:location}
  [dmtx-utils]
  recipe =
  location = ${dmtx-utils:location}
  [patch]
  recipe =
  location = ${patch:location}
  [libexpat]
  recipe =
  location = ${libexpat:location}
  [findutils]
  recipe =
  location = ${findutils:location}
  [zlib]
  recipe =
  location = ${zlib:location}
  [liberation-fonts]
  recipe =
  location = ${liberation-fonts:location}
  [ipaex-fonts]
  recipe =
  location = ${liberation-fonts:location}
  [ipa-fonts]
  recipe =
  location = ${liberation-fonts:location}
  [ocrb-fonts]
  recipe =
  location = ${liberation-fonts:location}
  [android-fonts]
  recipe =
  location = ${liberation-fonts:location}
  [freetype]
  recipe =
  location = ${freetype:location}




[erp5-util-repository.git]
recipe = slapos.recipe.build:gitclone
repository = http://lab.nexedi.com/nexedi/erp5.git
# We need 
# testnode: Use tempfile to generate a random socket path for slapos supervisord
# http://git.erp5.org/gitweb/erp5.git/commitdiff/1c827f206d147aa4e492ce4457dd9fb03522b96e?js=1
branch = testnode_software_link
git-executable = ${git:location}/bin/git
develop = true

[erp5-util-develop]
recipe = zc.recipe.egg:develop
setup = ${erp5-util-repository.git:location}

[slapos.cookbook-repository]
branch = testnode_software_link
repository = https://lab.nexedi.cn/jerome/slapos.git
# We need
# slapos.recipe.erp5testnode: support empty software-path-list
# http://git.erp5.org/gitweb/slapos.git/commit/4613e36337ddd7076fdae6356797cb7adc9d5783?js=1


[slapos.core-repository]
recipe = slapos.recipe.build:gitclone
repository = https://lab.nexedi.com/nexedi/slapos.core.git
branch = master
git-executable = ${git:location}/bin/git
develop = true

[slapos-core-develop]
recipe = zc.recipe.egg:develop
setup = ${slapos.core-repository:location}

[eggs]
recipe = zc.recipe.egg
eggs =
  ${lxml-python:egg}
  zc.buildout
  slapos.libnetworkcache
  slapos.core
  jsonschema
  hexagonit.recipe.download
  netaddr
  inotifyx
  lock_file
  pytz
  erp5.util
  PyXML

[testnode]

scripts =
  testnode = erp5.util.testnode:main
  slapgrid-cp = slapos.grid.slapgrid:runComputerPartition
  slapgrid-sr = slapos.grid.slapgrid:runSoftwareRelease
  slapproxy = slapos.proxy:main


[template]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance.cfg
output = ${buildout:directory}/template.cfg
mode = 0644
md5sum = 307663d73ef3ef94b02567ecd322252e

[template-default]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance-default.cfg
output = ${buildout:directory}/template-default.cfg
mode = 0644
md5sum = 6e0a714a6f9658d915c54c3853ed1521

[versions]
erp5.util =
slapos.cookbook =
PyXML = 0.8.5
erp5.util =
slapos.recipe.template = 2.7
collective.recipe.template = 1.11

[buildout]
extends =
  ../../stack/slapos.cfg
  ../../component/git/buildout.cfg
  ../../component/lxml-python/buildout.cfg
  ../../component/zip/buildout.cfg
  ../../component/busybox/buildout.cfg
  ../../component/shellinabox/buildout.cfg
  ../../component/pwgen/buildout.cfg
  ../../component/apache/buildout.cfg
  ../../component/mariadb/buildout.cfg
  ../../component/gcc/buildout.cfg
  ../../component/dash/buildout.cfg
  ../../component/inkscape/buildout.cfg
  ../../component/ghostscript/buildout.cfg
  ../../component/openssl/buildout.cfg
  ../../component/libreoffice-bin/buildout.cfg
  ../../component/imagemagick/buildout.cfg
  ../../component/boost-lib/buildout.cfg
  ../../component/cmake/buildout.cfg
  ../../component/gtk-2/buildout.cfg
  ../../component/graphviz/buildout.cfg
  ../../component/xorg/buildout.cfg
  ../../component/mesa/buildout.cfg
  ../../component/firefox/buildout.cfg
  ../../component/w3-validator/buildout.cfg
  ../../component/w3m/buildout.cfg

parts =
  slapos-cookbook-develop
  slapos-core-develop
  erp5-util-develop
  slapos-cookbook
  template
  lxml-python
  eggs
  zip
  git
  apache
  software_link


[software_link]
recipe = collective.recipe.template
output = ${buildout:parts-directory}/software_link/software_link.cfg
input = inline:
  [perl]
  recipe =
  location = ${perl:location}
  [python2.7]
  recipe =
  location = ${python2.7:location}
  # This python will be used by buildout as executable
  executable = ${python2.7:executable}
  [apache]
  recipe =
  location = ${apache:location}
  [mariadb]
  recipe =
  location = ${mariadb:location}
  [mroonga-mariadb]
  recipe =
  location = ${mroonga-mariadb:location}
  [git]
  recipe =
  location = ${git:location}
  [gcc]
  recipe =
  location = ${gcc:location}
  [gcc-fortran]
  recipe =
  location = ${gcc-fortran:location}
  [dash]
  recipe =
  location = ${dash:location}
  [ghostscript]
  recipe =
  location = ${ghostscript:location}
  [inkscape]
  recipe =
  location = ${inkscape:location}
  [openssl]
  recipe =
  location = ${openssl:location}
  [libreoffice-bin]
  recipe =
  location = ${libreoffice-bin:location}
  [imagemagick]
  recipe =
  location = ${imagemagick:location}
  [boost-lib]
  recipe =
  location = ${boost-lib:location}
  [cmake]
  recipe =
  location = ${cmake:location}
  [gtk-2]
  recipe =
  location = ${gtk-2:location}
  [gtkmm]
  recipe =
  location = ${gtkmm:location}
  [gdk-pixbuf]
  recipe =
  location = ${gdk-pixbuf:location}
  [glib]
  recipe =
  location = ${glib:location}
  [glibmm]
  recipe =
  location = ${glibmm:location}
  [graphviz]
  recipe =
  location = ${graphviz:location}
  [xserver]
  recipe =
  location = ${xserver:location}
  [mesa]
  recipe =
  location = ${mesa:location}
  [glu]
  recipe =
  location = ${glu:location}
  [firefox]
  recipe =
  location = ${firefox:location}
  [w3-validator]
  recipe =
  location = ${w3-validator:location}
  [w3m]
  recipe =
  location = ${w3m:location}


[erp5-util-repository.git]
recipe = slapos.recipe.build:gitclone
repository = http://lab.nexedi.com/nexedi/erp5.git
# We need 
# testnode: Use tempfile to generate a random socket path for slapos supervisord
# http://git.erp5.org/gitweb/erp5.git/commitdiff/1c827f206d147aa4e492ce4457dd9fb03522b96e?js=1
branch = testnode_software_link
git-executable = ${git:location}/bin/git
develop = true

[erp5-util-develop]
recipe = zc.recipe.egg:develop
setup = ${erp5-util-repository.git:location}

[slapos.cookbook-repository]
branch = testnode_software_link
repository = https://lab.nexedi.cn/jerome/slapos.git
# We need
# slapos.recipe.erp5testnode: support empty software-path-list
# http://git.erp5.org/gitweb/slapos.git/commit/4613e36337ddd7076fdae6356797cb7adc9d5783?js=1


[slapos.core-repository]
recipe = slapos.recipe.build:gitclone
repository = https://lab.nexedi.com/nexedi/slapos.core.git
branch = master
git-executable = ${git:location}/bin/git
develop = true

[slapos-core-develop]
recipe = zc.recipe.egg:develop
setup = ${slapos.core-repository:location}

[eggs]
recipe = zc.recipe.egg
eggs =
  ${lxml-python:egg}
  zc.buildout
  slapos.libnetworkcache
  slapos.core
  jsonschema
  hexagonit.recipe.download
  netaddr
  inotifyx
  lock_file
  pytz
  erp5.util
  PyXML

[testnode]

scripts =
  testnode = erp5.util.testnode:main
  slapgrid-cp = slapos.grid.slapgrid:runComputerPartition
  slapgrid-sr = slapos.grid.slapgrid:runSoftwareRelease
  slapproxy = slapos.proxy:main


[template]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance.cfg
output = ${buildout:directory}/template.cfg
mode = 0644
md5sum = 307663d73ef3ef94b02567ecd322252e

[template-default]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance-default.cfg
output = ${buildout:directory}/template-default.cfg
mode = 0644
md5sum = 6e0a714a6f9658d915c54c3853ed1521

[versions]
erp5.util =
slapos.cookbook =
PyXML = 0.8.5
erp5.util =
slapos.recipe.template = 2.7
collective.recipe.template = 1.11

[buildout]
extends =
  ../../stack/monitor/buildout.cfg
  ../../stack/nodejs.cfg
  ../../component/nginx/buildout.cfg
  ../../component/openssl/buildout.cfg
  buildout.hash.cfg
  ../../stack/slapos.cfg

parts =
  slapos-cookbook
  nodejs-22.11.0
  template_nginx_conf
  template-cfg
  instance-input-schema.json

[template-cfg]
recipe = slapos.recipe.template:jinja2
url = ${:_profile_base_location_}/instance.cfg.in
output = ${buildout:directory}/template.cfg
context =
  raw monitor_template_cfg ${monitor-template:output}
  key nodejs_location nodejs-22.11.0:location
  key nginx_location nginx:location
  key openssl_location openssl:location
  key nginx_conf_in template_nginx_conf:target
  key software_json_target software.json:target
  key eggs_directory buildout:eggs-directory
  key develop_eggs_directory buildout:develop-eggs-directory

[download-file]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:filename}
destination = ${buildout:directory}/${:_buildout_section_name_}

[instance-input-schema.json]
<= download-file

[template_nginx_conf]
<= download-file

[software.json]
<= download-file

[buildout]
parts =
  switch-softwaretype

eggs-directory = ${buildout:eggs-directory}
develop-eggs-directory = ${buildout:develop-eggs-directory}
offline = true

[directory]
recipe = slapos.cookbook:mkdirectory
software = ${buildout:directory}
home = $${buildout:directory}
etc = $${:home}/etc

[slap-configuration]
recipe = slapos.cookbook:slapconfiguration.serialised
computer = $${slap-connection:computer-id}
partition = $${slap-connection:partition-id}
url = $${slap-connection:server-url}
key = $${slap-connection:key-file}
cert = $${slap-connection:cert-file}

[jinja2-template-base]
recipe = slapos.recipe.template:jinja2
output = $${buildout:directory}/$${:filename}
extra-context =
depends = $${activate-eggs:recipe}
context =
    import xbuildout xbuildout
    import json_module json
    import netaddr netaddr
    import nrarfcn_module nrarfcn
    import xearfcn_module xlte.earfcn
    import xnrarfcn_module xlte.nrarfcn
    key eggs_directory buildout:eggs-directory
    key develop_eggs_directory buildout:develop-eggs-directory
    raw buildout_directory ${buildout:directory}
    section directory directory
    raw pythonwitheggs ${buildout:bin-directory}/pythonwitheggs
    section slap_connection slap-connection
    key lan_ipv4 lan:ipv4
    key mac lan:mac
    key my_ipv4  slap-configuration:ipv4-random
    key my_ipv6  slap-configuration:ipv6-random
    raw amarisoft_log_rotate_sh   ${amarisoft-log-rotate-sh:target}
    raw nginx_template   ${nginx_conf.in:target}
    raw nginx_mime   ${nginx-output:mime}
    raw nginx_executable ${nginx-output:nginx}
    raw openssl_executable_location ${openssl:location}/bin/openssl
    $${:extra-context}
import-list =
    rawfile slaplte.jinja2 ${slaplte.jinja2:target}
    rawfile ru_libinstance.jinja2.cfg ${ru_libinstance.jinja2.cfg:target}
    rawfile ru_sdr_libinstance.jinja2.cfg ${ru_sdr_libinstance.jinja2.cfg:target}
    rawfile ru_sunwave_libinstance.jinja2.cfg ${ru_sunwave_libinstance.jinja2.cfg:target}

# activate eggs and modules used in jinja2 templates
[activate-eggs]
recipe = slapos.recipe.build
init =
  import pkg_resources as rpkg
  buildout = self.buildout['buildout']
  env = rpkg.Environment([buildout['develop-eggs-directory'],
                          buildout['eggs-directory']])
  env.scan()
  def activate(pkgspec):
    req = rpkg.Requirement.parse(pkgspec)
    for dist in rpkg.working_set.resolve([req], env):
      rpkg.working_set.add(dist)

  activate('xlte')
  activate('nrarfcn')

  # ~ import xbuildout
  import sys, types
  def readfile(path):
    with open(path) as f:
      return f.read()
  xbuildout = types.ModuleType('xbuildout')
  exec(readfile('${ru_xbuildout.py:target}'), xbuildout.__dict__)
  assert 'xbuildout' not in sys.modules
  sys.modules['xbuildout'] = xbuildout

[sdr]
recipe = slapos.recipe.build
configuration = $${slap-configuration:configuration}
init =
  # Set SDR directory
  options['dir'] = options['configuration'].get('sdr_dir', '/opt/sdr')

# Get unmodified parameters without defaults
[bouture-slap-configuration]
<= slap-connection
recipe = slapos.cookbook:slapconfiguration.serialised
computer = $${slap-connection:computer-id}
partition = $${slap-connection:partition-id}
url = $${slap-connection:server-url}
key = $${slap-connection:key-file}
cert = $${slap-connection:cert-file}

[bouture-parameters]
recipe = slapos.recipe.build
depends = $${slap-configuration:recipe}
bouture-dir = $${directory:home}
init =
  from copy import deepcopy
  import json

  if 'slap-configuration' in options:
    slap_configuration = deepcopy(options['slap-configuration'])
  else:
    slap_configuration = deepcopy(self.buildout['bouture-slap-configuration'])
  out = deepcopy(options.get('output-parameters', {}))
  config = slap_configuration['configuration']

  if slap_configuration['slap-software-type'] == "core-network":
    shared_list = slap_configuration['slave-instance-list']
  else:
    shared_list = []

  if slap_configuration['slap-software-type'] in ["enb", "gnb"]:
    config.setdefault('management', {})
    config['management']['xlog_enabled'] = False
    config['management']['xlog_forwarding_enabled'] = False
    config['management']['websocket_url_ipv6'] = True
  else:
    config['websocket_url_ipv6'] = True

  with open(options['bouture-dir'] + '/bouture.json', 'w+') as f:
    f.write(json.dumps({
      'config': {'_': json.dumps(config)},
      'software-type': slap_configuration['slap-software-type'],
      'software-url': slap_configuration['software-release-url'],
      'shared-list': [{
       'parameter-list': {'_': shared['_']},
       'slap-software-type': slap_configuration['slap-software-type'],
       'slave-reference': shared['slave_reference'],
       'slave-title': shared['slave_title'],
      } for shared in shared_list],
      'instance-title': slap_configuration['instance-title'],
      'instance-state': slap_configuration['instance-state'],
      'ipv4-random': slap_configuration['ipv4-random'],
      'ipv6-random': slap_configuration['ipv6-random'],
    }))

[parse-parameters]
recipe = slapos.recipe.build
depends = $${slap-configuration:recipe}
lan-ipv4 = $${lan:ipv4}
init =
  from copy import deepcopy
  if 'slap-configuration' in options:
    slap_configuration = deepcopy(options['slap-configuration'])
  else:
    slap_configuration = deepcopy(self.buildout['slap-configuration'])
  publish              = deepcopy(options.get('publish', {}))
  shared_list        = slap_configuration['slave-instance-list']
  config             = slap_configuration['configuration']

  if slap_configuration['slap-software-type'] == 'core-network':
    import json
    config.setdefault('gtp_addr_list', ["Localhost address"])
    gtp_localhost_addr = '127.0.1.100'
  elif slap_configuration['slap-software-type'] in ['enb', 'gnb']:
    import netaddr, json, subprocess
    config.setdefault('gtp_addr', "Automatic")
    config.setdefault('gtp_addr_list', [config['gtp_addr']])
    gtp_localhost_addr = '127.0.1.1'

  if slap_configuration['slap-software-type'] in ['core-network', 'enb', 'gnb']:
    gtp_addr_list = []
    for gtp_addr in config['gtp_addr_list']:
      if gtp_addr == 'Automatic':
        for a in (config.get('mme_list', []) + config.get('amf_list', [])):
          addr = a.get('mme_addr', a.get('amf_addr', ''))
          if '[' in addr:
            addr = addr.split('[', 1)[1].rsplit(']', 1)[0]
          elif '.' in addr and ':' in addr:
            addr = addr.split(':', 1)[0]

          ip = netaddr.IPAddress(addr)
          if ip.is_loopback():
            gtp_addr_list.append(gtp_localhost_addr)
          elif ':' in addr:
            gtp_addr_list.append(slap_configuration['ipv6-random'])
          else:
            r = subprocess.check_output(['ip', '-json', 'route', 'get', addr])
            gtp_addr_list.append(json.loads(r)[0]['prefsrc'])
      elif gtp_addr == 'IPv4 LAN address':
        gtp_addr_list.append(options['lan-ipv4'])
      elif gtp_addr == 'IPv6 Re6st address':
        gtp_addr_list.append(slap_configuration['ipv6-random'])
      elif gtp_addr == 'Localhost address':
        gtp_addr_list.append(gtp_localhost_addr)
      else:
        gtp_addr_list.append(gtp_addr)
    config['gtp_addr_list'] = gtp_addr_list

  # SDR Play
  if slap_configuration['slap-software-type'] == 'test-model':
    for i, cell in enumerate(['cell1', 'cell2']):
      config.setdefault(cell, {})
      config[cell].setdefault('enable_cell', False)
      if not config[cell]['enable_cell']:
        continue
      # Default parameters (TODO: use slap-configuration:jsonschemas recipe)
      config[cell].setdefault('file', "LTE Test Mode 31  - 20 MHz  - FDD")
      config[cell].setdefault('enable_cell', True)
      sp = list(filter(lambda x: x, config[cell]['file'].split(' ')))
      config[cell]['file'] = {
       "LTE Test Mode 31  - 10 MHz  - FDD":                     "LTE-31-10MHzBP_SR1536-FDD-ADJUSTED.bin",
       "LTE Test Mode 31  - 10 MHz  - TDD":                     "LTE-31-10MHzBP_SR1536-TDD-ADJUSTED.bin",
       "LTE Test Mode 31  - 1.4 MHz - TDD":                    "LTE-31-1p4MHzBP_SR1p92-TDD-ADJUSTED.bin",
       "LTE Test Mode 31  - 20 MHz  - FDD":                     "LTE-31-20MHzBP_SR3072-FDD-ADJUSTED.bin",
       "LTE Test Mode 31  - 3 MHz   - TDD":                      "LTE-31-3MHzBP_SR3p84-TDD-ADJUSTED.bin",
       "LTE Test Mode 31  - 5 MHz   - TDD":                      "LTE-31-5MHzBP_SR7p68-TDD-ADJUSTED.bin",
       "LTE Test Mode 32  - 10 MHz  - TDD":                     "LTE-32-10MHzBP_SR1536-TDD-ADJUSTED.bin",
       "LTE Test Mode 32  - 20 MHz  - TDD":                     "LTE-32-20MHzBP_SR3072-TDD-ADJUSTED.bin",
       "LTE Test Mode 33  - 10 MHz  - TDD":                     "LTE-33-10MHzBP_SR1536-TDD-ADJUSTED.bin",
       "LTE Test Mode 33  - 20 MHz  - TDD":                     "LTE-33-20MHzBP_SR3072-TDD-ADJUSTED.bin",
       "LTE Test Mode 31  - 20 MHz  - TDD":                     "LTE-TM_31-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 11  - 20 MHz  - TDD":                      "NR-FR1-TM11-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 11  - 5 MHz   - FDD":                       "NR-FR1-TM11-5MHz_SR7680000-FDD-ADJUSTED.bin",
       "NR  Test Mode 12  - 20 MHz  - TDD":                      "NR-FR1-TM12-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 2   - 20 MHz  - TDD":                       "NR-FR1-TM2-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 2a  - 20 MHz  - TDD":                      "NR-FR1-TM2a-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 2b  - 20 MHz  - TDD":                      "NR-FR1-TM2b-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 31  - 100 MHz - FDD":                     "NR-FR1-TM31-100MHz_SR122880000_SCS30kHz-FDD-ADJUSTED.bin",
       "NR  Test Mode 31  - 20 MHz  - FDD":                      "NR-FR1-TM31-20MHz_SR30720000-FDD-ADJUSTED.bin",
       "NR  Test Mode 31  - 20 MHz  - TDD":                      "NR-FR1-TM31-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 31  - 40 MHz  - TDD":                      "NR-FR1-TM31-40MHz_SR61440000-TDD-ADJUSTED.bin",
       "NR  Test Mode 31  - 5 MHz   - FDD":                       "NR-FR1-TM31-5MHz_SR7680000-FDD-ADJUSTED.bin",
       "NR  Test Mode 31a - 20 MHz  - FDD":                     "NR-FR1-TM_31a-20MHzBP_SC30kHz_SR30p72-FDD-ADJUSTED.bin",
       "NR  Test Mode 31a - 20 MHz  - FDD - SCS 15 kHz":           "NR-FR1-TM31a-20MHz_SR30720000_SCS15kHz-FDD-ADJUSTED.bin",
       "NR  Test Mode 31a - 20 MHz  - TDD":                     "NR-FR1-TM31a-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 31a - 5 MHz   - FDD":                      "NR-FR1-TM31a-5MHz_SR7680000-FDD-ADJUSTED.bin",
       "NR  Test Mode 31b - 20 MHz  - TDD":                     "NR-FR1-TM31b-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 32  - 20 MHz  - TDD":                      "NR-FR1-TM32-20MHz_SR30720000-TDD-ADJUSTED.bin",
       "NR  Test Mode 33  - 20 MHz  - TDD":                      "NR-FR1-TM33-20MHz_SR30720000-TDD-ADJUSTED.bin",
      }[config[cell]['file']]
      bandwidth = int(sp[5])
      config[cell]['rf_mode'] = sp[8].lower()
      config[cell]['rat'] = sp[0].lower()
      config[cell]['test_mode'] = sp[3]
      config[cell]['scs'] = 30 if len(sp) < 10 else sp[11]
      config[cell]['rate'] = {
        1.4: 1920000,
        3  : 3840000,
        5  : 7680000,
        10 : 15360000,
        20 : 30720000,
        40 : 61440000,
        100: 122880000,
      }[bandwidth]
      config[cell]['bandwidth'] = str(bandwidth) + ' MHz'
      config[cell]['rate'] = str(config[cell]['rate'] / 10**6) + ' MHz'
      config[cell]['dl_frequency'] *= 10**6

  slap_configuration.update({
    'configuration': config,
    'slave-instance-list': shared_list,
  })
  options['publish'] = publish
  options['slap-configuration'] = slap_configuration
  options['slapparameter-dict'] = config
  options['shared-list'] = shared_list

[enb-parameters]
<= parse-parameters

[amarisoft]
recipe = slapos.recipe.build
fixed_version = 2025-06-13.1753349480
configuration = $${slap-configuration:configuration}
init =
  import os, re
  from datetime import datetime

  def pretty_print(version):
    version, revision = version.split('.')
    revision = datetime.utcfromtimestamp(int(revision)).strftime('%Y-%m-%d')
    return '{} (revision: {})'.format(version, revision)

  mock = options['configuration'].get('lte_mock', False)
  # Set Amarisoft directory
  options['dir'] = options['configuration'].get('amarisoft_dir', '/opt/amarisoft')
  # Get Available Amarisoft versions
  if mock:
    version_installed = [options['fixed_version']]
  else:
    version_installed = [x[1:] for x in os.listdir(options['dir']) if re.match(r"v[0-9]{4}-[0-9]{2}-[0-9]{2}.[0-9]{10}", x)]
  options['version_installed'] = ', '.join(map(pretty_print, version_installed))
  # Set Amarisoft version to use
  slapconf_version = options['configuration'].get('amarisoft_version', False)
  if slapconf_version and \
     slapconf_version in version_installed:
    options['version'] = slapconf_version
  else:
    options['version'] = options['fixed_version']
  # Set Binaries and license directories
  binary_dir  = options['dir'] + "/v" + options['version']
  options['version_cn'] = pretty_print(options['version'])
  options['binary_dir'] = binary_dir
  options['license_dir'] = options['dir'] + '/.amarisoft'
  options['sdr_dir'] = binary_dir + '/trx_sdr'
  options['enb_dir'] = binary_dir + '/enb'
  options['www_dir'] = binary_dir + '/www'
  options['mme_dir'] = binary_dir + '/mme'
  options['ims_dir'] = binary_dir + '/mme'
  options['ue_dir']  = binary_dir + '/ue'
  if options['configuration'].get('lte_mock', False):
    options['enb_dir'] = '${buildout:directory}/bin'
    options['mme_dir'] = '${buildout:directory}/bin'
    options['ims_dir'] = '${buildout:directory}/bin'
    options['ue_dir'] = '${buildout:directory}/bin'
  # Get License expiration and host IDs
  if mock:
    options.update({'lteenb_expiration': '9999-99-99', 'ltemme_expiration': '9999-99-99', 'lteue_expiration': '9999-99-99'})
    options.update({'lteenb_host_id': '00-00-00-00-00-00-00-00', 'ltemme_host_id': '00-00-00-00-00-00-00-00', 'lteue_host_id': '00-00-00-00-00-00-00-00'})
  else:
    options.update({'lteenb_expiration': 'Unknown', 'ltemme_expiration': 'Unknown', 'lteue_expiration': 'Unknown'})
    options.update({'lteenb_host_id': 'Unknown', 'ltemme_host_id': 'Unknown', 'lteue_host_id': 'Unknown'})
  try:
    for filename in os.listdir(options['license_dir']):
      if filename.endswith('.key'):
        with open(os.path.join(options['license_dir'], filename), 'r') as f:
          f.seek(260)
          host_id = "Unknown"
          product_id = "Unknown"
          for l in f:
            if l.startswith('host_id='):
              host_id = l.split('=')[1].strip()
            if l.startswith('product_id='):
              product_id = l.split('=')[1].strip()
            if l.startswith('version='):
              expiration = l.split('=')[1].strip()
          options[product_id + '_expiration'] = expiration
          options[product_id + '_host_id'] = host_id
  except FileNotFoundError:
    pass

[lan]
recipe = slapos.recipe.build
init =
  import netifaces
  for i in netifaces.interfaces():
      if not (i.startswith("slaptun") or i.startswith("slaptap") or i.startswith("re6stnet") or i == "lo"):
          a = netifaces.ifaddresses(i)
          if netifaces.AF_INET in a:
              try:
                  options['ipv4'] = a[netifaces.AF_INET][0]['addr']
              except:
                  options['ipv4'] = "0.0.0.0"
              try:
                  options['mac'] = a[netifaces.AF_LINK][0]['addr']
              except:
                  options['mac'] = "00:00:00:00:00:00"

[comp-id]
recipe = slapos.recipe.build
computer = $${slap-connection:computer-id}
title = $${slap-configuration:root-instance-title}
init =
  import socket
  options['hostname'] = socket.gethostname()
  comp_id = '_'.join(options[x] for x in ('hostname', 'computer', 'title'))
  options['comp-id'] = comp_id

[switch-softwaretype]
recipe = slapos.cookbook:switch-softwaretype
# we don't select default software type to force user to choose the correct one
enb = dynamic-template-enb:output
core-network = dynamic-template-core-network:output
test-model = dynamic-template-test-model:output
ue = dynamic-template-ue:output

[dynamic-template-enb]
< = jinja2-template-base
url = ${template-enb:target}
filename = instance-enb.cfg
extensions = jinja2.ext.do
depends-bouture = $${bouture-parameters:recipe}
extra-context =
    key slapparameter_dict enb-parameters:slapparameter-dict
    key publish enb-parameters:publish
    key slap_configuration enb-parameters:slap-configuration
    raw monitor_template ${monitor2-template:output}
    section comp_id comp-id
    section amarisoft amarisoft
    section sdr sdr
    raw enb_template   ${enb.jinja2.cfg:target}
    raw slaplte_template ${slaplte.jinja2:target}
    raw drb_lte_template ${drb_lte.jinja2.cfg:target}
    raw drb_nr_template  ${drb_nr.jinja2.cfg:target}
    raw sib23_template   ${sib23.jinja2.asn:target}
    raw ru_amarisoft_stats_template   ${ru_amarisoft-stats.jinja2.py:target}
    raw ru_amarisoft_rf_info_template   ${ru_amarisoft-rf-info.jinja2.py:target}
    raw ru_tapsplit ${ru_tapsplit:target}
    raw netcapdo ${netcapdo:exe}
    raw openssl_location ${openssl:location}
    raw ru_dnsmasq_template  ${ru_dnsmasq.jinja2.cfg:target}
    raw dnsmasq_location ${dnsmasq:location}
    raw fluent_bit_location ${fluent-bit:location}
    raw openssh_location ${openssh:location}
    raw openssh_output_keygen ${openssh-output:keygen}

[dynamic-template-core-network]
< = jinja2-template-base
url = ${template-core-network:target}
filename = instance-core-network.cfg
extensions = jinja2.ext.do
depends-bouture = $${bouture-parameters:recipe}
extra-context =
    key slapparameter_dict parse-parameters:slapparameter-dict
    key publish parse-parameters:publish
    key slap_configuration parse-parameters:slap-configuration
    raw monitor_template ${monitor2-template:output}
    section amarisoft amarisoft
    section sdr sdr
    raw mme_template   ${mme.jinja2.cfg:target}
    raw dnsmasq_template   ${dnsmasq-core-network.jinja2.cfg:target}
    raw ims_template   ${ims.jinja2.cfg:target}
    raw ue_db_template ${ue_db.jinja2.cfg:target}
    raw mt_call_template ${mt_call_qos.jinja2.sdp:target}
    raw netcapdo ${netcapdo:exe}
    raw openssl_location ${openssl:location}
    raw nghttp2_location ${nghttp2:location}
    raw iperf3_location ${iperf3:location}
    raw dnsmasq_location ${dnsmasq:location}
    key slave_instance_list slap-configuration:slave-instance-list

[dynamic-template-test-model]
< = jinja2-template-base
url = ${template-test-model:target}
filename = instance-test-model.cfg
extensions = jinja2.ext.do
extra-context =
    key slapparameter_dict test-model-parameters:slapparameter-dict
    key publish test-model-parameters:publish
    raw monitor_template ${monitor2-template:output}
    section amarisoft amarisoft
    section sdr sdr
    raw openssl_location ${openssl:location}
    raw nghttp2_location ${nghttp2:location}
    raw LTE_31_10MHzBP_SR1536_FDD_ADJUSTED ${LTE-31-10MHzBP_SR1536-FDD-ADJUSTED.bin:target}
    raw LTE_31_10MHzBP_SR1536_TDD_ADJUSTED ${LTE-31-10MHzBP_SR1536-TDD-ADJUSTED.bin:target}
    raw LTE_31_1p4MHzBP_SR1p92_TDD_ADJUSTED ${LTE-31-1p4MHzBP_SR1p92-TDD-ADJUSTED.bin:target}
    raw LTE_31_20MHzBP_SR3072_FDD_ADJUSTED ${LTE-31-20MHzBP_SR3072-FDD-ADJUSTED.bin:target}
    raw LTE_31_3MHzBP_SR3p84_TDD_ADJUSTED ${LTE-31-3MHzBP_SR3p84-TDD-ADJUSTED.bin:target}
    raw LTE_31_5MHzBP_SR7p68_TDD_ADJUSTED ${LTE-31-5MHzBP_SR7p68-TDD-ADJUSTED.bin:target}
    raw LTE_32_10MHzBP_SR1536_TDD_ADJUSTED ${LTE-32-10MHzBP_SR1536-TDD-ADJUSTED.bin:target}
    raw LTE_32_20MHzBP_SR3072_TDD_ADJUSTED ${LTE-32-20MHzBP_SR3072-TDD-ADJUSTED.bin:target}
    raw LTE_33_10MHzBP_SR1536_TDD_ADJUSTED ${LTE-33-10MHzBP_SR1536-TDD-ADJUSTED.bin:target}
    raw LTE_33_20MHzBP_SR3072_TDD_ADJUSTED ${LTE-33-20MHzBP_SR3072-TDD-ADJUSTED.bin:target}
    raw LTE_TM_31_20MHz_SR30720000_TDD_ADJUSTED ${LTE-TM_31-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM11_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM11-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM11_5MHz_SR7680000_FDD_ADJUSTED ${NR-FR1-TM11-5MHz_SR7680000-FDD-ADJUSTED.bin:target}
    raw NR_FR1_TM12_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM12-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM2_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM2-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM2a_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM2a-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM2b_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM2b-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31_100MHz_SR122880000_SCS30kHz_FDD_ADJUSTED ${NR-FR1-TM31-100MHz_SR122880000_SCS30kHz-FDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31_20MHz_SR30720000_FDD_ADJUSTED ${NR-FR1-TM31-20MHz_SR30720000-FDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM31-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31_40MHz_SR61440000_TDD_ADJUSTED ${NR-FR1-TM31-40MHz_SR61440000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31_5MHz_SR7680000_FDD_ADJUSTED ${NR-FR1-TM31-5MHz_SR7680000-FDD-ADJUSTED.bin:target}
    raw NR_FR1_TM_31a_20MHzBP_SC30kHz_SR30p72_FDD_ADJUSTED ${NR-FR1-TM_31a-20MHzBP_SC30kHz_SR30p72-FDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31a_20MHz_SR30720000_SCS15kHz_FDD_ADJUSTED ${NR-FR1-TM31a-20MHz_SR30720000_SCS15kHz-FDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31a_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM31a-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31a_5MHz_SR7680000_FDD_ADJUSTED ${NR-FR1-TM31a-5MHz_SR7680000-FDD-ADJUSTED.bin:target}
    raw NR_FR1_TM31b_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM31b-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM32_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM32-20MHz_SR30720000-TDD-ADJUSTED.bin:target}
    raw NR_FR1_TM33_20MHz_SR30720000_TDD_ADJUSTED ${NR-FR1-TM33-20MHz_SR30720000-TDD-ADJUSTED.bin:target}

[dynamic-template-ue]
< = jinja2-template-base
url = ${template-ue:target}
filename = instance-ue.cfg
extensions = jinja2.ext.do
extra-context =
    key slapparameter_dict enb-parameters:slapparameter-dict
    key publish enb-parameters:publish
    key slap_configuration enb-parameters:slap-configuration
    section amarisoft amarisoft
    section sdr sdr
    raw monitor_template ${monitor2-template:output}
    raw ue_template   ${ue.jinja2.cfg:target}
    raw slaplte_template ${slaplte.jinja2:target}
    raw openssl_location ${openssl:location}
    raw ru_amarisoft_stats_template   ${ru_amarisoft-stats.jinja2.py:target}
    raw ru_amarisoft_rf_info_template   ${ru_amarisoft-rf-info.jinja2.py:target}
    raw ru_tapsplit ${ru_tapsplit:target}
    raw netcapdo ${netcapdo:exe}
    raw ru_dnsmasq_template   ${ru_dnsmasq.jinja2.cfg:target}
    raw dnsmasq_location ${dnsmasq:location}
    raw openssh_location ${openssh:location}
    raw openssh_output_keygen ${openssh-output:keygen}

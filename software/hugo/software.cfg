[buildout]
extends =
  buildout.hash.cfg
  ../../stack/slapos.cfg
  ../../stack/monitor/buildout.cfg
  ../../component/hugo/buildout.cfg
  ../../component/nginx/buildout.cfg
  ../../component/dash/buildout.cfg
  ../../component/tar/buildout.cfg
  ../../component/curl/buildout.cfg

parts =
  slapos-cookbook
  hugo
  template-cfg

[profile-common]
nginx_location = ${nginx:location}
dash_location = ${dash:location}
tar_location = ${tar:location}
curl_location = ${curl:location}
go_environment = ${gowork:env.sh}
template_nginx_conf = ${template_nginx_conf:target}
template_mime_types = ${template_mime_types:target}
template_launcher = ${template_launcher:target}
template_index_html = ${template_index_html:target}
template_config_toml = ${template_config_toml:target}
template_graceful  = ${template_graceful:target}
template_monitor = ${monitor-template:rendered}
template_server = ${template_server:target}
template_hugo_graceful  = ${template_hugo_graceful:target}

[template-cfg]
recipe = slapos.recipe.template:jinja2
rendered = ${buildout:directory}/template.cfg
template = ${:_profile_base_location_}/${:filename}
mode = 0644
context =
  section buildout buildout
  section parameter_list profile-common
  
[download-base]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:_update_hash_filename_}
mode = 0644

[template_nginx_conf]
<= download-base

[template_launcher]
<= download-base

[template_mime_types]
<= download-base

[template_graceful]
<= download-base

[template_index_html]
<= download-base

[template_config_toml]
<= download-base

[template_server]
<= download-base

[template_hugo_graceful]
<= download-base

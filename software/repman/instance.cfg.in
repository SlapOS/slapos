# GitLab "switch-softwaretype" instance
[buildout]
parts = switch-softwaretype

# std stuff for slapos instance
eggs-directory = ${buildout:eggs-directory}
develop-eggs-directory = ${buildout:develop-eggs-directory}
offline = true


[switch-softwaretype]
recipe = slapos.cookbook:softwaretype
repman  = $${template-instance-repman.cfg:rendered}
default = $${:repman}


# macro: render instance-*.cfg from instance-*.cfg.in
[instance-cfg]
recipe  = slapos.recipe.template:jinja2
mode    = 0644
rendered= $${buildout:directory}/$${:_buildout_section_name_}
context =

    key bin_directory           buildout:bin-directory
    key eggs_directory          buildout:eggs-directory
    key develop_eggs_directory  buildout:develop-eggs-directory

# program binaries
    raw bash_bin                    ${bash:location}/bin/bash
    raw gowork_bin                  ${gowork:bin}
    raw nginx_bin                   ${nginx:location}/sbin/nginx
    raw repman_src_location         ${git.signal18.io_signal18_repman:location}
    raw template_monitor_cfg        ${monitor2-template:rendered}

# config files
    raw config_toml_in             ${config-toml.in:target}
    raw nginx_conf_in              ${nginx.conf.in:target}

    $${:extra-context}
extra-context =

[template-instance-repman.cfg]
<= instance-cfg
template= ${instance-repman.cfg:target}
extra-context =

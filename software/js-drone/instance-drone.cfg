[buildout]
parts =
  main

[directory]
recipe = slapos.cookbook:mkdirectory
home = $${buildout:directory}
etc = $${:home}/etc
var = $${:home}/var
log = $${:var}/log

[js-dynamic-template]
recipe = slapos.recipe.template:jinja2
rendered = $${directory:etc}/$${:_buildout_section_name_}.js
template = ${buildout:directory}/$${:_buildout_section_name_}.js
slapparameter_dict = {{ dumps(slapparameter_dict) }}
extra-context =
context =
  raw qjs_wrapper ${qjs-wrapper:location}/lib/libqjswrapper.so
  key slapparameter_dict :slapparameter_dict
  $${:extra-context}

[main]
<= js-dynamic-template
extra-context =
  key log_dir directory:log
  key pubsub_script pubsub:rendered
  key slapparameter_dict
  key worker_script worker:rendered

[pubsub]
<= js-dynamic-template

[worker]
<= js-dynamic-template

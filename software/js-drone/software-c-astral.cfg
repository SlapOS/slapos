[buildout]
extends =
  ../../component/mavsdk/buildout.cfg
  software-base.cfg

[c-astral-wrapper-source]
recipe = slapos.recipe.build:gitclone
repository = https://lab.nexedi.com/nexedi/c-astral-wrapper.git
revision = fe7d025

[mavsdk]
pre-configure +=
  sed -i 's#message_definitions/v1.0#${c-astral-wrapper-source:location}#' ${mavsdk-source:location}/third_party/mavlink/CMakeLists.txt

[c-astral-wrapper]
recipe = slapos.recipe.cmmi
configure-command = true
path = ${c-astral-wrapper-source:location}
environment =
  CPLUS_INCLUDE_PATH=${qjs-wrapper-source:location}/include:${mavsdk:location}/include:${mavsdk:location}/include/mavsdk
  LDFLAGS=-L${mavsdk:location}/lib -Wl,-rpath=${mavsdk:location}/lib

[qjs-wrapper]
autopilot-wrapper = ${c-astral-wrapper:location}

[buildout]
extends =
  ../../component/mavsdk/buildout.cfg
  software-base.cfg


[c-astral-xml-definition]
recipe = slapos.recipe.build:gitclone
repository = https://lab.nexedi.com/nexedi/c-astral-c-library.git
revision = 5c67ab69
git-executable = ${git:location}/bin/git

[mavsdk]
pre-configure +=
  sed -i 's#message_definitions/v1.0#${c-astral-xml-definition:location}#' ${mavsdk-source:location}/third_party/mavlink/CMakeLists.txt

[c-astral-wrapper]
recipe = slapos.recipe.cmmi
configure-command = true
url = https://lab.nexedi.com/nexedi/c-astral-wrapper/-/archive/update_set_target_coordinates/c-astral-wrapper-update_set_target_coordinates.tar.gz
md5sum = ca479b007756e3d02bc610ba0810e621
environment =
  CPLUS_INCLUDE_PATH=${qjs-wrapper-source:location}/include:${mavsdk:location}/include:${mavsdk:location}/include/mavsdk
  LDFLAGS=-L${mavsdk:location}/lib -Wl,-rpath=${mavsdk:location}/lib

[qjs-wrapper]
autopilot-wrapper = ${c-astral-wrapper:location}

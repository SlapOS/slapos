[buildout]
extends =
  ../../stack/tomcat.cfg
  ../../stack/slapos.cfg
  ../../component/git/buildout.cfg
  ../../component/openssl/buildout.cfg
  ../../component/gperf/buildout.cfg
  ../../component/boost-lib/buildout.cfg

parts =
  palo
  palo_etl_download
  slapos-cookbook
  instance-profile

[boost-lib]
<= boost-lib-1.53

[instance-profile]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/instance.cfg.in
output = ${buildout:directory}/instance.cfg
#md5sum = 
mode = 0644

[erp5_login_worker]
recipe = slapos.recipe.template
url = ${:_profile_base_location_}/erp5_login_worker.py
output = ${buildout:bin-directory}/erp5_login_worker.py
#md5sum = 
mode = 0755

[palo_olap-repository.git]
recipe = slapos.recipe.build:gitclone
repository = https://gitlab.com/perrinjerome/palo_olap.git
branch = master
git-executable = ${git:location}/bin/git

[palo]
recipe = hexagonit.recipe.cmmi
path = ${palo_olap-repository.git:location}
environment =
  CPPFLAGS=-I${gperf:location}/include -I${openssl:location}/include -I${boost-lib:location}/include
  LDFLAGS=-L${gperf:location}/lib -Wl,-rpath=${gperf:location}/lib -L${openssl:location}/lib -Wl,-rpath=${openssl:location}/lib -L${boost-lib:location}/lib -Wl,-rpath=${boost-lib:location}/lib -Wl,-copy-dt-needed-entries -lboost_system
  PATH=${gperf:location}/bin:%(PATH)s

[palo_etl_download]
recipe = hexagonit.recipe.download
url = http://switch.dl.sourceforge.net/project/palo-etl-server/etlserver/Palo%20ETL%20Server%203.2/etlserver.war
download-only = true
;destination = ${buildout:directory}/var/tomcat/webapps/

[palo_etl]
needs = ${palo_etl_download:url}

[versions]

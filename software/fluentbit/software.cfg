[buildout]
extends =
  ../../stack/slapos.cfg
  ../../component/cmake/buildout.cfg

parts =
  slapos-cookbook
  fluentbit-source
  fluentbit
  instance-profile

[instance-profile]
recipe = slapos.recipe.template:jinja2
template = ${:_profile_base_location_}/instance.cfg.in
rendered = ${buildout:directory}/instance.cfg
md5sum = a4cc579e1a4dd0eb58792a8dc6d47bc9
mode = 0644
context =
  section buildout  buildout
  key fluentbit_source_location fluentbit-source:location

[fluentbit-source]
recipe = slapos.recipe.build:gitclone
repository = https://github.com/fluent/fluent-bit.git

[fluentbit]
recipe = slapos.recipe.cmmi
path = ${fluentbit-source:location}
location = ${buildout:parts-directory}/${:_buildout_section_name_}
configure-command =
  cd build && ${cmake:location}/bin/cmake ..
make-targets =
make-binary =
  cd build && make 
{{ autogenerated }}
# see:
# https://gitlab.com/gitlab-org/gitlab-ce/blob/master/config/unicorn.rb.example
# https://gitlab.com/gitlab-org/gitlab-ce/blob/master/config/unicorn.rb.example.development
# https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-cookbooks/gitlab/templates/default/unicorn.rb.erb
# (last updated for omnibus-gitlab 8.2.3+ce.0-0-g8eda093)

{% from 'macrolib.cfg.in' import cfg  with context %}

# What ports/sockets to listen on, and what options for them.
# we listen only on unix socket
listen "{{ unicorn.socket }}", :backlog => {{ cfg('unicorn_backlog_socket') }}
#listen "127.0.0.1:8888", :tcp_nopush => true

working_directory '{{ gitlab_work.location }}'

# What the timeout for killing busy workers is, in seconds
timeout {{ cfg('unicorn_worker_timeout') }}

# Whether the app should be pre-loaded
preload_app <%= @preload_app %>

# How many worker processes
worker_processes {{ cfg('unicorn_worker_processes') }}

<%- if @before_fork %>
# What to do before we fork a worker
before_fork do |server, worker|
  <%= @before_fork %>
end

<%- end %>
<%- if @after_fork %>
# What to do after we fork a worker
after_fork do |server, worker|
  <%= @after_fork %>
end

<%- end %>

# Where to drop a pidfile
pid '{{ directory.run }}/unicorn.pid'

# Where stderr gets logged
stderr_path '{{ unicorn.log }}/unicorn_stderr.log'

# Where stdout gets logged
stdout_path '{{ unicorn.log }}/unicorn_stdout.log'

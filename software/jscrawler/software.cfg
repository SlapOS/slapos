[buildout]
extends =
  ../../component/bash/buildout.cfg
  ../../component/nginx/buildout.cfg
  ../../component/openssl/buildout.cfg
  ../../component/curl/buildout.cfg
  ../../component/git/buildout.cfg
  ../../stack/slapos.cfg
  ../../stack/nodejs.cfg
  ../../stack/monitor/buildout.cfg
  ./buildout.hash.cfg

parts =
  slapos-cookbook
  nodejs
  nginx
  openssl
  jscrawler-build
  instance

[nodejs]
<= nodejs-12.18.3

[jscrawler]
recipe = slapos.recipe.build:gitclone
repository = https://lab.nexedi.com/Mynij/mynij-crawler.git
revision = ccbdfdc4712c008034b891f081be92b9342c48ac
git-executable = ${git:location}/bin/git


[jscrawler-build]
recipe = plone.recipe.command
stop-on-error = true
command =
  cd ${jscrawler:location} && PATH=${nodejs:location}/bin:$PATH npm install
update-command = ${:command}

[download-template]
recipe = slapos.recipe.build:download
url = ${:_profile_base_location_}/${:filename}
mode = 0644

[instance]
<= download-template
recipe = slapos.recipe.template
output = ${buildout:directory}/instance.cfg

[template-jscrawler]
<= download-template
output = ${buildout:directory}/instance-jscrawler.cfg.jinja2

[template-jscrawler-test]
<= download-template
output = ${buildout:directory}/instance-jscrawler-test.cfg.jinja2

[template-nginx-configuration]
<= download-template
output = ${buildout:directory}/template-nginx.cfg.in

[template-jscrawler-builder]
<= download-template
output = ${buildout:directory}/template-jscrawler.builder.sh.in

[versions]

slapos.recipe.template = 4.4

[buildout]
parts =
  launcher
  publish-connection-information

eggs-directory = {{ buildout['eggs-directory'] }}
develop-eggs-directory = {{ buildout['develop-eggs-directory'] }}
offline = true

# Create the directories that we need. We just have /etc/service.
[directory]
recipe = slapos.cookbook:mkdirectory
home = ${buildout:directory}
service = ${:home}/etc/service

[headless-chromium]
ip = ${slap-network-information:global-ipv6}
port = 9222
url = https://example.com
remote_debug_url = http://[${:ip}]:${:port}

chromium_wrapper = {{ parameter_list['chromium_wrapper'] }}
bin_launcher = ${directory:service}/launcher
bin_shell = {{ parameter_list['dash_location'] }}/bin/dash

[launcher]
recipe = slapos.recipe.template:jinja2
template = {{ parameter_list['template_launcher'] }}
rendered = ${headless-chromium:bin_launcher}
mode = 700
context =
  section param_chromium_headless headless-chromium

[publish-connection-information]
recipe = slapos.cookbook:publish
remote_debug_url = ${headless-chromium:remote_debug_url}
cdn_url = ${remote-debugging-frontend:connection-secure_access}

[remote-debugging-frontend]
<= slap-connection
recipe = slapos.cookbook:requestoptional
name = Headless Chromium Remote Debugging Frontend
software-url = http://git.erp5.org/gitweb/slapos.git/blob_plain/HEAD:/software/apache-frontend/software.cfg
slave = true
config-url = ${headless-chromium:remote_debug_url}
config-https-only = true
return = domain secure_access

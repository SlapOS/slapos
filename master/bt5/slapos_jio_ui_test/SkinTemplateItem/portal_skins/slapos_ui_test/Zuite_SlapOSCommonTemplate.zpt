<tal:block xmlns:tal="http://xml.zope.org/namespaces/tal"
           xmlns:metal="http://xml.zope.org/namespaces/metal">

  <tal:block metal:define-macro="slapos_init">
    <tal:block metal:use-macro="here/Zuite_CommonTemplate/macros/init" />

    <tal:block metal:use-macro="here/Zuite_CommonTemplate/macros/wait_for_activities" />

    <tr>
      <td>assertTextPresent</td>
      <td>Done.</td>
      <td></td>
    </tr>
    <tr>
      <td>openAndWait</td>
      <td>${base_url}/ERP5Site_setupDummyMailHost</td>
      <td></td>
    </tr>
    <tr>
      <td>assertTextPresent</td>
      <td>True</td>
      <td></td>
    </tr>
    <tr>
      <td>open</td>
      <td>${base_url}/ERP5Site_removeTestUserList</td>
      <td></td>
    </tr>
    <tr>
      <td>assertTextPresent</td>
      <td>Done.</td>
      <td></td>
    </tr>

    <tal:block metal:use-macro="here/Zuite_CommonTemplate/macros/wait_for_activities" />

    <tr>
      <td>assertTextPresent</td>
      <td>Done.</td>
      <td></td>
    </tr>
    <tr>
      <td>open</td>
      <td>${base_url}/web_site_module/hostingjs/ERP5Site_createTestUserList</td>
      <td></td>
    </tr>
    <tr>
      <td>assertTextPresent</td>
      <td>Done.</td>
      <td></td>
    </tr>

    <tal:block metal:use-macro="here/Zuite_CommonTemplate/macros/wait_for_activities" />

    <tr>
      <td>assertTextPresent</td>
      <td>Done.</td>
      <td></td>
    </tr>

  </tal:block>

  <tal:block metal:define-macro="slapos_login">
    <!-- Logout  -->
    <tr>
      <td>open</td>
      <td>${base_url}/web_site_module/hostingjs/WebSite_logout</td>
      <td></td>
    </tr>
    <!-- Initialize -->
    <tr>
      <td>open</td>
      <td>${base_url}/web_site_module/hostingjs/</td>
      <td></td>
    </tr>
    <tr>
      <td>waitForElementPresent</td>
      <td>__ac_name</td>
      <td></td>
    </tr>
    <tr>
      <td>type</td>
      <td>__ac_name</td>
      <td>demo_functional_user</td>
    </tr>
    <tr>
      <td>type</td>
      <td>__ac_password</td>
      <td>demo_functional_user</td>
    </tr>
    <tr>
      <td>waitForElementPresent</td>
      <td>//input[@value="Login"]</td>
      <td></td>
    </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@value="Login"]</td>
      <td></td>
    </tr>
  </tal:block>

  <tal:block metal:define-macro="slapos_wait_for_front_page">
    <!-- Dashboard -->
    <tr>
      <td>waitForElementPresent</td>
      <td>//span[@data-i18n='Dashboard']</td>
      <td></td>
    </tr>
    <tr>
      <td>waitForElementPresent</td>
      <td>//h1[@data-i18n='Sites']</td>
      <td></td>
    </tr>
    <tr>
      <td>waitForElementPresent</td>
      <td>//h1[@data-i18n='Pending Tickets to Process']</td>
      <td></td>
    </tr>
    <!-- Check if map is ok -->
    <tr>
      <td>waitForElementPresent</td>
      <td>//a[@class='leaflet-control-zoom-out']</td>
      <td></td>
    </tr>
    <tr>
      <td>pause</td>
      <td>5000</td>
      <td>5000</td>
    </tr>
  </tal:block>

  <tal:block metal:define-macro="slapos_logout">

    <!-- Logout -->
    <tr>
      <td>waitForElementPresent</td>
      <td>//a[@data-i18n='Logout']</td>
      <td></td>
    </tr>
    <tr>
      <td>click</td>
      <td>//a[@data-i18n='Logout']</td>
      <td></td>
    </tr>
    <tr>
      <td>waitForElementPresent</td>
      <td>//input[@value='Confirm']</td>
      <td></td>
    </tr>
    <tr>
      <td>click</td>
      <td>//input[@value='Confirm']</td>
      <td></td>
    </tr>

    <tr>
      <td>waitForElementPresent</td>
      <td>//input[@value='Login']</td>
      <td></td>
    </tr>
  </tal:block>

</tal:block>
[buildout]
extends =
  ../cmake/buildout.cfg
  ../openssl/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../pcre/buildout.cfg
  ../xz-utils/buildout.cfg
  ../zlib/buildout.cfg

parts = libgit2

[libgit2]
recipe  = slapos.recipe.cmmi
url = https://github.com/libgit2/libgit2/archive/refs/tags/v${:version}.tar.gz
md5sum = 9f4ca15249e703ab88cbc929187750cd
version = 1.1.0
shared = true
configure-command =
  cmake
configure-options =
  -Bbuild
  -DCMAKE_BUILD_TYPE=Release
  -DCMAKE_INSTALL_PREFIX=@@LOCATION@@
  -DCMAKE_C_FLAGS="${:CMAKE_CFLAGS}"
  -DCMAKE_INSTALL_RPATH=${:CMAKE_LIBRARY_PATH}
  -G"Unix Makefiles"

make-options = -C build
environment =
  PKG_CONFIG_PATH=${openssl:location}/lib/pkgconfig:${zlib:location}/lib/pkgconfig:${xz-utils:location}/lib/pkgconfig
  PATH=${pkgconfig:location}/bin:${cmake:location}/bin:%(PATH)s
  LDFLAGS=-L${openssl-1.0:location}/lib -Wl,-rpath=${openssl:location}/lib -L${pcre:location}/lib -Wl,-rpath=${pcre:location}/lib
CMAKE_CFLAGS = -I${openssl:location}/include -I${zlib:location}/include -I${pcre:location}/include
CMAKE_LIBRARY_PATH=${zlib:location}/lib:${openssl:location}/lib:${pcre:location}/lib

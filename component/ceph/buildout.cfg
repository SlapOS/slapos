[buildout]
extends =
  ../cmake/buildout.cfg
  ../curl/buildout.cfg
  ../ninja/buildout.cfg
  ../openssl/buildout.cfg
  ../patch/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../libnl/buildout.cfg
  ../ncurses/buildout.cfg


[ceph]
# CEPH only for librbd
recipe = slapos.recipe.cmmi
shared = true
url = https://download.ceph.com/tarballs/ceph_17.1.0.orig.tar.gz
md5sum = 1f2ed3f17f76ea71d555428f26644610

patch-options = -p1
patches =
  ${:_profile_base_location_}/ceph-minimal.patch#3a9481ba63998276352c84ba0f4ed751

configure-command = ${cmake:location}/bin/cmake
cflags = -I${libnl:location}/include -I${ncurses:location}/include
environment =
  PATH=${cmake:location}/bin:${ninja:location}/bin:${patch:location}/bin:${pkgconfig:location}/bin:${python3:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${curl:location}/lib/pkgconfig:${openssl:location}/lib/pkgconfig:${libnl:location}/lib/pkgconfig:${ncurses:location}/lib/pkgconfig
  CFLAGS=${:cflags}
  CPPFLAGS=${:cflags}
  LDFLAGS=-L${libnl:location}/lib -Wl,-rpath=${libnl:location}/lib

#  CFLAGS=-I${curl:location}/include
#  LDFLAGS=-L${curl:location}/lib -Wl,-rpath=${curl:location}/lib

#  -DWITH_PYTHON3=${PYBUILD}
configure-options =
  -DCMAKE_BUILD_TYPE=RelWithDebInfo
  -DCMAKE_INSTALL_PREFIX=@@LOCATION@@
  -DDEBUG_GATHER=off
  -DWITH_BABELTRACE=off
  -DWITH_BABELTRACE=off
  -DWITH_BLUESTORE=off
  -DWITH_CEPHFS=off
  -DWITH_FUSE=off
  -DWITH_FUSE=off
  -DWITH_KRBD=off
  -DWITH_LIBCEPHFS=off
  -DWITH_LIBCEPHSQLITE=off
  -DWITH_LTTNG=off
  -DWITH_LZ4=off
  -DWITH_MANPAGE=off
  -DWITH_MGR=off
  -DWITH_MGR_DASHBOARD_FRONTEND=off
  -DWITH_OPENLDAP=off
  -DWITH_PYTHON3=3
  -DWITH_RADOSGW=off
  -DWITH_RADOSGW_AMQP_ENDPOINT=off
  -DWITH_RADOSGW_BEAST_OPENSSL=off
  -DWITH_RADOSGW_DBSTORE=off
  -DWITH_RADOSGW_KAFKA_ENDPOINT=off
  -DWITH_RADOSGW_LUA_PACKAGES=off
  -DWITH_RADOSGW_SELECT_PARQUET=off
  -DWITH_RBD=on
  -DWITH_RDMA=off
  -DWITH_SYSTEMD=off
  -DWITH_TESTS=off
  -DWITH_XFS=off
  -GNinja

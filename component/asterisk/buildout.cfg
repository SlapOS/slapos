# asterisk - PBX software
# http://www.asterisk.org/

[buildout]
parts = asterisk
extends =
  ../pkgconfig/buildout.cfg
  ../ncurses/buildout.cfg
  ../zlib/buildout.cfg
  ../libcap/buildout.cfg
  ../openssl/buildout.cfg
  ../ffmpeg/buildout.cfg
  ../gmime/buildout.cfg
  ../curl/buildout.cfg
  ../sqlite3/buildout.cfg
  ../speex/buildout.cfg
  ../neon/buildout.cfg
  ../libtool/buildout.cfg
  ../popt/buildout.cfg
  ../mariadb/buildout.cfg
  ../libiconv/buildout.cfg
  ../spandsp/buildout.cfg
  ../libxml2/buildout.cfg
  ../portaudio/buildout.cfg
  ../libpri/buildout.cfg
  ../libuuid/buildout.cfg
  ../libjpeg/buildout.cfg

[mp3.addon.patch]
recipe = hexagonit.recipe.download
url = ${:_profile_base_location_}/${:filename}
md5sum = 3542f8706d638ffabe0d5180b56bed89
download-only = true
filename = mp3.addon.patch

[asterisk]
virtual-depends =
  ${mp3.addon.patch:md5sum}
patch-options = -p1
patches =
  ${mp3.addon.patch:location}/${mp3.addon.patch:filename}
recipe = slapos.recipe.cmmi
url = http://downloads.asterisk.org/pub/telephony/asterisk/asterisk-11.4.0.tar.gz
md5sum = f2654567261f194f537bd2fbb97c9117
environment =
  PATH=${pkgconfig:location}/bin:${libcap:location}/sbin:${neon:location}/bin:${libxml2:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${zlib:location}/lib/pkgconfig:${openssl:location}/lib/pkgconfig:${libvorbis:location}/lib/pkgconfig:${gmime:location}/lib/pkgconfig:${sqlite3:location}/lib/pkgconfig:${speex:location}/lib/pkgconfig:${libogg:location}/lib/pkgconfig:${neon:location}/lib/pkgconfig:${popt:location}/lib/pkgconfig:${libxml2:location}/lib/pkgconfig:${curl:location}/lib/pkgconfig:${libuuid:location}/lib/pkgconfig
  CPPFLAGS=-I${zlib:location}/include -I${ncurses:location}/include -I${openssl:location}/include -I${libcap:location}/usr/include -I${libvorbis:location}/include -I${gmime:location}/include -I${sqlite3:location}/include -I${speex:location}/include -I${libogg:location}/include -I${neon:location}/include -I${popt:location}/include -I${libiconv:location}/include -I${libxml2:location}/include -I${libpri:location}/usr/include -I${curl:location}/include -I${libuuid:location}/include -I${libjpeg:location}/include
  LDFLAGS=-L${zlib:location}/lib -Wl,-rpath=${zlib:location}/lib -L${ncurses:location}/lib -Wl,-rpath=${ncurses:location}/lib -L${libcap:location}/lib/ -Wl,-rpath=${libcap:location}/lib/ -L${openssl:location}/lib -Wl,-rpath=${openssl:location}/lib -L${libvorbis:location}/lib -Wl,-rpath=${libvorbis:location}/lib -L${gmime:location}/lib -Wl,-rpath=${gmime:location}/lib -L${sqlite3:location}/lib -Wl,-rpath=${sqlite3:location}/lib -L${speex:location}/lib -Wl,-rpath=${speex:location}/lib -L${libogg:location}/lib -Wl,-rpath=${libogg:location}/lib -L${neon:location}/lib -Wl,-rpath=${neon:location}/lib -L${popt:location}/lib -Wl,-rpath=${popt:location}/lib -L${libiconv:location}/lib -Wl,-rpath=${libiconv:location}/lib -L${libxml2:location}/lib -Wl,-rpath=${libxml2:location}/lib -L${libpri:location}/usr/lib -Wl,-rpath=${libpri:location}/usr/lib -L${curl:location}/lib -Wl,-rpath=${curl:location}/lib -L${libuuid:location}/lib -Wl,-R${libuuid:location}/lib -L${libjpeg:location}/lib -Wl,-rpath=${libjpeg:location}/lib
configure-options =
  --disable-xmldoc
  --without-asound
  --without-bfd
  --without-execinfo
  --without-bluetooth
  --with-cap=${libcap:location}
  --without-cpg
  --with-curses=${ncurses:location}
  --with-crypto=${openssl:location}
  --without-dahdi
  --without-avcodec
  --without-gsm
  --without-ilbc
  --disable-gtk2
  --without-gmime
  --without-h323
  # --with-h323
  --without-hoard
  --without-ical
  --with-iconv=${libiconv:location}
  --without-iksemel
  --without-imap
  --without-inotify
  --without-iodbc
  --without-isdnnet
  --without-jack
  --without-kqueue
  --without-ldap
  --with-libcurl=${curl:location}
  --without-libedit
  --with-libxml2=${libxml2:location}
  --with-ltdl=${libtool:location}
  --without-lua
  --without-misdn
  --with-mysqlclient=${mariadb:location}
  --without-nbs
  --with-ncurses=${ncurses:location}
  --with-neon=${neon:location}
  --without-neon29
  --without-netsnmp
  --without-newt
  --with-ogg=${libogg:location}
  --without-openr2
  --without-osptk
  --without-oss
  --without-postgres
  --with-popt=${popt:location}
  --with-portaudio=${portaudio:location}
  --with-pri=${libpri:location}/usr
  --without-pwlib
  --without-radius
#   --with-resample=PATH    use LIBRESAMPLE files in PATH
  --without-sdl
  --without-SDL_image
#   --with-sounds-cache=PATH
#                           use cached sound tarfiles in PATH
  --with-spandsp=${spandsp:location}
  --without-ss7
  --with-speex=${speex:location}
  --with-speexdsp=${speex:location}
  --without-sqlite
  --with-sqlite3=${sqlite3:location}
  --without-srtp
  --with-ssl=${openssl:location}
  --without-suppserv
  --without-tds
  --without-termcap
  --without-timerfd
  --without-tinfo
  --without-tonezone
  --without-unixodbc
  --with-vorbis=${libvorbis:location}
  --without-vpb
  --without-x11
  --with-z=${zlib:location}

################################################################
# OpenSSH Portable - a secure shell client and server for *nix #
#                                                              #
# http://www.openssh.com/                                      #
################################################################

[buildout]
extends =
  ../curl/buildout.cfg
  ../libcap/buildout.cfg
  ../libedit/buildout.cfg
  ../libxml2/buildout.cfg
  ../libxslt/buildout.cfg
  ../nftables/buildout.cfg
  ../openssl/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../sqlite3/buildout.cfg
  ../util-linux/buildout.cfg

parts =
  asterisk

[libopencore]
recipe = slapos.recipe.cmmi
shared = true
md5sum = 03de025060a4f16c4c44218f65e13e95
location = @@LOCATION@@
url = https://downloads.sourceforge.net/project/opencore-amr/opencore-amr/opencore-amr-0.1.6.tar.gz

[pjsip]
recipe = slapos.recipe.cmmi
shared = true
md5sum = cfec3fe420c3ed47cff75a842fbe955f
location = @@LOCATION@@
url = https://github.com/pjsip/pjproject/archive/refs/tags/2.15.1.tar.gz
environment =
  CFLAGS=-DNDEBUG=1 -DPJ_HAS_IPV6=1
  LDFLAGS=-Wl,-rpath=${:location}/lib
configure-options =
  --prefix=${:location}
  --enable-shared
  --disable-video
  --disable-libyuv
  --disable-upnp
  --disable-pjsua2
  --disable-ilbc-codec
  --with-ssl=${openssl:location}
  --with-opencore-amr=${libopencore:location}

[asterisk]
recipe = slapos.recipe.cmmi
shared = true
md5sum = 02f88d1fbcdbb87c85397a32ce7e412a
location = @@LOCATION@@
url = https://softinst273654.host.vifib.net/public/asterisk-nexedi.tar.gz
environment =
  PATH=${pkgconfig:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${openssl:location}/lib/pkgconfig:${libedit:location}/lib/pkgconfig:${jansson:location}/lib/pkgconfig:${libxml2:location}/lib/pkgconfig:${pjsip:location}/lib/pkgconfig
  CFLAGS=-I${libuuid:location}/include -I${sqlite3:location}/include -I${libcap:location}/include -I${libxslt:location}/include
  LDFLAGS=-L${libuuid:location}/lib -Wl,-rpath=${libuuid:location}/lib -Wl,-rpath=${openssl:location}/lib -Wl,-rpath=${libedit:location}/lib -Wl,-rpath=${jansson:location}/lib -Wl,-rpath=${libxml2:location}/lib -L${sqlite3:location}/lib -Wl,-rpath=${sqlite3:location}/lib -Wl,-rpath=${libcap:location}/lib -Wl,-rpath=${libxslt:location}/lib -Wl,-rpath=${:location}/lib
make-targets =
  menuselect.makeopts
  install
post-install =
  cp --preserve=links ${pjsip:location}/lib/*so*  ${:location}/lib/asterisk/modules/
configure-options =
  --prefix=${:location}
  --disable-xmldoc
  --without-jansson-bundled
  --without-pjproject-bundled
  --without-libjwt-bundled
  --with-crypto=${openssl:location}
  --with-ssl=${openssl:location}
  --without-asound
  --with-opencore-amrnb=${libopencore:location}
  --with-opencore-amrwb=${libopencore:location}
  --without-vo-amrwbenc
  --without-bfd
  --with-execinfo
  --without-bluetooth
  --with-cap=${libcap:location}
  --without-codec2
  --without-cpg
  --without-crypt
  --without-dahdi
  --without-avcodec
  --without-gsm
  --without-ilbc
  --without-gtk2
  --without-gmime
  --without-hoard
  --without-ical
  --without-iconv
  --without-iksemel
  --without-imap
  --without-inotify
  --without-iodbc
  --without-isdnnet
  --without-jack
  --with-jansson=${jansson:location}
  --without-uriparser
  --without-kqueue
  --without-ldap
  --with-libcurl=${curl:location}
  --with-libedit=${libedit:location}
  --without-libjwt
  --with-libxml2=${libxml2:location}
  --with-libxslt=${libxslt:location}
  --without-lua
  --without-misdn
  --without-mysqlclient
  --without-nbs
  --without-neon
  --without-neon29
  --without-netsnmp
  --without-newt
  --without-ogg
  --without-openr2
  --without-opus
  --without-opusfile
  --without-osptk
  --without-oss
  --without-postgres
  --without-beanstalk
  --with-pjproject=${pjsip:location}
  --without-popt
  --without-portaudio
  --without-pri
  --without-radius
  --without-fftw3
  --without-resample
  --without-sndfile
  --without-sdl
  --without-SDL_image
  --without-spandsp
  --without-ss7
  --without-speex
  --without-speexdsp
  --without-sqlite
  --with-sqlite3=${sqlite3:location}
  --without-srtp
  --without-suppserv
  --without-tds
  --without-timerfd
  --without-tonezone
  --without-unbound
  --without-unixodbc
  --without-vorbis
  --without-vpb
  --without-x11
  --with-z=${zlib:location}

[buildout]
extends =
  ../python3/buildout.cfg
  ../git/buildout.cfg
  ../ccache/buildout.cfg
  ../nodejs/buildout.cfg
  ../python-PyYAML/buildout.cfg
  ../cmake/buildout.cfg

parts =
  pyodide
  nodejs
  npm

[node-less]
recipe = slapos.recipe.build:npm
packages = less
node = nodejs
environment =
  PATH=${nodejs:location}/bin:%(PATH)s

[node-uglify-js]
recipe = slapos.recipe.build:npm
packages = uglify-js
node = nodejs
environment =
  PATH=${nodejs:location}/bin:%(PATH)s

[pyodide-src]
recipe = slapos.recipe.build:gitclone
git-executable = ${git:location}/bin/git
repository = https://github.com/iodide-project/pyodide.git
location = ${buildout:parts-directory}/${:_buildout_section_name_}
branch = master

[pyodide]
recipe = plone.recipe.command
command = cd ${pyodide-src:location} && make
environment =
  PATH=${python3.5:location}/bin:${cmake:location}/bin:${ccache:location}/bin:${gcc:location}/bin:${node-less:location}/node_modules/.bin:${node-uglify-js:location}/node_modules/.bin:%(PATH)s
  CC=${gcc:location}/bin/gcc
  CXX=${gcc:location}/bin/g++
  LD_LIBRARY_PATH=${gcc:location}/lib:${gcc:location}/lib64
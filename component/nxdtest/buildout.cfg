[buildout]
extends =
  ../pygolang/buildout.cfg
  ../util-linux/buildout.cfg
  ../git/buildout.cfg


# nxdtest is bin/ program to run nxdtest.
# use ${nxdtest:exe} to run it.
[nxdtest]
recipe  = slapos.recipe.template:jinja2
exe     = ${buildout:bin-directory}/nxdtest
rendered= ${:exe}
mode    = 755
template= inline:
  #!/bin/sh -e
  # $PATH for unshare and mount
  PATH=${util-linux:location}/bin:$PATH
  exec ${.nxdtest.pyexe:exe} -c 'from nxdtest import main; main()'

# .nxdtest.pyexe is python interpreter used by nxdtest.
# the interpreter is located at ${.nxdtest.pyexe:exe}.
[.nxdtest.pyexe]
<= python-interpreter
eggs +=
  ${pygolang:egg}
  ${nxdtest-egg:egg}
interpreter = ${:_buildout_section_name_}
exe     = ${buildout:bin-directory}/${:interpreter}


[nxdtest-egg]
recipe  = zc.recipe.egg:develop
setup   = ${nxdtest-repository:location}
egg     = nxdtest

[nxdtest-repository]
recipe  = slapos.recipe.build:gitclone
repository = https://lab.nexedi.com/nexedi/nxdtest.git
revision = 9f413221
location = ${buildout:parts-directory}/nxdtest
git-executable = ${git:location}/bin/git

[buildout]
extends =
  ../dash/buildout.cfg
  ../curl/buildout.cfg

parts +=
  onlyoffice-x2t

[onlyoffice-x2t]
recipe = slapos.recipe.build

path = ${:_profile_base_location_}/onlyoffice-x2t-part.tar.gz

# script to install.
script =
  location = %(location)r
  self.failIfPathExists(location)
  import sys
  extract_dir = self.extract(self.options['path'])
  shutil.move(extract_dir, location)
  wrapper_location = os.path.join("%(location)s", "x2t")
  wrapper = open(wrapper_location, 'w')
  wrapper.write('''#!${dash:location}/bin/dash
  cd %(location)s
  export LD_LIBRARY_PATH=%(location)s/lib:${curl:location}/lib
  exec %(location)s/bin/x2t "$@"''')
  wrapper.close()
  os.chmod(wrapper_location, 0755)

[buildout]
extends =
  ../numpy/buildout.cfg
  ../cmake/buildout.cfg
  ../curl/buildout.cfg
  ../geos/buildout.cfg
  ../giflib/buildout.cfg
  ../libexpat/buildout.cfg
  ../libjpeg/buildout.cfg
  ../libtiff/buildout.cfg
  ../openjpeg/buildout.cfg
  ../pcre/buildout.cfg
  ../proj/buildout.cfg
  ../sqlite3/buildout.cfg
  ../xz-utils/buildout.cfg

parts =
  gdal-python

[gdal]
recipe = slapos.recipe.cmmi
version = 3.2.3
url = http://download.osgeo.org/gdal/${:version}/gdal-${:version}.tar.xz
md5sum = 6c276978d625d23a091bac9fdddb99db
configure-command = ${cmake:location}/bin/cmake
configure-options =
  -DCMAKE_BUILD_TYPE=Release
  -DGDAL_USE_CURL=ON
  -DCURL_INCLUDE_DIR=${curl:location}/include
  -DCURL_LIBRARY_RELEASE=${curl:location}/lib/libcurl.so
  -DGDAL_USE_EXPAT=ON
  -DEXPAT_INCLUDE_DIR=${libexpat:location}/include
  -DEXPAT_LIBRARY=${libexpat:location}/lib/libexpat.so
  -DGDAL_USE_GEOS=ON
  -DGEOS_INCLUDE_DIR=${geos:location}/include
  -DGEOS_LIBRARY=${geos:location}/lib/libgeos.so
  -DGDAL_USE_GIF=ON
  -DGIF_INCLUDE_DIR=${giflib:location}/include
  -DGIF_LIBRARY=${giflib:location}/lib/libgif.so
  -DGDAL_USE_OPENJPEG=ON
  -DGDAL_FIND_PACKAGE_OpenJPEG_MODE=CONFIG
  -DOPENJPEG_INCLUDE_DIR=${openjpeg:location}/include
  -DOPENJPEG_LIBRARY=${openjpeg:location}/lib/libopenjp2.so
  -DGDAL_USE_JPEG=ON
  -DJPEG_INCLUDE_DIR=${libjpeg:location}/include
  -DJPEG_LIBRARY_RELEASE=${libjpeg:location}/lib/libjpeg.so
  -DGDAL_USE_TIFF=ON
  -DTIFF_INCLUDE_DIR=${libtiff:location}/include
  -DTIFF_LIBRARY_RELEASE=${libtiff:location}/lib/libtiff.so
  -DGDAL_USE_ZLIB=ON
  -DZLIB_INCLUDE_DIR=${zlib:location}/include
  -DZLIB_LIBRARY_RELEASE=${zlib:location}/lib/libz.so
  -DGDAL_USE_PNG=ON
  -DPNG_PNG_INCLUDE_DIR=${libpng:location}/include
  -DPNG_LIBRARY_RELEASE=${libpng:location}/lib/libpng.so
  -DGDAL_FIND_PACKAGE_PROJ_MODE=CONFIG
  -DPROJ_INCLUDE_DIR=${proj:location}/include
  -DPROJ_LIBRARY_RELEASE=${proj:location}/lib/libproj.a
  -DGDAL_USE_SQLITE3=ON
  -DSQLite3_INCLUDE_DIR=${sqlite3:location}/include
  -DSQLite3_LIBRARY=${sqlite3:location}/lib/libsqlite3.so
  -DGDAL_USE_LIBXML2=ON
  -DLIBXML2_INCLUDE_DIR=${libxml2:location}/include/libxml2
  -DLIBXML2_LIBRARY=${libxml2:location}/lib/libxml2.so
  -DGDAL_USE_WEBP=OFF
environment =
  CMAKE_PREFIX_PATH=${openjpeg:location}:${proj:location}
  PATH=${xz-utils:location}/bin:%(PATH)s
  CPPFLAGS=-I${pcre:location}/include
  LDFLAGS=-L${pcre:location}/lib -Wl,-rpath=${buildout:parts-directory}/${:_buildout_section_name_}/lib -Wl,-rpath=${curl:location}/lib -Wl,-rpath=${geos:location}/lib -Wl,-rpath=${giflib:location}/lib -Wl,-rpath=${openjpeg:location}/lib -Wl,-rpath=${jbigkit:location}/lib -Wl,-rpath=${libexpat:location}/lib -Wl,-rpath=${libjpeg:location}/lib -Wl,-rpath=${libpng:location}/lib -Wl,-rpath=${libtiff:location}/lib -Wl,-rpath=${libxml2:location}/lib -Wl,-rpath=${openssl:location}/lib -Wl,-rpath=${pcre:location}/lib -Wl,-rpath=${sqlite3:location}/lib -Wl,-rpath=${zlib:location}/lib

[gdal-python]
recipe = zc.recipe.egg:custom
egg = GDAL ==${gdal:version}
setup-eggs = ${numpy:egg}
rpath = ${:library-dirs}
include-dirs =
  ${gdal:location}/include
library-dirs =
  ${gdal:location}/lib
environment = gdal-python-env

[gdal-python-env]
PATH = ${gdal:location}/bin:%(PATH)s

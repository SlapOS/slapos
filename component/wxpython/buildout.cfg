[buildout]

extends =
  ../pkgconfig/buildout.cfg
  ../gtk-3/buildout.cfg
  ../pillow/buildout.cfg
  ../numpy/buildout.cfg
  ../wxwidgets/buildout.cfg

parts =
    wxPython

[wxpython-eggs]
recipe = zc.recipe.egg
interpreter = wxpython2.7
eggs =
  ${numpy:egg}
  ${pillow-python:egg}

[wxPython-download]
recipe = slapos.recipe.build:download-unpacked
url = https://files.pythonhosted.org/packages/b0/4d/80d65c37ee60a479d338d27a2895fb15bbba27a3e6bb5b6d72bb28246e99/wxPython-4.1.1.tar.gz
md5sum = 262191ae1c926a58da37fb7a8fabc51e


[wxPython]
recipe = slapos.recipe.build
egg = ${:_buildout_section_name_}
source-location = ${wxPython-download:location}
egg-name = ${:egg}-${versions:wxPython}-py${python:version}-linux-x86_64.egg
location = ${buildout:eggs-directory}/${:egg-name}
python-bin = ${buildout:bin-directory}/${wxpython-eggs:interpreter}
wxwidgets-bin = ${wxWidgets:location}/bin/
LDFLAGS=-L${gtk-3:location}/lib -Wl,-rpath=${gtk-3:location}/lib -L${wxWidgets:location}/lib -Wl,-rpath=${wxWidgets:location}/lib
CPPFLAGS=-I${wxWidgets:location}/include/wx-3.0 -I${wxWidgets:location}/lib/wx/include/gtk3-unicode-3.0 -I${gtk-3:location}/include/gtk-3.0
pkg-config = ${pkgconfig:location}/bin
PKG_CONFIG_PATH = ${glib:location}/lib/pkgconfig:${gtk-3:location}/lib/pkgconfig:${gtk-3:pkg_config_depends}
install =
  import os, sys
  from setuptools.archive_util import unpack_archive
  workdir = options['source-location']
  python_bin = options['python-bin']
  dist = os.path.join(workdir, 'dist')
  build = os.path.join(workdir, 'build')
  env = {'PATH': os.pathsep.join([options['pkg-config'],
                          options['wxwidgets-bin'],
                          os.environ['PATH']]),
          'LDFLAGS': options['LDFLAGS'],
          'CPPFLAGS': options['CPPFLAGS'],
          'PYTHONPATH': os.pathsep.join(sys.path + [workdir]),
          'PKG_CONFIG_PATH': options['PKG_CONFIG_PATH'],
        }
  call([python_bin, 'build.py', 'build', '--use_syswx', '--release',
        '--nodoc', '--gtk3'], env=env, cwd=workdir)
  call([python_bin, 'build.py', 'bdist_egg', '--use_syswx', '--release',
        '--nodoc', '--gtk3'], env=env, cwd=workdir)
  unpack_archive(os.path.join(dist, options['egg-name']), location)
  self.cleanup_list += build, dist

[versions]
wxPython = 4.1.1

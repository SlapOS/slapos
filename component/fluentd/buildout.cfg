[buildout]
parts =
  directory
  service-fluentd
  fluentd-agent-conf

# Define egg directories to be the one from Software Release
# (/opt/slapgrid/...)
# Always the same.
eggs-directory = {{ buildout['eggs-directory'] }}
develop-eggs-directory = {{ buildout['develop-eggs-directory'] }}
offline = true

[instance-parameter]
recipe = slapos.cookbook:slapconfiguration.serialised
computer = ${slap_connection:computer_id}
partition = ${slap_connection:partition_id}
url = ${slap_connection:server_url}
key = ${slap_connection:key_file}
cert = ${slap_connection:cert_file}

# Create all needed directories, depending on your needs
[directory]
recipe = slapos.cookbook:mkdirectory
home = ${buildout:directory}
etc = ${:home}/etc
var = ${:home}/var
script = ${:etc}/run/
service = ${:etc}/service
promise = ${:etc}/promise/
log = ${:var}/log

[service-fluentd]
recipe  = slapos.cookbook:wrapper
wrapper-path    = ${directory:service}/fluentd-service
command-line    = {{ fluentd_location }}/bin/fluentd
    -v
    -c ${directory:etc}/fluentd-agent.conf
environment = 
  GEM_PATH={{ fluentd_location }}/lib/ruby/gems/1.8/


[fluentd-agent-conf]
recipe  = slapos.recipe.template:jinja2
template = {{ fluentd_conf }}/fluentd-agent.conf.jinja2.in
#md5sum = 4b81ddcbe2f16d23013caac37151d396 
rendered = ${buildout:directory}/etc/fluentd-agent.conf
mode = 0644
context = 
  key slapparameter_dict instance-parameter:configuration

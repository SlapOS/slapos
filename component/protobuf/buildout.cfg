[buildout]
extends =
  ../zlib/buildout.cfg

parts = protobuf

[protobuf]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/google/protobuf/releases/download/v3.4.0/protobuf-python-3.4.0.tar.gz
md5sum = 0820cc2e56d71aef8e99794fcbd184cd
environment =
  LDFLAGS=-Wl,-rpath=${zlib:location}/lib

[protobuf-cpp]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/google/protobuf/releases/download/v3.4.0/protobuf-cpp-3.4.0.tar.gz
md5sum = 6d59dad503bea5ad420fd09ddad84481
environment =
  LDFLAGS=-Wl,-rpath=${zlib:location}/lib

# The following part is more modern than the previous one. Maybe
# it should replace it, but there might be uncompat changes, as the so-called
# 'syntax' supported to specify protocol-buffers has changed. Version 3.4.0
# declared above in this file seems uncompat with the "'syntax' = 3". It is
# not clear in the docs of protocol-buffers what versions support what
# 'syntax' and 'edition' field of the files used to define the
# protocol-buffers. The following version is the one that works in Debian 12,
# which is the version of Debian that Dockerfile of qdrant uses to build the
# container.
# Qdrant is in software/qdrant/software.cfg (fails to build with v3.4.0).
[protobuf-21.12]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/protocolbuffers/protobuf/releases/download/v21.12/protobuf-all-21.12.tar.gz
md5sum = 7fb5fa6217646e5146346e39d9aad6f9
environment =
  LDFLAGS=-Wl,-rpath=${zlib:location}/lib

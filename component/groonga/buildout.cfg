# groonga - an open-source fulltext search engine and column store
# http://groonga.org/

[buildout]
parts =
  groonga

extends =
  ../jemalloc/buildout.cfg
  ../libstemmer/buildout.cfg
  ../patch/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../zlib/buildout.cfg

[groonga]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/groonga/groonga/releases/download/v16.0.0/groonga-16.0.0.tar.gz
md5sum = 8a28d9ddbacb1db7b2548a6eb269dccd
groonga-plugin-dir =  @@LOCATION@@/lib/groonga/plugins/
patches =
  ${:_profile_base_location_}/0001-add-a-temporary-patch-to-respect-more-tokens-in-natu.patch#457b07020294ea43cff9e27341b9e907
patch-options = -p1
configure-options =
  --disable-static
  --disable-glibtest
  --disable-benchmark
  --disable-document
  --disable-groonga-httpd
  --with-jemalloc
  --with-libstemmer
  --with-libstemmer-include=${libstemmer:location}/include
  --with-libstemmer-lib=${libstemmer:location}/lib
  --without-ruby
  --without-inkscape
  --without-lemon
  --without-lz4
  --without-mecab
  --without-kytea
  --without-libevent
environment =
  CPPFLAGS=-I${libstemmer:location}/include -I${libstemmer:location}/include -I${zlib:location}/include
  LDFLAGS=-Wl,-rpath=${jemalloc:location}/lib -L${jemalloc:location}/lib -Wl,-rpath=${libstemmer:location}/lib -L${libstemmer:location}/lib -Wl,-rpath=${zlib:location}/lib -L${zlib:location}/lib
  PATH=${patch:location}/bin:%(PATH)s


[groonga-normalizer-mysql]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/groonga/groonga-normalizer-mysql/releases/download/v1.3.0/groonga-normalizer-mysql-1.3.0.tar.gz
md5sum = eb7b2fb226d5dbbb3ba4e68de2c6d57c
groonga-plugin-dir =  @@LOCATION@@/lib/groonga/plugins/
pre-configure = mkdir -p ${:groonga-plugin-dir}
configure-command = ${cmake:location}/bin/cmake
configure-options =
  -DCMAKE_INSTALL_PREFIX=@@LOCATION@@
  -DGRN_PLUGINS_DIR=${:groonga-plugin-dir}
  .
environment =
  PATH=${pkgconfig:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${groonga:location}/lib/pkgconfig
  LDFLAGS=-Wl,-rpath=${groonga:location}/lib

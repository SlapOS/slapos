[buildout]
extends =
  ../fontconfig/buildout.cfg
  ../libexpat/buildout.cfg
parts =
  phantomjs

[phantomjs]
recipe = slapos.recipe.build
slapos_promise =
  file:phantomjs-slapos

url = https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-1.9.7-linux${:url-extension}

install =
  import os
  extract_dir = self.extract(self.download(options['url'], options['md5sum']))
  workdir = guessworkdir(extract_dir)
  self.copyTree(workdir, location)
  with open(os.path.join(location, "phantomjs-slapos"), 'w') as wrapper:
    wrapper.write("""#!/bin/sh -e
  cd %(location)s
  export LD_LIBRARY_PATH=%(location)s:${freetype:location}/lib/:${fontconfig:location}/lib/:${libexpat:location}/lib
  export PATH=${fontconfig:location}/bin:$PATH
  exec %(location)s/bin/phantomjs "$@"
  """ % options)
    os.fchmod(wrapper.fileno(), 0o755)

[phantomjs:bits32]
url-extension = -i686.tar.bz2
md5sum = 9c1426eef5b04679d65198b1bdd6ef88

[phantomjs:bits64]
url-extension = -x86_64.tar.bz2 
md5sum = f278996c3edd0e8d8ec4893807f27d71

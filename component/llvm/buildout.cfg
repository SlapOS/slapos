[buildout]
extends =
    ../xz-utils/buildout.cfg
    ../cmake/buildout.cfg
    ../git/buildout.cfg

parts = llvm

[llvm-cmake]
recipe = slapos.recipe.build:download-unpacked
shared = true
url = https://github.com/llvm/llvm-project/releases/download/llvmorg-${:version}/cmake-${:version}.src.tar.xz
version = 20.1.7
md5sum = 4ad456cc429fe8a7f4e10db433ee6349
environment =
  PATH=${xz-utils:location}/bin:%(PATH)s

[llvm]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/llvm/llvm-project/releases/download/llvmorg-${:version}/llvm-${:version}.src.tar.xz
version = 20.1.7
md5sum = 8ab377a8751c4cc8319e28638cb7d796
pre-configure =
  mkdir -p ../cmake/Modules
  cp ${llvm-cmake:location}/Modules/* ../cmake/Modules/
configure-command = ${cmake:location}/bin/cmake
configure-options =
    -Bbuild
    -DCMAKE_INSTALL_PREFIX=@@LOCATION@@
    -DCMAKE_BUILD_TYPE=Release
    -DLLVM_INSTALL_UTILS=ON
    -DLLVM_INCLUDE_BENCHMARKS=OFF
    -DLLVM_INCLUDE_TESTS=OFF
    -DLIBXML2_LIBRARY=${libxml2:location}/lib
    -DLIBXML2_INCLUDE_DIR=I${libxml2:location}/include/libxml2
    -DZLIB_INCLUDE_DIR=${zlib:location}/include
    -DZLIB_LIBRARY=${zlib:location}/lib

make-options = -C build
environment =
    PATH=${xz-utils:location}/bin:${git:location}/bin:%(PATH)s
    LDFLAGS=-Wl,-rpath=${libxml2:location}/lib -Wl,-rpath=${zlib:location}/lib

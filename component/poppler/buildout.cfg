[buildout]
parts = poppler
extends =
  ../bzip2/buildout.cfg
  ../cmake/buildout.cfg
  ../fontconfig/buildout.cfg
  ../jbigkit/buildout.cfg
  ../lcms/buildout.cfg
  ../libjpeg/buildout.cfg
  ../libpng/buildout.cfg
  ../libtiff/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../xz-utils/buildout.cfg
  ../zlib/buildout.cfg

[poppler]
recipe = slapos.recipe.cmmi
shared = true
url = https://poppler.freedesktop.org/poppler-25.12.0.tar.xz
md5sum = 064f6739a93cd9116d2b6f52c8b93d5b
pre-configure =
# XXX slapos gcc is too old for CXX 23, but using CXX 20 seems enough
  sed -i 's/set(CMAKE_CXX_STANDARD 23)/set(CMAKE_CXX_STANDARD 20)/' CMakeLists.txt
configure-command = ${cmake:location}/bin/cmake
configure-options =
  -DCMAKE_INSTALL_PREFIX=${:location}
  -DCMAKE_INSTALL_LIBDIR=lib
  -DCMAKE_INSTALL_RPATH=${:location}/lib
  -DFREETYPE_INCLUDE_DIRS=${freetype:location}/include/freetype2/
  -DFREETYPE_LIBRARY=${freetype:location}/lib/libfreetype.so
  -DENABLE_LIBTIFF=ON
  -DTIFF_INCLUDE_DIR=${libtiff:location}/include
  -DTIFF_LIBRARY=${libtiff:location}/lib/libtiff.so
  -DENABLE_DCTDECODER=libjpeg
  -DJPEG_INCLUDE_DIR=${libjpeg:location}/include
  -DJPEG_LIBRARY=${libjpeg:location}/lib/libjpeg.so
  -DPNG_PNG_INCLUDE_DIR=${libpng:location}/include
  -DPNG_LIBRARY=${libpng:location}/lib/libpng.so
  -DZLIB_INCLUDE_DIR=${zlib:location}/include
  -DZLIB_LIBRARY=${zlib:location}/lib/libz.so
  -DBUILD_CPP_TESTS=OFF
  -DBUILD_GTK_TESTS=OFF
  -DBUILD_MANUAL_TESTS=OFF
  -DBUILD_QT5_TESTS=OFF
  -DBUILD_QT6_TESTS=OFF
  -DENABLE_BOOST=OFF
  -DENABLE_CPP=OFF
  -DENABLE_GLIB=OFF
  -DENABLE_GPGME=OFF
  -DENABLE_LIBCURL=OFF
  -DENABLE_LIBOPENJPEG=none
  -DENABLE_NSS3=OFF
  -DENABLE_QT5=OFF
  -DENABLE_QT6=OFF
location = @@LOCATION@@
environment =
  PATH=${cmake:location}/bin:${pkgconfig:location}/bin:${xz-utils:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${fontconfig:location}/lib/pkgconfig:${fontconfig:pkg_config_depends}:${libpng:location}/lib/pkgconfig:${lcms2:location}/lib/pkgconfig

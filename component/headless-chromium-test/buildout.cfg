# This is a dummy version that fetches a precompiled binary, to
# facilitate testing. This way, we can test software/headless-chromium
# without having to wait for component/headless-chromium to finish
# compiling each time. This component will be deleted before the merge
# request is finalized.

[buildout]
extends =
  ../wget/buildout.cfg
  ../nss/buildout.cfg
  ../nspr/buildout.cfg

parts =
  chromium-wrapper

[chromium]
recipe = plone.recipe.command
path = ${buildout:parts-directory}/${:_buildout_section_name_}
command =
  mkdir -p ${:path}
  cd ${:path}
  wget http://www.contrib.andrew.cmu.edu/~ericzhen/hc
environment =
  PATH=%(PATH)s:${wget:location}/bin
library-path = ${nspr:location}/lib:${nss:location}/lib

# Create a wrapper at bin/headless-chromium.
# TODO: we might need to explicitly set LD_LIBRARY_PATH since nss and
# nspr are not where they were when the executable was built?
[chromium-wrapper]
recipe = slapos.cookbook:wrapper
command-line = ${chromium:path}/hc
wrapper-path = ${buildout:bin-directory}/headless-chromium
environment =
  LD_LIBRARY_PATH=${chromium:library-path}

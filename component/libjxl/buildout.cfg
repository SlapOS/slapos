# JPEG XL image format reference implementation
[buildout]
extends =
  ../cmake/buildout.cfg
  ../brotli/buildout.cfg
  ../lcms/buildout.cfg
  ../libpng/buildout.cfg
  ../pkgconfig/buildout.cfg
parts =
  libjxl

[libjxl]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/libjxl/libjxl/archive/refs/tags/v0.11.1.tar.gz
md5sum = 8f26fc954c2d9cb377544a5f029182ef
location = @@LOCATION@@
configure-command = ${cmake:location}/bin/cmake
configure-options =
  -DCMAKE_INSTALL_PREFIX=${:location}
  -DCMAKE_EXE_LINKER_FLAGS_INIT="-lhwy -L${highway:location}/lib -Wl,-rpath=${highway:location}/lib -llcms2 -L${lcms2:location}/lib -Wl,-rpath=${lcms2:location}/lib" 
  -DBUILD_TESTING:BOOL=OFF
  -DJPEGXL_ENABLE_PLUGINS:BOOL=OFF
 	-DJPEGXL_ENABLE_SJPEG:BOOL=OFF
 	-DJPEGXL_ENABLE_SKCMS:BOOL=OFF
  -DJPEGXL_FORCE_SYSTEM_BROTLI:BOOL=ON
  -DJPEGXL_FORCE_SYSTEM_HWY:BOOL=ON
  -DJPEGXL_ENABLE_SKCMS:BOOL=OFF
  -DJPEGXL_FORCE_SYSTEM_LCMS2:BOOL=ON
  -DHWY_LIBRARY=${highway:location}/lib
  -DHWY_INCLUDE_DIR=${highway:location}/include
  -DLCMS2_LIBRARY=${lcms2:location}/lib
  -DLCMS2_INCLUDE_DIR=${lcms2:location}/include
environment =
  PATH=${pkgconfig:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${:pkg_config_depends}
pkg_config_depends=${highway:location}/lib/pkgconfig:${lcms2:location}/lib/pkgconfig:${brotli:location}/lib/pkgconfig:${libpng:location}/lib/pkgconfig


# Highway is a C++ library that provides portable SIMD/vector intrinsics.
[highway]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/google/highway/releases/download/1.3.0/highway-1.3.0.tar.gz
md5sum = b2926ccf7fa63b351ac79d2f814e3f31
location = @@LOCATION@@
configure-command = ${cmake:location}/bin/cmake
configure-options =
  -DCMAKE_INSTALL_PREFIX=${:location}
  -DCMAKE_SKIP_RPATH:BOOL=OFF
  -DBUILD_SHARED_LIBS:BOOL=ON
  -DBUILD_TESTING=OFF

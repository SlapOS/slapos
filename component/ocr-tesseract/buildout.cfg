[buildout]
extends =
  ../ocr-leptonica/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../libtool/buildout.cfg
  ../autoconf/buildout.cfg
  ../automake/buildout.cfg
  ../cmake/buildout.cfg

parts = ocr-tesseract

[ocr-tesseract-eng-traineddata]
recipe = slapos.recipe.build:download
strip-top-level-dir = false
filename = eng.traineddata
url = https://github.com/tesseract-ocr/tessdata/raw/4.00/eng.traineddata
md5sum = 7af2ad02d11702c7092a5f8dd044d52f

[tesseract-env]
PATH=${pkg-config:location}/bin:${autoconf:location}/bin:${automake:location}/bin:${libtool:location}/bin:%(PATH)s
LIBTOOL=${libtool:location}/bin/libtool
CPPFLAGS=-I${ocr-leptonica:location}/include
LDFLAGS =-L${ocr-leptonica:location}/lib -Wl,-rpath=${ocr-leptonica:location}/lib
PKG_CONFIG_PATH=${ocr-leptonica:location}/lib/pkgconfig
TESSDATA_PREFIX=${ocr-tesseract-eng-traineddata:location}

[ocr-tesseract]
recipe = slapos.recipe.cmmi
url = https://github.com/tesseract-ocr/tesseract/tarball/84db453d3ac002e141a22cd04b41edaac3c50386/tesseract-4.0.tar.gz
environment-section = tesseract-env
patch-options = -p1
patches = ${:_profile_base_location_}/tesseract_cmake.patch
make-options =
  -C build
pre-configure =
  mkdir build
configure-command =
  cd build
  ${cmake:location}/bin/cmake -DCMAKE_INSTALL_PREFIX=${buildout:parts-directory}/${:_buildout_section_name_} ..
[buildout]
extends =
  ../patch/buildout.cfg

parts =
  libffi
  readline

[libffi]
recipe = slapos.recipe.cmmi
version = 3.2.1
url = ftp://sourceware.org/pub/libffi/libffi-${:version}.tar.gz
md5sum = 83b89587607e3eb65c70d361f13bab43
location = ${buildout:parts-directory}/${:_buildout_section_name_}
patch-options = -p1
patches =
  ${:_profile_base_location_}/includedir.diff#e430307d16a0d215a24ec2acff23d184

configure-command = 
  cp -a  ${readline6.3-config_sub:location}/config.sub   ${buildout:parts-directory}/${:_buildout_section_name_}__compile__/libffi-{$readline:version}/
  cp -a  ${readline6.3-config_guess:location}/config.guess   ${buildout:parts-directory}/${:_buildout_section_name_}__compile__/libffi-{$readline:version}/
  ./configure
  
configure-options =
  --disable-static
# on x86_64 OpenSuse, libraries are installed under parts/libffi/lib64.
make-targets =
  install && cp -av ${:location}/lib64/* ${:location}/lib/ || true
environment =
  PATH=${patch:location}/bin:%(PATH)s

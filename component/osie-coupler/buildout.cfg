[buildout]
extends =
  ../git/buildout.cfg
  ../mbedtls/buildout.cfg
  ../open62541/buildout.cfg
  ../defaults.cfg

parts = osie-coupler

[gcc]
# we want this SR to use a fixed gcc (so that we have the same gcc as open62541 component)
max_version = 0

[osie-repository]
recipe  = slapos.recipe.build:gitclone
git-executable = ${git:location}/bin/git
repository = https://lab.nexedi.com/nexedi/osie.git
revision = 7d6b1af

[osie-coupler]
recipe = slapos.recipe.cmmi
path = ${osie-repository:location}/coupler
bin_dir = ${buildout:directory}/bin
environment =
  PATH=${gcc:prefix}/bin:/usr/bin
  C_INCLUDE_PATH=${open62541:location}/include:${open62541:location}/deps:${open62541:location}/src/pubsub
  LDFLAGS=-L${open62541:location}/lib -Wl,-rpath=${open62541:location}/lib -L ${mbedtls:location}/lib -Wl,-rpath=${mbedtls:location}/lib
configure-command = true
post-install =
  cp bin/server ${:bin_dir}/

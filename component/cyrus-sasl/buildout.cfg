[buildout]
parts =
  cyrus-sasl
extends =
  ../autoconf/buildout.cfg
  ../automake/buildout.cfg
  ../gdbm/buildout.cfg
  ../libtool/buildout.cfg
  ../m4/buildout.cfg
  ../zlib/buildout.cfg

[cyrus-sasl]
recipe = slapos.recipe.cmmi
shared = true
url = https://github.com/cyrusimap/cyrus-sasl/releases/download/cyrus-sasl-2.1.28/cyrus-sasl-2.1.28.tar.gz
md5sum = 6f228a692516f5318a64505b46966cfa
location = @@LOCATION@@
patch-options = -p1
patches =
  https://salsa.debian.org/debian/cyrus-sasl2/-/raw/224a17e57ceb6971c5880f4d3cabb78be9d58732/debian/patches/0005-Fix-time-check.patch#cdc9d21121dd0355518728b42e4615f2
  https://salsa.debian.org/debian/cyrus-sasl2/-/raw/ab5fcfd88383a02760e13265a27267b7cc6f8f24/debian/patches/0042-gcc-15.patch#7a0cf76045df71e0ab006bd012d25d44
pre-configure =
  "${libtool:location}/bin/libtoolize" -c -f &&
  "${automake:location}/bin/aclocal" -I "${libtool:location}/share/aclocal" -I config  &&
  "${automake:location}/bin/automake" -c -a -f
configure-options =
  --disable-digest
  --disable-gssapi
  --disable-otp
  --with-dblib=gdbm
  --without-des
  --without-openssl
  --without-pam
  --without-saslauthd
  --with-plugindir=${:location}/lib/sasl2
# it seems that parallel build sometimes fails.
make-options =
  -j1

environment =
  PATH=${autoconf:location}/bin:${m4:location}/bin:%(PATH)s
  CPPFLAGS=-fPIC -I${zlib:location}/include -I${gdbm:location}/include
  LDFLAGS=-L${zlib:location}/lib -Wl,-rpath=${zlib:location}/lib -L${gdbm:location}/lib -Wl,-rpath=${gdbm:location}/lib

[buildout]
extends =
  ../bzip2/buildout.cfg
  ../gtk/buildout.cfg
  ../libxml2/buildout.cfg
  ../pkgconfig/buildout.cfg
  ../rust/buildout.cfg
  ../xz-utils/buildout.cfg
  ../zlib/buildout.cfg

parts = librsvg

[libcroco]
recipe = slapos.recipe.cmmi
shared = true
url = http://ftp.gnome.org/pub/gnome/core/3.20/3.20.2/sources/libcroco-0.6.11.tar.xz
md5sum = dabc1911dfbfa85f8e6859ca47863168
configure-options =
  --disable-static
environment =
  PATH=${pkgconfig:location}/bin:${xz-utils:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${glib:location}/lib/pkgconfig:${glib:pkg_config_depends}:${libxml2:location}/lib/pkgconfig:${pkgconfig:location}/lib/pkgconfig:${zlib:location}/lib/pkgconfig
  LDFLAGS=-Wl,-rpath=${zlib:location}/lib -Wl,-rpath=${glib:location}/lib

[librsvg]
recipe = slapos.recipe.cmmi
shared = true
url = https://download.gnome.org/sources/librsvg/2.61/librsvg-2.61.3.tar.xz
md5sum = f015a7dca4952ba9a2e3b8b536695f1f
pkg_config_depends = ${pango:location}/lib/pkgconfig:${pango:pkg_config_depends}:${zlib:location}/lib/pkgconfig:${gdk-pixbuf:location}/lib/pkgconfig:${gdk-pixbuf:pkg_config_depends}:${libcroco:location}/lib/pkgconfig
configure-command =
  meson setup builddir --wrap-mode=nodownload --libdir=lib -Dprefix="@@LOCATION@@" -Dintrospection=disabled -Dpixbuf-loader=disabled
make-binary = ninja -C builddir
environment =
  PATH=${cargo-c:location}/bin:${rustc:location}/bin:${meson:location}/bin:${ninja:location}/bin:${gdk-pixbuf:location}/bin:${glib:location}/bin:${libxml2:location}/bin:${pkgconfig:location}/bin:${pango:location}/bin:${xz-utils:location}/bin:%(PATH)s
  PKG_CONFIG_PATH=${:pkg_config_depends}
  LDFLAGS=-L${bzip2:location}/lib -Wl,-rpath=${bzip2:location}/lib -Wl,-rpath=${cairo:location}/lib -Wl,-rpath=${zlib:location}/lib -Wl,-rpath=${glib:location}/lib -Wl,-rpath=${gdk-pixbuf:location}/lib -Wl,-rpath=${libxml2:location}/lib -Wl,-rpath=${pango:location}/lib
  RUSTFLAGS=-C link-arg=-Wl,-rpath=${cairo:location}/lib -C link-arg=-Wl,-rpath=${pango:location}/lib -C link-arg=-Wl,-rpath=${fribidi:location}/lib -C link-arg=-Wl,-rpath=${libxml2:location}/lib -C link-arg=-Wl,-rpath=${glib:location}/lib -C link-arg=-Wl,-rpath=${fontconfig:location}/lib  -C link-arg=-Wl,-rpath=${harfbuzz:location}/lib

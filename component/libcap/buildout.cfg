[buildout]
extends =
  ../attr/buildout.cfg
  ../gperf/buildout.cfg
parts = libcap

[libcap2]
recipe = slapos.recipe.cmmi
shared = true
url = https://www.kernel.org/pub/linux/libs/security/linux-privs/libcap2/libcap-2.76.tar.xz
md5sum = 449ade7d620b5c4eeb15a632fbaa4f74
location = @@LOCATION@@
configure-command = :
make-options =
  RAISE_SETFCAP=no
  prefix=${:location}
  lib=lib
  CFLAGS="-fPIC -I${attr:location}/include/"
  LDFLAGS="-L${attr:location}/lib/ -Wl,-rpath=${attr:location}/lib/ -Wl,-rpath=${:location}/lib/"
  install
environment =
  PATH=${gperf:location}/bin:%(PATH)s
# Fix the lib directory issue
# post-install =
#   cd ${:location}
#   if [ ! -d lib ]; then
#     if [ -d lib64 ]; then
#       ln -sf lib64 lib
#     else
#       mkdir -p lib
#       mv *.so* *.a lib/ 2>/dev/null || true
#     fi
#   fi

[libcap]
<= libcap2
